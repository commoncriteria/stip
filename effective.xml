<Module xmlns="https://niap-ccevs.org/cc/v1" xmlns:sec="https://niap-ccevs.org/cc/v1/section" xmlns:h="http://www.w3.org/1999/xhtml" boilerplate="yes" target-product="SSL/TLS Inspection Proxy" target-products="SSL/TLS Inspection Proxies" name="SSL/TLS Inspection Proxy">
	
  <PPReference>
    <ReferenceTable>
      <PPVersion>1.1</PPVersion>
      <PPAuthor>National Information Assurance Partnership</PPAuthor>
      <PPPubDate>2022-09-30</PPPubDate>
      <Keywords>STIP</Keywords>
    </ReferenceTable>
  </PPReference>
  
  <RevisionHistory>
    <entry>
      <version>1.1</version>
      <date>2022-09-30</date>
      <subject>Updates to reflect Github conversion, compatibility with CPP_ND_V2.2E, and Technical Decisions applied to version 1.0</subject>
    </entry>
  </RevisionHistory>
  <RevisionHistory>
    <entry>
      <version>1.0</version>
      <date>2019-08-23</date>
      <subject>Update release</subject>
    </entry>
  </RevisionHistory>

  <!-- 1.0 Introduction -->
  <sec:Introduction>
    
    <!-- 1.1 Overview --> <!-- change -->
    <sec:Overview>
      The scope of this PP-Module is to describe the security functionality of an SSL/TLS Inspection Proxy (STIP)
      in terms of  <xref g="CC"/> and to define functional and assurance requirements for such
      products. This PP-Module is intended for use with the following Base-PPs:

      <h:ul>
        <h:li>collaborative Protection Profile for Network Devices (NDcPP or CPP_ND_V2.2E), Version 2.2E</h:li>
      </h:ul>
      
      This Base-PP is valid because a STIP is a specific type of network appliance that is able to function as an authorized man-in-the-middle for TLS connections.
      <h:p/>
      This PP-Module is intended to specify the functionality of a network device that includes limited
      Certification Authority (CA) functionality to issue certificates for the purpose of providing network security
      services on the underlying plaintext. The device accomplishes this by terminating an intended TLS session
      between a monitored client and specified external servers. The device instead establishes a TLS session
      thread consisting of a TLS session between the device and the external server and a second TLS session
      between the device, acting as the external server, and the client. By replacing the end-to-end TLS session
      with two TLS sessions terminated at the TOE, the device is able to provide additional security services
      based on the decrypted plaintext.
      <h:p/>
      A network device meeting this PP-Module may perform additional security services on the plaintext,
      provide the decrypted payload to external network devices to perform the security services, or do both.
      These additional security services, whether processed internally or externally, may be performed inline,
      or passively. If multiple security services are provided, some may be inline, while others are performed
      passively. This PP-Module does not cover the specific requirements associated with various additional
      services.
      <h:p/>
      A TOE that conforms to a PP-Configuration containing this PP-Module may be a ‘Distributed TOE’ as
      defined in the NDcPP; however, the SSL/TLS Inspection Proxy functionality described in this PP-Module
      should be in a single TOE component. This PP-Module does not prohibit the TOE from implementing other
      security functionality in a distributed manner. 
     </sec:Overview>

    <!-- 1.2 Terms -->
    <!-- 1.2.1 Common Criteria Terms -->
      <!-- Boilerplate -->
    <!-- 1.2.2 Technology Terms  -->
    <tech-terms>
      <term full="Attribute">
        A characterization of an entity (monitored client or the server requested by a
        monitored client) used in the TLS session establishment policy or the plaintext
        processing policy implemented by the TOE that describes the entity. Common
        attributes include IP address, name, and certificates associated to an entity. </term>
      <term full="Block operation">
        A high-level operation of the TLS session establishment policy implemented
        by the TOE that prevents TLS sessions between a monitored client and the
        server requested by the client. </term>
      <term full="Bypass operation">
        A high-level operation of the TLS session establishment policy implemented
        by the TOE that allows a TLS session between a monitored client and the
        server requested by the client.
        <h:p/>
        Alternatively, an operation of the plaintext processing policy implemented by
        the TOE to bypass certain inspection processing functional components for
        plaintext data flows established under the SSL/TLS session establishment
        policy.</term>
      <term abbr="CA" full="Certificate Authority"/>
      <term abbr="HTTP" full="HyperText Transfer Protocol"/>
      <term full="Inspect operation">
        A high-level operation of the TLS session establishment policy implemented
        by the TOE that establishes a TLS session thread between a monitored client
        and a server requested by the monitored client in order to provide security
        services on the underlying plaintext application data. </term>
      <term full="Inspection processing functional components">
        A discrete set of security functions implemented within a single logical
        component, internal or external to the TOE that provides security services
        based on a plaintext data flow controlled by the TOE intended to protect a
        monitored client from defined security threats, or to enforce a defined policy
        regarding the servers allowed to be accessed by monitored clients. </term>
      <term full="Monitored Client">
        A TLS client that uses the TOE as an SSL/TLS Inspection Proxy. This device
        requires a trust anchor to be installed for the internal CA of the TOE, and
        makes SSL/TLS requests for services external to the enclave. This client makes
        SSL/TLS requests to a “requested server” through the TOE. </term>
      <term full="Requested Server">
        The target of an SSL/TLS request by a monitored client through the TOE. It is
        typically a service provider for clients using SSL/TLS. If mutual authentication
        is to be supported, this device requires a trust anchor to be installed for the
        internal CA of the TOE. </term>
      <term abbr="SSL/TLS" full="Secure Sockets Layer/Transport Layer Security">
        A set of security
        protocols defined by IETF RFCs to establish a secure point-to-point channel
        between a client and a server. The secure channel provides confidentiality,
        integrity and proof of origin to plaintext application data transferred between
        the client and server. SSL refers to early implementations of the SSL/TLS
        protocols that are deprecated. TLS refers to current versions of the SSL/TLS
        protocol.  </term>
      <term abbr="STIP" full="SSL/TLS Inspection Proxy"/>
      <term full="TLS messages">
        Specific messages defined by TLS protocol standards. The TLS messages
        addressed in this PP-Module include TLS handshake messages: Client Hello,
        Server Hello, Server Certificate, Server Key Exchange, Client Key Exchange,
        Certificate Request, Client Certificate, Client Certificate Verify, Server Finished
        and Client Finished messages. </term>
      <term full="TLS session parameters">
        The parameters of a TLS session established by the TOE for protecting thru-traffic, minimally to include: the negotiated version, negotiated cipher suite,
        the size of any key exchange values sent or received in key exchange
        messages, the server certificate received, (a reference to) the server
        certificate sent, the client certificate received, (a reference to) the client
        certificate sent, and other negotiated values determined by the TLS
        handshake that are not fixed for all TLS sessions established. </term>
      <term full="TLS session thread">
        A connection negotiated by the TOE consisting of a TLS secure point-to-point
        channel between a monitored client and the TOE, a TLS secure point-to-point
        channel between the TOE and the requested server, and any traffic flow
        containing the underlying application plaintext decrypted from one of the
        SSL/TLS channels, that is transferred within or between inspection processing
        functional components controlled by the TOE. </term>
      <term abbr="TA" full="Trust Anchor (Trust Store)"/>
      <term abbr="URL" full="Uniform Resource Locator"/>
    
    </tech-terms>
    
    <!-- 1.3 Compliant Targets of Evaluation -->
    <sec:Compliant_Targets_of_Evaluation>
      The Target of Evaluation (TOE) may be a single device or a collection of devices that interact with each
      other to meet the requirements of this PP-Module. Other network devices can be used to supplement
      inspection of plaintext traffic made available by the TOE. Such external devices will be considered as part
      of the operational environment, unless they are used to meet the requirements of this PP-Module. Audit,
      web, or directory servers providing access to certificate validity information generated by the TOE, and
      intermediate or root certification authorities that issue certificates to the TOE’s embedded certification
      authority are considered part of the operational environment and external to the TOE, but interfaces to
      these essential services which are required for operation of the TOE will be considered within the TOE
      boundary. Assurance activities to validate an interface include inspection and exercise of these interfaces
      using a specific instance of the service (audit server, web server, and external certification authority)
      implemented within the test environment.
      <h:p/>
      This PP-Module includes some functionality typical of firewalls. In particular, a device meeting this PP-Module is 
      configurable so that it can block or process TLS traffic between monitored clients and requested
      servers. It’s important to note that the device may support TLS connections for remote administration;
      these TLS connections are distinct from those between the monitored clients and requested servers, and
      must meet different requirements. In the case of an SSL/TLS inspection proxy, the primary processing is
      to inspect the TLS traffic. A TOE also has the capability of passing the TLS handshake messages intact to
      allow end-to-end TLS encrypted traffic between monitored clients and specific servers without providing
      additional services (bypass the inspection) on decrypted traffic. The decision to drop, process, or bypass
      traffic is based on IP addresses and ports, as well as on the content of TLS handshake messages, including
      the certificate of the server, and other characteristics of the traffic that might be available. A device can
      also determine which additional security services, especially those provided by external network devices,
      are applied to a particular session based on the plaintext exposed, such as HTTP headers including uniform
      resource locators (URLs), user passwords, or other sensitive information. 
      <h:p/>
      This PP-Module does not require facilitating inspection of mutually authenticated TLS sessions. It does not
      address the management of clients required to support inspection, nor requirements to avoid monitored
      clients from discovering the existence of such inspection. Processing to support Certificate Pinning is
      included as an optional requirement since establishing an inspection point prevents the monitored clients
      from doing so themselves. Similarly, management of the TOE’s certificate trust store is required, since
      monitored clients cannot block traffic from sites using certificates issued by compromised CA certificates
      after the traffic is inspected.
      
      <!-- 1.3.1 TOE Boundary -->
      <sec:TOE_Boundary>
        A STIP is one or more network devices that uses CA functionality to replace
        an end-to-end TLS session with a TLS session between the STIP and a monitored client and another TLS
        session between the STIP and the TLS endpoint requested by the monitored client (the requested server).
        Additional functionality within the same network component as STIP functionality, or via external network
        devices, can be used to perform network security services, such as performing intrusion detection or
        providing reputation services on the plaintext traffic made available by the TOE. This functionality, while
        enabled by the TOE is out of scope. However, protecting and separating traffic flows of plaintext to or
        between discrete functional components performing such network security services is required and
        considered within the TOE. If the TOE provides an external interface to plaintext traffic for additional
        network security services, the entirety of all external processing will be considered a single functional
        component – the TOE is not responsible for controlling the flow of traffic among external systems. 
        <h:p/>
        All functionality described by the SFRs are within the TOE boundary, as is the ability for the TSF to establish
        secure remote connections with trusted entities in the Operational Environment (OE).
        
        <figure entity="images/Toe.png" title="TLS Inspection Infrastructure" id="toe"/>
        
        <h:p/>
        As can be seen from this figure, the TOE sits between a monitored client and requested server in order to
        intercept TLS traffic between them. For connections subject to inspection, the TOE will replace the end-to-end TLS session between the monitored client and requested server and establish a TLS session thread
        in order to forward the plaintext application traffic to one or more inspection processing functional
        components in the operational environment for inspection. The TSF provides an embedded CA that is
        used to reconstruct the TLS channel and pass it to its intended destination in an encrypted format. The
        embedded CA provides certificates it issues to an (external) certificate repository and provides certificate
        status information to an (internal or external) certificate status presentation mechanism.
 
      </sec:TOE_Boundary>
    </sec:Compliant_Targets_of_Evaluation>
    
    <!-- 1.4 Use Cases -->
    <!-- note: this section formatted a little different from its depiction in 1.0 because of schema constraints -->
    <sec:Use_Cases>
      <h:p>
      Requirements in this PP-Module are designed to address the security problem in the following use cases.
      The description of these use cases provide instructions for how the TOE and its OE should be made to
      support the functionality required by this PP-Module.
      </h:p><h:p>
      This PP-Module permits the inspection of mutually-authenticated TLS sessions between monitored clients
      and requested servers via exception processing. However, as a best practice, it is recommended instead
      that this behavior be handled as part of the TLS Inspection Bypass and/or TLS Session Blocking
      functionality. If the TOE provides inspection processing for mutually authenticated traffic, the ST must
      claim these optional SFRs.
      </h:p><h:p>
      This PP-Module does not specify routing policies for non-TLS traffic and exception processing should not
      be used to address functionality otherwise included in the collaborative Protection Profile Module for Stateful
      Traffic Filter Firewalls.
      </h:p><h:p>
        The TOE functions as a TLS forward proxy for the following operations:
      </h:p>
      
      <usecases>
        <usecase id="usecase1" title="Inspection Operation">
          <description>
            The TOE intercepts traffic authorized for inspection from monitored clients requesting a server-only authenticated TLS session with a requested server. The TOE initiates a TLS session with the
            requested server and validates the requested server’s certificate as legitimately issued by a
            trusted element of its trust store. The TOE authenticates the server on behalf of the client and
            generates a certificate that indicates the TOE is an authorized proxy for the requested server. The
            certificate is issued by the TOE’s embedded CA, which is trusted by the monitored client. The TOE
            establishes a valid TLS session with the monitored client using the issued certificate. Any TLS traffic
            between the monitored client and the requested server is decrypted by the TOE and assigned to 
            a unique TLS session thread that is routed to one or more inspection processes, and encrypted
            into the respective TLS sessions. 
			</description>
        </usecase>
        
        <usecase id="usecase2" title="TLS Bypass Operation">
          <description>
            The TOE determines that TLS traffic between a monitored client and a requested server is not to
            be decrypted for inspection, and routes the TLS handshake messages without modification.
          </description>
        </usecase>

        <usecase id="usecase3" title="TLS Blocking Operation">
          <description>
            The TOE determines that a TLS session between a monitored client and a requested server is not
            authorized, and then performs a blocking operation that refuses to pass the attempted TLS traffic.
            In addition to dropping and logging of incoming TLS messages, an error response to the client may
            be provided. The blocking operation may be invoked during the initial TLS handshake, or during
            the processing of decrypted traffic obtained as part of an inspection operation. In the latter case,
            a transition from inspection operation to blocking operation includes termination of the TLS
            session thread.
          </description>
        </usecase>
        
        <usecase id="usecase4" title="Exception Processing">
          <description>
            The TOE supports allowances for inspection of TLS sessions using outdated TLS versions, cipher
            suites, or key exchange values, and for servers using invalid certificates. These are managed such
            that monitored clients, requested servers, or (optionally) specific client-server pairs can be
            associated with allowed TLS versions, cipher suites, and key exchange values.
          </description>
        </usecase>

      </usecases>


  </sec:Use_Cases> 

  </sec:Introduction>
  
  <!-- 2. Conformance Claims -->
  <section title="Conformance Claims" id="ConformanceClaims">
    
    <!-- 2.1 CC Conformance -->
    <cclaims>
      <cclaim name="Conformance Statement">
        <description> This PP-Module inherits exact conformance as required from the specified Base-PPs and as defined
          in the CC and CEM addenda for Exact Conformance, Selection-Based SFRs, and Optional SFRs (dated
          May 2017).<h:br/><h:br/> 
          
          The following PPs and PP-Modules are allowed to be specified in a PP-Configuration with this PP-Module:
          <h:ul>
            <h:li>collaborative Protection Profile Module for Stateful Traffic Filter Firewalls, v1.4 + Errata 20200625</h:li>
          </h:ul>

        </description>
      </cclaim>
      <cclaim name="CC Conformance Claims">
        <description>
          This PP-Module is conformant to Parts 2 (extended) and 3 (conformant) of Common Criteria Version
          3.1, Revision 5 [CC].
        </description>
      </cclaim>
      <cclaim name="PP Claim">
        <description>This PP-Module does not claim conformance to any Protection Profile.</description>
      </cclaim>
      <cclaim name="Package Claim">
        <description>This PP-Module does not claim conformance to any packages.</description>
      </cclaim>
    </cclaims>
  </section>
    
  <!-- Security Problem Description -->
  <sec:Security_Problem_Description>
    The security problem is described in terms of the threats that the TOE is expected to address,
assumptions about its operational environment, and any organizational security policies that the TOE is
expected to enforce.<h:p/>
    A STIP is a network device that embeds limited CA functionality to support the
    replacement of end-to-end TLS sessions with TLS session threads, making the underlying plaintext
    available to additional network security functionality. As such, it exposes data within the TOE boundary,
    and to external processes, which would normally be encrypted. It manages a CA signing key that is trusted
    by the monitored clients to issue TLS server certificates representing the requested servers for which
    inspection is authorized.
    <h:p/>
    The proper installation and configuration of the VPN client is critical to its correct operation such that
    proper handling of the TOE by an administrator is also addressed.<h:p/>
    Note that as a PP-Module, all threats, assumptions, and OSPs defined in the Base-PP will also apply to a
    TOE unless otherwise specified, depending on which of the Base-PPs it extends. The Security Functional
    Requirements defined in this PP-Module will mitigate the threats that are defined in the PP-Module but
    may also mitigate some threats defined in the Base-PPs in more comprehensive detail due to the
    specific capabilities provided by a VPN client.
    
    <!-- 3.1 Threats -->
    <section title="Threats" id="threats">
      The following threats defined in this PP-Module extend the threats defined by the Base-PP.
      <threats>
        <threat name="T.UNTRUSTED_COMMUNICATION">
          <description>Untrusted intermediate systems have access to provide unauthorized communications to the TOE, or
            to manipulate authorized TLS messages in an attempt to compromise the TOE, the monitored clients,
            or the requested servers. Within this PP-Module, the focus is on an adversary that controls or exploits
            a requested server that may attempt to cause the device to inappropriately bypass inspection.
            <h:p/>
            Use of weak cryptography can allow adversary access to plaintext intended by the monitored clients
            to be encrypted. Such access could disclose user passwords that facilitate additional activities against
            users of monitored clients. Within this PP-Module, the focus is on the use of weak cryptography and
            adversary attempts to degrade the cryptographic operations within the TLS protocol.
            <h:p/>
            External network security devices may communicate with the TOE to apply security services to the
            exposed plaintext. An adversary may attempt to gain access the plaintext via misrouting of traffic or
            manipulate the traffic in such a way as to cause unauthorized exposure, denial of service, or
            corruption of the underlying plaintext. </description>
          <objective-refer ref="O.PROTECTED_COMMUNICATIONS">
            <rationale>Data traversing the TOE is subject to authenticity and integrity verification.
            </rationale>
          </objective-refer>
        </threat>

        <threat name="T.AUDIT">
          <description> Certificates issued by the device are trusted by monitored clients, and are required for analysis if
            traffic processed by the device causes the client to fail or become compromised. Unknown activity
            related to the issuance and use of certificates can allow an adversary to mask client exploits through
            or via the TOE, especially if the device fails before the incident can be understood. Unknown activity
            associated to routing configurations, communications with the TOE, as well as the decision to bypass
            inspection of traffic can allow an adversary to mask attempts to access monitored clients. </description>
          <objective-refer ref="O.AUDIT_LOSS_RESPONSE">
            <rationale>
              The TOE provides mechanisms to
              deal with audit trails being
              unavailable.
            </rationale>
          </objective-refer>
          <!-- 
          <objective-refer ref="O.AUDIT_PROTECTION">
            <rationale>
              Audit records are protected from
              modification, deletion, and
              unauthorized access.
            </rationale>
          </objective-refer>
           -->
          <objective-refer ref="O.SYSTEM_MONITORING">
            <rationale>
              Audit records contain the
              information necessary to determine
              cause for concerns.
            </rationale>
          </objective-refer>
          <objective-refer ref="OE.AUDIT">
            <rationale>
              Storage within an external audit
              server provides increased record
              capacity.
            </rationale>
          </objective-refer>
          <objective-refer ref="OE.CERT_REPOSITORY">
            <rationale>
              The certificate repository provides a
              comprehensive set of certificates
              generated by the TOE that can be
              searched.
            </rationale>
          </objective-refer>
          <objective-refer ref="OE.CERT_REPOSITORY_SEARCH">
            <rationale>
              Ability to search the audit trail for
              certificate related events provides
              confidence in certificate validity and
              proper use.
            </rationale>
          </objective-refer>
        </threat>

        <threat name="T.UNAUTHORIZED_USERS">
          <description>In addition to managing administrative credentials, authorized users may have role restrictions to limit
            their access to the device’s certification authority functionality. In addition to the threat of disclosure
            or modification of authorized user credentials to users without authorized access to the device, a user
            with limited access might attempt to extend their access by gaining access to other user’s credentials.
          </description>
          <objective-refer ref="O.TOE_ADMINISTRATION">
            <rationale>Use of role separation and
              authentication mechanisms ensure
              that only authorized users can
              access the TOE.</rationale>
          </objective-refer>
        </threat>

        <threat name="T.CREDENTIALS">
          <description> 
            In addition to device credentials used in protected communications, 
            the device maintains a trusted certification authority signing key. 
            A malicious user or flawed TOE implementation may cause the disclosure or unauthorized manipulation of the signing key 
            which can result in unintended certificates, signed executables, 
            or signed data that would be trusted by monitored clients. 
            Any modification of the signing key can result in denial of service to inspection capabilities, or to the monitored clients.
          </description>
          <objective-refer ref="O.CERTIFICATES">
            <rationale>
              The TOE tracks certificates,
              certificate revocation lists, and
              certificate status information used
              by the TSF.
            </rationale>
          </objective-refer>
          <objective-refer ref="O.PERSISTENT_KEY_PROTECTION">
            <rationale>
              Keys stored on the TOE are
              protected from unauthorized use
              and disclosure.
            </rationale>
          </objective-refer>
          <objective-refer ref="OE.CERT_REPOSITORY">
            <rationale>
              A certificate repository for all
              certificates issued by the TOE is
              provided, making verification
              straightforward.
            </rationale>
          </objective-refer>
        </threat>
        
        <threat name="T.SERVICES">
          <description>Manipulation of the device can result in issued certificates being used for unauthorized purposes or
            abuse of inspection services. An authorized user (AU) (or adversary able to gain access to AU
            credentials) can access or misuse device services, or disclose sensitive or security critical data.
          </description>
          <objective-refer ref="O.CERTIFICATES">
            <rationale>
              The TOE verifies certificates,
              certificate revocation lists, and
              certificate status information prior
              to any use.
            </rationale>
          </objective-refer>
          <objective-refer ref="O.PROTECTED_COMMUNICATIONS">
            <rationale>
              Data traversing the TOE is subject to
              authenticity, confidentiality, and
              integrity verification.
            </rationale>
          </objective-refer>
          <objective-refer ref="O.TOE_ADMINISTRATION">
            <rationale>
              Use of role separation and
              authentication mechanisms
              mitigates the risk of misuse and
              improper disclosure.
            </rationale>
          </objective-refer>
            <objective-refer ref="OE.TRUSTED_ADMIN">
              <rationale>
                Granting TOE access only to trusted administrators mitigates the threat of careless or malicious manipulation of the TSF.
              </rationale>
            </objective-refer>
        </threat>
        
        <threat name="T.DEVICE_FAILURE">
          <description>Failure of the certification authority component can result in unauthorized or improperly constrained
            certificates, or the inability to properly manage the validity of issued certificates. Failure of routing
            traffic to inspection processing (internal or external) can result in unauthorized disclosure or
            modification of traffic, or denial of service to monitored clients.
          </description>
          <objective-refer ref="O.CERTIFICATES">
            <rationale>
              The TOE verifies certificates,
              certificate revocation lists, and
              certificate status information are
              valid.
            </rationale>
          </objective-refer>
          <objective-refer ref="O.INTEGRITY_PROTECTION">
            <rationale>
              Software, TSF, and user data are
              protected via integrity mechanisms.
            </rationale>
          </objective-refer>
          <objective-refer ref="O.PERSISTENT_KEY_PROTECTION">
            <rationale>
              Keys stored on the TOE are
              protected from unauthorized use
              and disclosure.
            </rationale>
          </objective-refer>
          <objective-refer ref="O.RECOVERY">
            <rationale>
              Administrators have the ability to
              restore the TOE to a previous
              (known-good) state.
            </rationale>
          </objective-refer>
        </threat>
        
        <threat name="T.UNAUTHORIZED_DISCLOSURE">
          <description>In addition to general threats to network devices, the TOE controls access to sensitive data that is
            intended by the monitored client to be encrypted. A malicious user or flawed TOE implementation could cause data to be transmitted 
            in cleartext for which a user has a reasonable expectation of confidentiality.
          </description>
          <objective-refer ref="O.PROTECTED_COMMUNICATIONS">
            <rationale>
              Data traversing the TOE is subject to
              authenticity, confidentiality, and
              integrity verification.
            </rationale>
          </objective-refer>
          <objective-refer ref="O.TOE_ADMINISTRATION">
            <rationale>
              Use of role separation and
              authentication mechanisms
              mitigates the risk of misuse and
              ensures the device is properly
              managed.
            </rationale>
          </objective-refer>
        </threat>
        
        <threat name="T.INAPPROPRIATE_ACCESS">
          <description>Decryption services applied to traffic between monitored clients and unintended servers can violate
            privacy laws, or disclose unauthorized traffic to inspection processes. Certification authority signature
            applied to unauthorized data could facilitate adversary exploits of monitored clients.
          </description>
          <objective-refer ref="O.RESIDUAL_INFORMATION_CLEARING">
            <rationale>
              The TOE’s lack of residual data
              retention ensures that
              unauthorized access to information
              is not possible.
            </rationale>
          </objective-refer>
          <objective-refer ref="O.TOE_ADMINISTRATION">
            <rationale>
              Use of role separation and
              authentication mechanisms
              mitigates the risk of misuse and
              improper disclosure.
            </rationale>
          </objective-refer>
          <objective-refer ref="O.TRAFFIC_MONITORING">
            <rationale>
              Enforcement of policies for traffic monitoring
              ensure that unauthorized data is not subject to transmission through the TOE.
            </rationale>
          </objective-refer>
          <!-- 
          <objective-refer ref="OE.RESIDUAL_INFORMATION">
            <rationale>
              Sensitive information residing
              within the operational
              environment, such as keys and
              decrypted data, are unavailable.
            </rationale>
          </objective-refer> -->
        </threat>
        
      </threats>
    </section>
    
    <!-- 3.2 Assumptions -->
    <sec:Assumptions>
      <!-- Note: updated this section to be more in line with how these are done now. We don't want to use refinements on assignments because then multiple simultaneous PP-Module claims could cause mutually exclusive changes. -->
      <!-- Do we care that these assumptions now do not show up in the rationale mapping table now (because that table is only populated off of actual <assumption> elements below, which we don't have) -->
      These assumptions are made on the Operational Environment in order to be able to ensure that the security functionality specified in the PP-Module can be provided by the TOE. 
      If the TOE is placed in an Operational Environment that does not meet these assumptions, the TOE may no longer be able to provide all of its security functionality.
      <h:p/>
      All assumptions for the operational environment of the Base-PP also apply to this PP-Module.
      <h:p/>
      A.LIMITED_FUNCTIONALITY is still operative, but the assumed functionality of the TOE includes the behavior needed to satisfy the functional claims of this PP-Module.
      <h:p/>
      A.NO_THRU_TRAFFIC_PROTECTION is still operative, but only for the interfaces in the TOE that are defined by the Base-PP and not the PP-Module.
      <h:p/>
      A.TRUSTED_ADMINISTRATOR is still operative, but the functional claims of this PP-Module offer a limited ability to protect against malicious administrators, which is not within the scope of the original assumption.
      <h:p/>
      A.RESIDUAL_INFORMATION is still operative, but the residual information is expanded to include information relevant to STIP operation (e.g. decrypted SSL/TLS payload, ephemeral keys).
      <h:br/><h:br/>
      <assumptions/>
    </sec:Assumptions>
    
    <!-- 3.3 Organizational Security Policies -->
	<sec:Organizational_Security_Policies>
<!--  Note: Need to have the ability to insert freeform text at he start of the OSP section. Module 1.0 describes how the P.ACCESS_BANNER OSP is applied to a STIP TOE and we don't currently have the ability to do that. -->
	  <!-- Do we care that P.BANNER does not show up in the rationale mapping table now (because that table is only populated off of actual <OSP> elements below) -->
	  
		<OSPs>
		  <OSP name="P.AUTHORIZATION_TO_INSPECT">
		    <description>
		      The authority to inspect client traffic may be limited by law, regulation, or policies based on the
		      monitored client, requested server, or nature of the traffic. 
		      The TOE may be required to additionally provide a consent to monitor notice for users whose traffic is inspected by the device, 
		      if the monitored client might not provide such a banner.
		    </description>
		    <objective-refer ref="O.DISPLAY_BANNER">
		      <rationale>The TOEs advisory warning includes
		        consent to monitor.</rationale>
		    </objective-refer>
		    <objective-refer ref="O.PROTECTED_COMMUNICATIONS">
		      <rationale>The TSF ensures that data
		        traversing the TOE boundary is
		        protected, alleviating concerns
		        about inspection.</rationale>
		    </objective-refer>
		    <objective-refer ref="O.TOE_ADMINISTRATION">
		      <rationale>Administrator roles provide
		        separation of activities and ensure
		        inspection is authorized and
		        performed properly.</rationale>
		    </objective-refer>
		  </OSP>
		  		</OSPs>
    </sec:Organizational_Security_Policies>
  </sec:Security_Problem_Description>
    
  <!-- 4. Security Objectives --> 
  <sec:Security_Objectives>  
<!--  <section title="Security Objectives" id="obj"> -->
    
    <!-- 4.1 Security Objectives for the TOE -->
    <sec:Security_Objectives_for_the_TOE>
      <SOs>
        <SO name="O.AUDIT_LOSS_RESPONSE">
          <description>The TOE will respond to possible loss of audit records when an audit trail cannot be written to by
            restricting auditable events.<h:p/>
			      Addressed by: FAU_STG.4
          </description>
    
       <addressed-by>FAU_STG.4</addressed-by>
			<rationale>This SFR supports the objective by requiring the TSF to disable the execution of auditable events if the audit trail cannot be written to.</rationale>
      </SO>
        
        <!-- 
        <SO name="O.AUDIT_PROTECTION">
          <description>The TOE will protect audit records against unauthorized access, modification, or deletion to ensure
            accountability of user actions.<h:p/>
			  Addressed by: FAU_STG.1 (from Base-PP), FAU_SAR.1 (optional) 
		  </description>
		  
          <addressed-by>FAU_STG.1 (from Base-PP)</addressed-by>
			<rationale>This SFR supports the objective by ensuring that stored audit records are protected against unauthorized modification or destruction.</rationale>
          <addressed-by>FAU_SAR.1 (optional)</addressed-by>
			<rationale>This SFR supports the objective by ensuring that stored audit records are protected against unauthorized access. </rationale>
        </SO>
        -->
        
        <SO name="O.CERTIFICATES">
          <description>The TSF must ensure that certificates, certificate revocation lists, and certificate status information
            are valid.<h:p/>
            Addressed by: FCS_TLSC_EXT.1 (from Base-PP), FCS_TLSC_EXT.2 (from Base-PP), FIA_X509_EXT.1/Rev (from Base-PP), FIA_X509_EXT.3 (from Base-PP), FDP_CER_EXT.1, FDP_CER_EXT.2, FDP_CER_EXT.3, FDP_CSIR_EXT.1, FIA_ENR_EXT.1, FIA_X509_EXT.1/STIP, FIA_X509_EXT.2/STIP,
            FDP_PIN_EXT.1 (optional), FIA_ESTC_EXT.2 (optional), FDP_CER_EXT.4 (selection-based), 
            FDP_CER_EXT.5 (selection-based), FDP_CRL_EXT.1 (selection-based),
			FDP_CSI_EXT.1 (selection-based), FDP_CSI_EXT.2 (selection-based), FDP_OCSP_EXT.1 (selection-based), FDP_OCSPS_EXT.1 (selection-based), FIA_ESTC_EXT.1 (selection-based)    
          </description>
          <addressed-by>FCS_TLSC_EXT.1 (from Base-PP)</addressed-by>
          <rationale>This SFR supports the objective because TLS is a mechanism by which its own certificate data may be obtained from an external CA. </rationale>
          <addressed-by>FCS_TLSC_EXT.2 (from Base-PP)</addressed-by>
          <rationale>This SFR supports the objective because mutually-authenticated TLS is a mechanism by which its own certificate 
            data may be obtained from an external CA. </rationale>
          <addressed-by>FIA_X509_EXT.1/Rev (from Base-PP)</addressed-by>
            <rationale>This SFR supports the objective by defining the TOE functionality for certificate validation. </rationale>
            <addressed-by>FIA_X509_EXT.3 (from Base-PP)</addressed-by>
            <rationale>This SFR supports the objective by defining the mechanism by which the TOE generates certificate signing requests, which includes validation of the certificate provided in response. </rationale>
            <addressed-by>FDP_CER_EXT.1</addressed-by>
            <rationale>This SFR supports the objective by defining the rules the TOE must use to generate and issue proxy TLS server certificates from its internal CA. </rationale>
            <addressed-by>FDP_CER_EXT.2</addressed-by>
            <rationale>This SFR supports the objective by requiring the TOE to link the certificates presented for TLS connectivity with the certificates it issues from its internal CA. </rationale>
            <addressed-by>FDP_CER_EXT.3</addressed-by>
            <rationale>This SFR supports the objective by defining the rules for the TOE's issuing of proxy TLS server certificates. </rationale>
            <addressed-by>FDP_CSIR_EXT.1</addressed-by>
            <rationale>This SFR supports the objective by defining how the TOE can ensure the use of fresh certificates.</rationale>
            <addressed-by>FIA_ENR_EXT.1</addressed-by>
            <rationale>This SFR supports the objective by defining the mechanism by which the TOE requests a certificate for its own embedded CA's signing key. </rationale>
            <addressed-by>FIA_X509_EXT.1/STIP</addressed-by>
            <rationale>This SFR supports the objective by defining the certificate validation rules that must be followed for certificates that are used for proxy TLS connections. </rationale>
          <addressed-by>FIA_X509_EXT.2/STIP</addressed-by>
          <rationale>This SFR supports the objective by defining the certificate authentication behavior for STIP connections. </rationale>
          <addressed-by>FDP_PIN_EXT.1 (optional)</addressed-by>
            <rationale>This SFR supports the objective by defining the optional implementation of certificate pinning. </rationale>
            <addressed-by>FIA_ESTC_EXT.2 (optional)</addressed-by>
            <rationale>This SFR supports the objective by defining requirements for the composition of EST requests if the TOE supports EST. </rationale>
            <addressed-by>FDP_CER_EXT.4 (selection-based)</addressed-by>
            <rationale>This SFR supports the objective by defining the rules the TOE must use to generate and issue proxy TLS client certificates from its internal CA if mutual authentication is supported. </rationale>
            <addressed-by>FDP_CER_EXT.5 (selection-based)</addressed-by>
            <rationale>This SFR supports the objective by defining the rules for the TOE's issuing of proxy TLS client certificates if mutual authentication is supported. </rationale>
            <addressed-by>FDP_CRL_EXT.1 (selection-based)</addressed-by>
            <rationale>This SFR supports the objective by defining rules for the generation of CRLs if the TOE uses this as the mechanism to ensure the freshness of its issued certificates. </rationale>
            <addressed-by>FDP_CSI_EXT.1 (selection-based)</addressed-by>
            <rationale>This SFR supports the objective by defining the revocation echecking method supported by the TOE for the proxy TLS server certificates it issues, if revocation is how the freshness of its issued certificates is assured. </rationale>
            <addressed-by>FDP_CSI_EXT.2 (selection-based)</addressed-by>
          <rationale>This SFR supports the objective by defining the revocation echecking method supported by the TOE for the proxy TLS client certificates it issues, if mutual authentication is supported and revocation is how the freshness of its issued certificates is assured. </rationale>
            <addressed-by>FDP_OCSP_EXT.1 (selection-based)</addressed-by>
          <rationale>This SFR supports the objective by defining rules for the generation of OCSP responses if the TOE uses this as the mechanism to ensure the freshness of its issued certificates. </rationale>
            <addressed-by>FDP_OCSPS_EXT.1 (selection-based)</addressed-by>
            <rationale>This SFR supports the objective by defining rules for the implementation of OCSP stapling if the TOE supports this functionality. </rationale>
            <addressed-by>FIA_ESTC_EXT.1 (selection-based)</addressed-by>
            <rationale>This SFR supports the objective by defining requirements for the implementation of EST if the TOE uses this mechanism to obtain TLS certificates for its own use. </rationale>
        </SO>
        
        
        <SO name="O.DISPLAY_BANNER">
          <description>The TOE will display an advisory warning regarding use of the TOE. <h:p/>
            Addressed by: FTA_TAB.1 (from Base-PP), FDP_STIP_EXT.1, FTA_TAB.1/TLS (selection-based)
          </description>
		  
			<addressed-by>FTA_TAB.1 (from Base-PP)</addressed-by>
			<rationale>This SFR supports the objective by applying a warning banner to any interface used by an administrator to access the TOE.</rationale>
          <addressed-by>FDP_STIP_EXT.1</addressed-by>
          <rationale>This SFR supports the objective by defining the mechanism used to 
            obtain consent to monitor user communications.</rationale>
          <addressed-by>FTA_TAB.1/TLS (selection-based)</addressed-by>
			<rationale>This SFR supports the objective by optionally applying a warning banner to a user whose network activity passes through the TOE for decryption and potential inspection.</rationale>
        </SO>
        
        <SO name="O.INTEGRITY_PROTECTION">
          <description>The TOE will provide appropriate integrity protection for TSF data and software and any user data
            stored by the TOE.<h:p/>
            Addressed by: FPT_FLS.1
          </description>
          
          
          <addressed-by>FPT_FLS.1</addressed-by>
          <rationale>This SFR supports the objective by requiring the TSF to take some action to preserve a 
            secure state in the response to a loss of integrity or other potential failure.</rationale>
        </SO>
        
        
        <SO name="O.PERSISTENT_KEY_PROTECTION">
          <description>
            The TOE will provide appropriate confidentiality and access protection to persistent keys and security
            critical parameters stored by the TOE.
            <h:p/>
            Addressed by: FCS_STG_EXT.1, FDP_STG_EXT.1, FPT_KST_EXT.1, FPT_KST_EXT.2, FCS_CKM_EXT.5 (selection-based)
          </description>
          <addressed-by>FCS_STG_EXT.1</addressed-by>
          <rationale>This SFR supports the objective by requiring the TOE to implement hardware-based protection for stored keys.</rationale>
          <addressed-by>FDP_STG_EXT.1</addressed-by>
          <rationale>This SFR supports the objective by defining the mechanism used to protect public key data from unauthorized modification.</rationale>
          <addressed-by>FPT_KST_EXT.1</addressed-by>
          <rationale>This SFR supports the objective by requiring the TSF to enforce the prevention of plaintext key export.</rationale>
          <addressed-by>FPT_KST_EXT.2</addressed-by>
          <rationale>This SFR supports the objective by preventing the unauthorized use of secret and private keys.</rationale>
          <addressed-by>FCS_CKM_EXT.5 (selection-based)</addressed-by>
          <rationale>This SFR supports the objective by defining the integrity mechanism used to guarantee the integrity of public key data.</rationale>
          
        </SO>
        
        <SO name="O.PROTECTED_COMMUNICATIONS">
          <description>
            The TOE will provide protected communication channels for administrators, other parts of a
            distributed TOE, and authorized IT entities. The TOE will protect data assets when they are being
            transmitted to and from the TOE, including through intervening untrusted components.
            <h:p/>
            Addressed by: FCS_CKM.4 (from Base-PP), FCS_TLSC_EXT.1 (from Base-PP), FCS_TLSC_EXT.2 (from Base-PP), FTP_ITC.1 (refined from Base-PP), 
            FCS_COP.1/STIP, FCS_TTTC_EXT.1, FCS_TTTC_EXT.5, FCS_TTTS_EXT.1, FDP_PRC_EXT.1, FDP_STIP_EXT.1, FDP_TEP_EXT.1,
            FCS_TTTC_EXT.3 (selection-based), FCS_TTTC_EXT.4 (selection-based), FCS_TTTS_EXT.3
            (selection-based), FCS_TTTS_EXT.4 (selection-based), FDP_STIP_EXT.2 (selection-based)
          </description>
          <addressed-by>FCS_CKM.4 (from Base-PP)</addressed-by>
          <rationale>This SFR supports the objective by ensuring secret and private key data is disposed of immediately after use to prevent unauthorized disclosure of keys.</rationale>
          <addressed-by>FCS_TLSC_EXT.1 (from Base-PP)</addressed-by>
          <rationale>This SFR supports the objective by defining the TLS trusted channel used for EST if the TOE supports that functionality.</rationale>
          <addressed-by>FCS_TLSC_EXT.2 (from Base-PP</addressed-by>
          <rationale>This SFR supports the objective by defining support for mutually-authenticated TLS, which the TOE may optionally support for EST.</rationale>
          <addressed-by>FTP_ITC.1 (refined from Base-PP)</addressed-by>
          <rationale>This SFR supports the objective by defining the TOE interfaces that require protected communications as well as the methods of protection applied to these interfaces.</rationale>
          <addressed-by>FCS_COP.1/STIP</addressed-by>
          <rationale>This SFR supports the objective by defining cryptographic algorithms the TOE must support for decryption and re-encryption of proxy TLS traffic.</rationale>
          <addressed-by>FCS_TTTC_EXT.1</addressed-by>
          <rationale>This SFR supports the objective by defining requirements for the TOE's implementation of TLS as a client, specifically in the case where the TOE is establishing a proxy connection between itself and the original requested 
          TLS server.</rationale>
          <addressed-by>FCS_TTTC_EXT.5</addressed-by>
          <rationale>This SFR supports the objective by defining the Supported Groups used by the TOE's proxy TLS client interface.</rationale>
          <addressed-by>FCS_TTTS_EXT.1</addressed-by>
          <rationale>This SFR supports the objective by defining requirements for the TOE's implementation of TLS as a server, specifically in the case where the TOE is establishing a proxy connection between itself and the original monitored 
            TLS client.</rationale>
          
          <addressed-by>FDP_PRC_EXT.1</addressed-by>
          <rationale>This SFR supports the objective by defining requirements for the routing of decrypted plaintext traffic.</rationale>
          <addressed-by>FDP_STIP_EXT.1</addressed-by>
          <rationale>This SFR supports the objective by defining the TOE's ability to establish proxy TLS sessions between a monitored client and a requested server and to apply appropriate rules to the handling of the decrypted traffic.</rationale>
          <addressed-by>FDP_TEP_EXT.1</addressed-by>
          <rationale>This SFR supports the objective by defining the TOE's abbility to enforce filtering rules on TLS traffic passing through the TOE.</rationale>
          <addressed-by>FCS_TTTC_EXT.3 (selection-based)</addressed-by>
          <rationale>This SFR supports the objective by defining optional support for TLS mutual authentication that is applied to the TOE's proxy TLS client interface.</rationale>
          <addressed-by>FCS_TTTC_EXT.4 (selection-based)</addressed-by>
          <rationale>This SFR supports the objective by defining optional support for TLS session renegotiation that is applied to the TOE's proxy TLS client interface.</rationale>
          <addressed-by>FCS_TTTS_EXT.3 (selection-based)</addressed-by>
          <rationale>This SFR supports the objective by defining optional support for TLS mutual authentication that is applied to the TOE's proxy TLS server interface.</rationale>
          <addressed-by>FCS_TTTS_EXT.4 (selection-based)</addressed-by>
          <rationale>This SFR supports the objective by defining optional support for TLS session renegotiation that is applied to the TOE's proxy TLS server interface.</rationale>
          <addressed-by>FDP_STIP_EXT.2 (selection-based)</addressed-by>
          <rationale>This SFR supports the objective by defining the optional capability of the TOE to establish a proxy TLS session in the case where mutual authentication is supported.</rationale>
        </SO>
        
        
        <SO name="O.RECOVERY">
          <description>
            The TOE will have the ability to store and recover to a previous state at the direction of the
            administrator (e.g., provide support for archival and recovery capabilities).
            <h:p/>
            Addressed by: FPT_FLS.1, FPT_RCV.1
          </description>
          <addressed-by>FPT_FLS.1</addressed-by>
          <rationale>This SFR supports the objective by requiring the TSF to preserve a secure state when certain failures occur.</rationale>
          <addressed-by>FPT_RCV.1</addressed-by>
          <rationale>This SFR supports the objective by requiring the TSF to support a maintenance mode of operation that is entered when certain failures occur.</rationale>
        </SO>
        
        <SO name="O.RESIDUAL_INFORMATION_CLEARING">
          <description>
            The TOE will ensure that any data contained in a protected resource is not available when the resource
            is reallocated.
            <h:p/>
            Addressed by: FDP_RIP.1
          </description>
          <addressed-by>FDP_RIP.1</addressed-by>
          <rationale>This SFR supports the objective by defining the residual data that is cleared from TOE memory and when the clearing occurs.</rationale>
        </SO>
        
        <SO name="O.SYSTEM_MONITORING">
          <description>
            The TOE will provide the ability to generate audit data and send that data to an external IT entity. The
            TOE will record in audit records: date and time of action and the entity responsible for the action. The
            TOE will provide the ability to store and review certificate information.
            <h:p/>
            Addressed by: FAU_SAR.1 (optional), FAU_STG_EXT.1 (from Base-PP), FAU_GEN.1/STIP, FAU_GCR_EXT.1, FAU_SAR.3
            (optional), FAU_SCR_EXT.1 (selection-based)
          </description>
          <addressed-by>FAU_STG_EXT.1 (from Base-PP)</addressed-by>
          <rationale>This SFR supports the objective by defining a mechanism for the secure storage of audit data in the OE.</rationale>
          <addressed-by>FAU_GEN.1/STIP</addressed-by>
          <rationale>This SFR supports the objective by defining the auditable events specific to STIP functionality that the TSF must generate.</rationale>
          <addressed-by>FAU_GCR_EXT.1</addressed-by>
          <rationale>This SFR supports the objective by defining the mechanism the TOE uses to store certificate data.</rationale>
          <addressed-by>FAU_SAR.3 (optional)</addressed-by>
          <rationale>This SFR supports the objective by optionally defining the functionality to search audit records for events associated with a particular certificate.</rationale>
          <addressed-by>FAU_SCR_EXT.1 (selection-based)</addressed-by>
          <rationale>This SFR supports the objective by requiring the TOE to implement a search function for certificate storage if the TSF implements its own certificate store (as opposed to relying on environmental storage).</rationale>
        </SO>
        
        <SO name="O.TOE_ADMINISTRATION">
          <description>
            The TOE will provide mechanisms to ensure that only privileged users are able to log in and configure
            the TOE, and provide protections for logged-in users. The TOE will ensure that administrative
            responsibilities are separated across different roles in order to mitigate the impact of improper
            administrative activities or unauthorized administrative access.
            <h:p/>
            Addressed by: FMT_SMR.2 (from Base-PP), FMT_MOF.1/STIP, FMT_SMF.1/STIP
          </description>
          <addressed-by>FDP_SMR.2 (from Base-PP)</addressed-by>
          <rationale>This SFR supports the objective by defining additional management roles that the TOE may support that are specific to STIP functionality.</rationale>
          <addressed-by>FMT_MOF.1/STIP</addressed-by>
          <rationale>This SFR supports the objective by defining the authorized use of the TOE by association between the supported management functions and the roles that are authorized to perform them.</rationale>
          <addressed-by>FMT_SMF.1/STIP</addressed-by>
          <rationale>This SFR supports the objective by defining the TOE's management functions that are specific to STIP functionality.</rationale>
          
        </SO>
        
        
        <SO name="O.TRAFFIC_MONITORING">
          <description>
            The TOE will provide a mechanism for processing SSL/TLS traffic. This mechanism requires the TOE to enforce a policy to process encrypted traffic, which
            results in the traffic being allowed, blocked, or decrypted for further inspection. This mechanism also requires the TOE to enforce a policy to process decrypted traffic,
            which may be inspected for unauthorized content either by the TOE itself or through an interface with an external inspection component.
            <h:p/>
            Addressed by: FDP_PPP_EXT.1, FDP_TEP_EXT.1
          </description>
          <addressed-by>FDP_PPP_EXT.1</addressed-by>
          <rationale>This SFR supports the objective by defining the processing rules that the TOE applies to plaintext traffic once decrypted.</rationale>
          <addressed-by>FDP_TEP_EXT.1</addressed-by>
          <rationale>This SFR supports the objective by defining the processing rules that the TOE applies to encrypted traffic.</rationale>
        </SO>
      </SOs>
    </sec:Security_Objectives_for_the_TOE>
    
    <!-- 4.2 Security Objectives for the Operational Environment -->
    <section title="Security Objectives for the Operational Environment" id="SecurityObjectivesTOEorEnvironment">
      <!-- Note: updated this section to be more in line with how these are done now. We don't want to use refinements on OE objectives because then multiple simultaneous PP-Module claims could cause mutually exclusive changes. -->
      <!-- 
      <h:p>
      The Operational Environment of the TOE implements technical and procedural measures to assist the
      TOE in correctly providing its security functionality (which is defined by the security objectives for the
      TOE). This section defines the security objectives that are to be addressed by the IT domain or by nontechnical or procedural means. As indicated above, if requirements supporting an objective on the TOE
      (in the previous table) are implemented in whole or in part by the platform, the ST should indicate this
      by an entry in this table with that objective.
      </h:p>
      -->
      <h:p>
      All security objectives for the operational environment of the Base-PP also apply to this PP-Module.
      </h:p><h:p>
      OE.NO_THRU_TRAFFIC_PROTECTION is still operative, but only for the interfaces in the TOE that are defined by the Base-PP and not the PP-Module.
      </h:p><h:p>
      OE.RESIDUAL_INFORMATION is still operative, but the residual information is expanded to include information relevant to STIP operation (e.g. decrypted SSL/TLS payload, ephemeral keys).
      </h:p><h:p>
      OE.TRUSTED_ADMIN is still operative, but this PP-Module also allows for the enforcement of administrative role separation, which can be used to limit the impact of
      malicious use of the TOE.
      </h:p>
      <SOEs>
        <SOE name="OE.AUDIT">
          <description>The operational environment includes an audit server with adequate storage to retain the audit
            record, and the audit server provides adequate availability, integrity, and access control to the audit
            record to support operational requirements. Administration of the audit server is separate from
            that of the SSL/TLS inspection proxy, and can support all required role separations. 
            <h:p/>
            <h:i>Rationale: Each certificate issued by the SSL/TLS inspection device is trusted by monitored clients for
            the validity period asserted in the certificate. Inappropriate issuance or use of certificates issued by the
            SSL/TLS inspection device may require the circumstances of the issuance to be investigated, and
            appropriate actions (e.g., certificate revocation, administrative actions, etc.) to be taken.</h:i>
          </description>
          <consistency-rationale/>
        </SOE>
        <SOE name="OE.CERT_REPOSITORY">
          <description>The OE provides a certificate repository for storage of certificates (and optionally CRLs) issued by
            the TSF.
            <h:p/>
            <h:i>Rationale: Each certificate issued by the SSL/TLS inspection device is trusted by monitored clients for
            the validity period asserted in the certificate. Inappropriate issuance of certificates, especially
            certificates with code-signing or which can act as subordinate CAs to issue additional certificates, or
            inappropriate use of certificates issued by the SSL/TLS inspection device to conduct unauthorized
            inspection, or to gain access to protected resources may require the circumstances of the issuance to
            be investigated, and appropriate actions (e.g., certificate revocation, administrative actions, etc.) to
            be taken.</h:i></description>
          <consistency-rationale/>
        </SOE>
        <SOE name="OE.CERT_REPOSITORY_SEARCH">
          <description>The OE provides the ability to search a certificate repository for specific certificate fields in
            certificates issued by the TSF and return the certificate and an identifier for the certificate that can 
            be used to search the audit trail for events related to that certificate and for unauthorized or
            improperly constrained certificates.
            <h:p/>
            <h:i>Rationale: Each certificate issued by the SSL/TLS inspection device is trusted by monitored clients for
              the validity period asserted in the certificate. Inappropriate issuance or use of certificates issued by the
              SSL/TLS inspection device may require the circumstances of the issuance to be investigated, and
              appropriate actions (e.g., certificate revocation, administrative actions, etc.) to be taken.</h:i>
          </description>
          <consistency-rationale/>
        </SOE>
      </SOEs>
    </section>
    
    <!-- 4.3 Security Objectives Rationale -->
    <section title="Security Objectives Rationale" id="SOR">
      <!-- This section should remain empty and is populated from the rationale tags in the previous sections.  -->
    </section>
    
  </sec:Security_Objectives>
        
  <!-- 5. Security Requirements -->
  <sec:Security_Requirements>
<!--  <section title="Security Requirements" id="sfrs">  -->
    
    The Security Functional Requirements (SFRs) included in this section are derived from Part 2 of the
    Common Criteria for Information Technology Security Evaluation, Version 3.1, Revision 5, with
    additional extended functional components.<h:p/>
    The CC defines operations on Security Functional Requirements: assignments, selections, assignments
    within selections and refinements. This document uses the following font conventions to identify the
    operations defined by the CC:<h:p/>
    <h:ul>
      <h:li>Assignments are indicated with <h:i>italicized</h:i> text.</h:li>
      <h:li>Refinements made by the PP-Module author are indicated with <h:b>bold text</h:b> for added or substituted
        text and <h:s>strikethrough</h:s> text for removed text. Refinements are only applied to significant technical
        changes to existing SFRs; minor presentation changes with no technical impact (such as British vs
        American spelling differences) are not marked as refinements. Refinements are also indicated when
        an operation is added or substituted for an existing operation (e.g. the PP-Module completes an
        assignment in such a way that it introduces a selection into the assignment).<h:p/>
        Note that for SFRs that are defined either in CC Part 2 or in this PP-Module’s Extended Components
        Definition, the refinement operation is used to indicate deviations from the defined component. For
        Base-PP SFRs that are modified by this PP-Module, the refinement operation is used to indicate
        deviations from the Base-PP’s definition of the SFR (i.e. if the Base-PP refined an SFR and that
        change is not affected by this PP-Module, it is not shown here as a refinement).</h:li>
      <h:li>Selections are indicated with <h:i>italicized</h:i> text.</h:li>
      <h:li>Iteration is indicated by appending the SFR name with a slash and unique identifier suggesting the
        purpose of the iteration, e.g. ‘/STIP’ for an SFR relating to STIP functionality.</h:li>
      <h:li>Extended SFRs are identified by having a label “EXT” after the SFR name.</h:li>
    </h:ul>
    Note that selections and assignments to be completed by the ST author are preceded with “selection:”
    and “assignment:”. If text is italicized and does not include either of these, it means that the selection or
    assignment has already been completed in this PP-Module and the ST author must use the text as
    written. 
    
    <!-- 5.1 NDcPP Security Functional Requirements Direction -->
    <base-pp id="ND" version="2.2e" name="Network Device" product="Network Device" short="ND" plural="Network Devices">
      <url>https://www.niap-ccevs.org/profile/Info.cfm?PPID=447&amp;id=447</url>
      <cPP/>
      
		<sec-func-req-dir> 
			In a PP-Configuration that includes the NDcPP, the STIP is expected to rely on some of the
			security functions implemented by the network device as a whole and evaluated against the Base-PP.
			In this case, the following sections describe any modifications that the ST author must make to the SFRs
			defined in the Base-PP in addition to what is mandated by section 5.2.
		</sec-func-req-dir> 
      
      <!-- 5.1.1 Modified SFRs -->      
      <modified-sfrs>

        <!-- 5.1.1.1  -->
        <!--
        <section title="Security Audit (FAU)" id="nd-m-fau">
          <f-component cc-id="fau_stg.1" id="nd-fau-stg-1" name="Protected Audit Trail Storage">
            <consistency-rationale>Other than this SFR becoming mandatory versus optional, there is no modification to this SFR.</consistency-rationale>

            <f-element id="nd-fau-stg-1e1">
              <title>
                This PP-Module does not modify this SFR as it is defined in the Base-PP. This SFR is optional in the Base-PP but is mandatory for a TOE that conforms to this PP-Module.
              </title>
              <aactivity>
                <no-tests>There is no change to the Base-PP EAs for this SFR when this PP-Module is claimed.</no-tests>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
        
        </section>
        -->
 
        <section title="Cryptographic Support (FCS)" id="nd-m-fcs">
          
          
          <f-component cc-id="fcs_ckm.4" id="nd-fcs-ckm-4" name="Cryptographic Key Destruction">
            <consistency-rationale>The ST author is instructed to include security critical parameters and when
              key destruction is required.</consistency-rationale>
            <f-element id="nd-fcs-ckm-4e1">
              <title>
                The TSF shall destroy all cryptographic keys <h:b>and critical security parameters,
                  when no longer required</h:b> in accordance with the specified cryptographic key
                destruction method
                <selectables linebreak="yes">
                <selectable>
                  For plaintext keys in volatile storage, the destruction shall be executed by a 
                  <selectables linebreak="yes">
                    <selectable>Single overwrite consisting of 
                      <selectables linebreak="yes">
                      <selectable>a pseudo-random pattern using the TSF's RBG</selectable>
                      <selectable>zeroes</selectable>
                      <selectable>ones</selectable>
                      <selectable>a new value of the key</selectable>
                      <selectable><assignable>a static or dynamic value that does not contain any CSP</assignable></selectable></selectables></selectable>
                    <selectable>Destruction of reference to the key directly followed by a request for garbage collection</selectable></selectables></selectable>
                <selectable>
                  For plaintext keys in non-volatile storage, the destruction shall be executed the invocation of an interface provided by a part of the TSF that 
                  <selectables linebreak="yes">
                    <selectable>Logically addresses the storage location of the key and performs a <selectables><selectable>single</selectable><selectable><assignable>number of passes</assignable>-pass</selectable></selectables>
                    overwrite consisting of <selectables linebreak="yes">
                      <selectable>a pseudo-random pattern using the TSF's RBG</selectable>
                      <selectable>zeroes</selectable>
                      <selectable>ones</selectable>
                      <selectable>a new value of the key</selectable>
                      <selectable><assignable>a static or dynamic value that does not contain any CSP</assignable></selectable></selectables></selectable>
                    <selectable>Instructs a part of the TSF to destroy the abstraction that represents the key</selectable>
                  </selectables>
                </selectable>
                </selectables>
                that meets the following: [<h:i>no standard</h:i>].
              </title>
              <note role="application">
                This SFR is refined from its definition in the Base-PP through the inclusion of
                security critical parameters and clarifies when destruction is required; a STIP
                device includes persistent keys, including the embedded CA’s signing private key
                that should not be destroyed until they are no longer needed. Security critical
                parameters includes security related information (e.g., secret and private
                cryptographic keys, authentication data such as passwords and PINs) appearing
                in plaintext or otherwise unprotected form and whose disclosure or modification
                can compromise the security of a CA or the security of the information protected
                by the CA or the security of the information protected by the CA.
              </note>
              <aactivity>
                <no-tests>This SFR is refined in this PP-Module to include requirementsfor destruction of security critical parameters
                  as well as keys. The EA for the Base-PP are extended to include security critical
                  parameters whenever keys are indicated.</no-tests>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
          
          <!-- FCS_TLSC_EXT.1 -->
          <f-component cc-id="fcs_tlsc_ext.1" id="nd-fcs-tlsc-ext-1" name="TLS Client Protocol Without Mutual Authentication">
            <consistency-rationale>Other than defining an additional selection-based trigger, there is no modification to this SFR.</consistency-rationale>
            <f-element id="nd-fcs-tlsc-ext-1e1">
              <title>
                This PP-Module does not modify this SFR as it is defined in the Base-PP. This SFR is selection-based in the Base-PP for its potential use in trusted communications.
                This PP-Module also defines EST as a supported method of obtaining certificates for the TOE, which may use TLS. 
                This SFR can therefore also be triggered if the TOE claims FIA_ESTC_EXT.1 and selects a mechanism that makes use of FCS_TLSC_EXT.1.
              </title>
              <aactivity>
                <no-tests>There is no change to the Base-PP EAs for this SFR when this PP-Module is claimed.</no-tests>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>

          <!-- FCS_TLSC_EXT.2 -->
          <f-component cc-id="fcs_tlsc_ext.2" id="nd-fcs-tlsc-ext-2" name="TLS Client Support for Mutual Authentication">
            <consistency-rationale>Other than being defined as selection-based, there is no modification to this SFR.</consistency-rationale>
            <f-element id="nd-fcs-tlsc-ext-2e1">
              <title>
                This PP-Module does not modify this SFR as it is defined in the Base-PP. This SFR is optional in the Base-PP for its potential use in trusted communications.
                This PP-Module defines EST as a supported method of obtaining certificates, which may use mutually-authenticated TLS. 
                This SFR is therefore selection-based when the TOE claims this PP-Module, dependent on selection in FIA_ESTC_EXT.1.4. 
              </title>
              <aactivity>
                <no-tests>There is no change to the Base-PP EAs for this SFR when this PP-Module is claimed.</no-tests>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>

        </section>
        
        <!-- 5.1.1.3  -->
        <section title="Identification and Authentication (FIA)" id="nd-m-fia">
          
          <f-component cc-id="fia_x509_ext.1" iteration="Rev" id="nd-fia-x509-ext-1" name="X.509 Certificate Validation">
            <consistency-rationale>There is no modification to this SFR, but it is mandatory for a TOE that conforms to this PP-Module because
              the certificate enrollment process always requires the TSF to validate a presented certificate.</consistency-rationale>
            <f-element id="nd-fia-x509-ext-1e1">
              <title>
                This SFR is selection-based in the Base-PP but is mandatory when this PP-Module is claimed. FIA_ENR_EXT.1 requires this PP-Module to generate certificate requests
                using either PKCS#10 or Enrollment over Secure Transport (EST). If PKCS#10 is claimed, the TSF must be able to apply this SFR to the certificate repsonse signed
                by an external CA. If EST is claimed, the TSF must be able to apply this SFR to the X.509 certificate presented by an EST server.
              </title>
              <!-- Note: changed up application note to make it more clear and accurate, is this ok -->
              <note role="Application">
                FIA_X509_EXT.1/STIP defines the TOE's X.509 validation behavior for TLS certificates presented to the TSF as part of TLS proxying. 
                FIA_X509_EXT.1/Rev may be used by the TOE to validate certificates loaded onto it. If the TOE
                has other functions that require the use of X.509 certificates (e.g. code signing for integrity testing or software updates, TLS interfaces used for a purpose other than session proxying such as audit server or authentication server connections), 
                FIA_X509_EXT.1/Rev applies to those as well.
              </note>
              <aactivity>
                <no-tests>There is no change to the Base-PP EAs for this SFR when this PP-Module is claimed.</no-tests>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>

          
          <!-- Note: changed up application note to make it more clear and accurate, is this ok -->
          <f-component cc-id="fia_x509_ext.3" id="nd-fia-x509-ext-3" name="X.509 Certificate Requests">
            <consistency-rationale>There is no change to this SFR. Only its trigger for inclusion is changed because this PP-Module introduces an alternate method of obtaining a certificate for the TOE.</consistency-rationale>
            <f-element id="nd-fia-x509-3e1">
              <title>
                In the Base-PP, this SFR is optional but must be claimed in any situation where the TOE presents its own X.509 certificate to an external entity (e.g. any case where the TOE acts as a TLS server or where the TOE acts as a TLS client
                in an connection that uses mutual authentication). A STIP TOE must present an X.509 certificate to an external entity as part of TLS session proxying. The TOE may obtain this certificate either using PKCS#10 (covered by this SFR) or
                through Enrollment over Secure Transport (EST), which is covered by the selection-based SFR FIA_ESTC_EXT.1. Therefore, the ST author only claims FIA_X509_EXT.3 if PKCS#10 is selected in FIA_ENR_EXT.1.
              </title>
              <aactivity>
                <no-tests>There is no change to the Base-PP EAs for this SFR when this PP-Module is claimed.</no-tests>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
          
        </section>
        
        
        <section title="Security Management (FMT)" id="nd-m-fmt">
        <f-component name="Restrictions on Security Roles" cc-id="fmt_smr.2" id="fmt-smr-2">
          <consistency-rationale>This SFR defines additional management roles that the TOE may define to enforce role separation, which is a security enhancement on the Base-PP's requirement that only
            one management role is necessary.</consistency-rationale>
          <f-element id="fmt-2e1-stip">
            <title>
              The TSF shall maintain the roles: [<h:i>
                <h:ul>
                  <h:li>Security Administrator <h:b>,</h:b></h:li>
                </h:ul><h:b>
                <selectables linebreak="yes">
                  <selectable>Auditor</selectable>
                  <selectable>CA Operations Staff</selectable>
                  <selectable>Account Manager</selectable>
                  <selectable>no other roles</selectable>
                </selectables></h:b></h:i>].
            </title>
            <note role="application">This SFR is refined from the Base-PP to allow for the ability for the STIP functionality to be 
              distributed across multiple administrative roles. If the TOE does not enforce role separation, the ST author selects "no other roles" to indicate that STIP functionality is managed
              by the same Security Administrator role specified in the Base-PP.
              <h:p/>
              As is the case in the Base-PP, the TOE does not need its roles to have the same
              names as those defined in this SFR. It is expected that the ST will
              define the administrative roles and privileges defined by the TSF and map them to
              the roles listed in this PP-Module.
              <h:p/>
              If “ability to configure local audit storage behavior” is selected in FMT_SMF.1/STIP, the
              ‘Auditor’ role must be selected here; role separation is required for audit storage
              functionality. </note>
          </f-element>
          <f-element id="fmt-2e2-stip">
            <title>The TSF shall be able to associate users with roles.</title>
          </f-element>
          <f-element id="fmt-2e3-stip">
            <title>
              The TSF shall ensure that the conditions [<h:i>
                <h:ul>
                  <h:li>All roles shall be able to administer the TOE locally,</h:li>
                  <h:li>All roles shall be able to administer the TOE remotely,</h:li>
                </h:ul>
                <h:b>
                <selectables linebreak="yes">
                  <selectable>No identity is authorized to assume both an Account Manager role
                    and any of the other roles in FMT_SMR.2.1</selectable>
                  <selectable>No identity is authorized to assume both an Auditor role and any of
                    the other roles in FMT_SMR.2.1</selectable>
                  <selectable>No other conditions</selectable>
                </selectables></h:b></h:i>] are satisifed.
            </title>
            <note role="application">
              This PP-Module refines the SFR defined in the Base-PP to include additional
              administrative roles. As defined in FMT_MOF.1/STIP, the TSF is expected to provide
              different privileges to the given roles.
              <h:p/>
              If the TSF supports an Auditor and/or Account Manager role, it is expected that
              the relevant selections above will be made. It is the intent of this PP-Module that
              if either or both of these roles are provided, their critical functionality is isolated
              from any other roles (see FMT_MOF.1/STIP).
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to verify that it identifies the management roles that the TOE maintains as well as any restrictions or limitations on the assignment of these roles 
                (e.g. whether multiple roles can be assumed by the same user or if certain roles are mutually exclusive).<h:p/>
                If the TOE supports multiple management roles, the evaluator shall verify that any differences in role enforcement between interfaces are discussed. For example, a TOE may have a local console that uses a separate administrative
                account from a remote GUI, such that any user who is authorized to use the local console is a Security Administrator, while the remote GUI maintains its own separate role structure.<h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to verify that it includes guidance on how to associate users with management roles. <h:p/></Guidance>
              <Tests>
                For each supported management interface, the evaluator shall follow the operational guidance to associate user accounts with the management roles that are supported on those interfaces. If there are any restrictions
                on the assignment of management roles, such as the inability to assign two mutually exclusive roles to the same user, the evaluator shall attempt to violate these restrictions to verify that they are enforced.
                <h:p/>
                Testing of the actual functional limitations of the assigned management roles is addressed by FMT_MOF.1/STIP.
              </Tests>
            </aactivity>
          </f-element>
        </f-component>
        </section>
        
        <section title="Trusted Path/Channels (FTP)" id="nd-m-ftp">
          <f-component cc-id="ftp_itc.1" id="nd-ftp-itc-1" name="Inter-TSF Trusted Channel">
            <consistency-rationale>The PP-Module partially completes selections and assignments in this SFR using the available options to specify external interfaces and trusted channels that all STIP products must support at minimum.</consistency-rationale>
            <f-element id="nd-ftp-itc-1e1">
              <title>
                The TSF shall be capable of using <h:b>TLS</h:b> and <selectables>
                  <selectable>IPsec</selectable>
                  <selectable>SSH</selectable>
                  <selectable>DTLS</selectable>
                  <selectable>HTTPS</selectable>
                  <selectable><h:b>no other protocols</h:b></selectable>
                </selectables>
                to provide a trusted communication channel between itself and authorized IT
                entities supporting the following capabilities: audit server, <h:b>TLS session proxying</h:b>, <selectables>
                  <selectable>authentication server</selectable>
                  <selectable><h:b>Enrollment over Secure Transport</h:b></selectable>
                  <selectable><assignable>other capabilities</assignable></selectable>
                  <selectable>no other capabilities</selectable>
                </selectables> 
                that is logically distinct from
                other communication channels and provides assured identification of its end points and
                protection of the channel data from disclosure and detection of modification of the channel
                data.
              </title>
              <note role="Application">
                This SFR is modified from its definition in the Base-PP by specifying that a conformant TOE will always implement TLS trusted channels at minimum, due
                to the Module's required functionality for SSL/TLS session proxying. EST is also specified as a selectable use of TLS because 
                this interface is defined in the PP-Module as selection-based functionality.
                The TLS functionality used to implement SSL/TLS session proxying is defined in this PP-Module under the FCS_TTTC_EXT and FCS_TTTS_EXT requirements.
              For other potential TLS uses (e.g. EST, audit server communications), the relevant SFRs from the Base-PP would be used.</note>
            </f-element>
              <f-element id="nd-ftp-itc-1e2">
                <title>
                  The TSF shall permit the TSF or the authorized IT entities to initiate
                  communication via the trusted channel.
                </title>
              </f-element>
                <f-element id="nd-ftp-itc-1e3">
                  <!-- Note: is it ok to do the modification this way, specifically for the asignment? Or do we need to make it a selection between "assignment: list of services" and "no other services"?
                  I'm never sure if 'null' is implied by an assignment prompt or if it needs to be called out separately as an explicit option -->
                  <title>
                    The TSF shall initiate communication via the trusted channel for <h:b>establishment of TLS proxy connections,</h:b> 
                    <selectables>
                      <selectable><assignable>list of other services for which the TSF is able to initiate communications</assignable></selectable>
                      <selectable>no other services</selectable></selectables>.
                  </title>
                
              <aactivity>
                <no-tests>There is no change to the Base-PP EAs for this SFR when this PP-Module is claimed.</no-tests>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
          
        </section>
      </modified-sfrs>
        
        
        
      <!-- 5.1.2 Additional SFRs -->
      <additional-sfrs/>

      
	  <!-- 6.1.1 Consistency of TOE Type -->
      <con-toe>If this PP-Module is used to extend the NDcPP, the TOE type for the overall TOE is still a generic network
        device. However, one of the functions of the device must be the ability for it to act as an SSL/TLS Inspection
        Proxy. The TOE boundary is simply extended to include that functionality. </con-toe>
		
	  <!-- 6.1.2 Consistency of Security Problem Description -->
      <con-sec-prob>The threats, assumptions, and OSPs defined by this PP-Module (see sections 3.1 through 3.3) supplement those
		defined in the NDcPP as follows:</con-sec-prob>
	   <!-- 6.1.3 Consistency of Objectives -->
      <con-obj/>
      <con-op-en/>
	    
	    <!-- 6.1.2 Consistency Rationale table for ND -->
      <!-- Note: modified some of these to make the consistency more obvious, is that ok? Also added the OSP because that was missing from 1.0's mapping -->
      <con-mod ref="T.UNTRUSTED_COMMUNICATION">The threat of untrusted communication can provide unauthorized access
        to unintended resources if using weak cryptography or use untrusted
        intermediate systems. This can be mitigated either by protocols defined in
        this PP-Module or in the Base-PP.</con-mod>
      <con-mod ref="T.AUDIT">Auditing poses a threat if certain activities aren’t logged, like the issuance
        of certificates. This threat can be mitigated if proper configurations are in
        place to prevent the compromise of audit data defined in this PP-Module
        or the Base-PP.</con-mod>
      <con-mod ref="T.UNAUTHORIZED_USERS">The threat of unauthorized users attempting to gain access to other users’
        credentials can be addressed by placing protections for logged-in users
        and only allow privileged user access methods defined in this PP-Module
        or in the Base-PP.</con-mod>
      <con-mod ref="T.CREDENTIALS">Beyond the Base-PP, the threat of manipulation of the CA signing key can
        be mitigated by providing access protection to persistent keys.</con-mod>
      <con-mod ref="T.SERVICES">The threat of misuse or manipulation of services is not defined in the
        Base-PP, but it is consistent with the general threat of unauthorized manipulation of the TSF.</con-mod>
      <con-mod ref="T.DEVICE_FAILURE">The failure of the certificate authority or routing traffic to inspection poses
        a threat not defined in the Base-PP.</con-mod>
      <con-mod ref="T.UNAUTHORIZED_DISCLOSURE">The Base-PP does not include the threat of unauthorized disclosure to
        sensitive data that is only intended for the monitored client because this is an interface that the Base-PP cannot assume all conformant TOEs have.</con-mod>
      <con-mod ref="T.INAPPROPRIATE_ACCESS">The threat of inappropriate access to unintended servers could disclose
        unauthorized traffic to inspection processes which is not defined in the
        Base-PP because a generic network device does not necessarily have a traffic inspection functionality.</con-mod>
      <con-mod ref="P.AUTHORIZATION_TO_INSPECT">The Base-PP cannot define the interactions that an end user will have with a generic device because it may vary depending on the specific device type. This PP-Module defines a policy
      that is specific to the use case of a STIP device.</con-mod>

			
	  <!-- 6.1.3 Consistency of Objectives -->
      <!-- Note: the 1.0 Module has a single note that all objectives are consistent because the Base-PP doesn't define any. I didn't see any way to suppress these entries from the table so I've put in 
      rationale that's basically just a duplicate of this in table form. Should we add something in the schema to optionally suppress the objectives or is how it's done now ok? -->
      <con-mod ref="O.AUDIT_LOSS_RESPONSE">The Base-PP does not define any TOE objectives so PP-Module objectives do not conflict with it.</con-mod>
      <con-mod ref="O.AUDIT_PROTECTION">The Base-PP does not define any TOE objectives so PP-Module objectives do not conflict with it.</con-mod>
      <con-mod ref="O.CERTIFICATES">The Base-PP does not define any TOE objectives so PP-Module objectives do not conflict with it.</con-mod>
      <con-mod ref="O.DISPLAY_BANNER">The Base-PP does not define any TOE objectives so PP-Module objectives do not conflict with it.</con-mod>
      <con-mod ref="O.INTEGRITY_PROTECTION">The Base-PP does not define any TOE objectives so PP-Module objectives do not conflict with it.</con-mod>
      <con-mod ref="O.PERSISTENT_KEY_PROTECTION">The Base-PP does not define any TOE objectives so PP-Module objectives do not conflict with it.</con-mod>
      <con-mod ref="O.PROTECTED_COMMUNICATIONS">The Base-PP does not define any TOE objectives so PP-Module objectives do not conflict with it.</con-mod>
      <con-mod ref="O.RECOVERY">The Base-PP does not define any TOE objectives so PP-Module objectives do not conflict with it.</con-mod>
      <con-mod ref="O.RESIDUAL_INFORMATION_CLEARING">The Base-PP does not define any TOE objectives so PP-Module objectives do not conflict with it.</con-mod>
      <con-mod ref="O.SYSTEM_MONITORING">The Base-PP does not define any TOE objectives so PP-Module objectives do not conflict with it.</con-mod>
      <con-mod ref="O.TOE_ADMINISTRATION">The Base-PP does not define any TOE objectives so PP-Module objectives do not conflict with it.</con-mod>
      <con-mod ref="O.TRAFFIC_MONITORING">The Base-PP does not define any TOE objectives so PP-Module objectives do not conflict with it.</con-mod>
      
      <!-- Note: modified some of these to make the consistency more obvious, is that ok -->
      <con-mod ref="OE.AUDIT">This objective intends for the TOE’s OE to have adequate storage to retain
        the TOE's audit records. This objective is not defined in the Base-PP but can be assumed to be consistent with the Base-PP because FAU_STG_EXT.1 requires transmission of audit data to an 
      environmental audit server, which means that there should be some assurance of the security of that server.</con-mod>
      <con-mod ref="OE.CERT_REPOSITORY">This objective intends for the TOE’s OE to provide a certificate repository. This is not defined in the Base-PP because not all network devices will necessarily need to interface with a certificate repository.</con-mod>
      <con-mod ref="OE.CERT_REPOSITORY_SEARCH">This objective intends for the TOE’s OE which will provide a certificate
        repository to also have the capability to search within the repository. This is not defined in the Base-PP because not all network devices will necessarily need to interface with a certificate repository.</con-mod>
      
     
	  
	  <!-- 6.1.4 Consistency of Requirements -->
	  <!-- Covered by rationales in individual f-components -->
    </base-pp>


	<!-- 5.2 TOE Security Functional Requirements -->
    <man-sfrs>

      <sec:Auditable_Events_for_Mandatory_SFRs>
        <h:p>

        </h:p>
        <audit-table table="mandatory" id="mandatory-audit-events"/>
        
      </sec:Auditable_Events_for_Mandatory_SFRs>

	  <!-- Security Audit (FAU) -->
      <section title="Security Audit (FAU)" id="m-fau">
        
        <ext-comp-def fam-id="FAU_GCR_EXT" title="Generation of Certificate Repository">
          <fam-behavior>Components in this family define requirements for persistent certificate storage in a repository.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="Generation of Certificate Repository" cc-id="fau_gcr_ext.1" id="fau-gcr-ext-1">
          <consistency-rationale>This SFR applies to storing certificates in a certificate repository which is not
            listed in the Base-PP.</consistency-rationale>
          <comp-lev> requires a conformant TOE to specify how it stores
            certificates that are issued by the TSF. </comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>There are no auditable events foreseen.</audit>
        <dependencies>
          FDP_CER_EXT.1 Certificate Profiles for Server Certificates<h:p/>
          FDP_CER_EXT.3 Certificate Issuance Rules for Server Certificates
        </dependencies>
        <f-element id="fau-gcr-ext-1e1">
          <title>
            The TSF shall <selectables>
              <selectable id="certStore">store</selectable>
              <selectable>invoke the Operational Environment to store</selectable>
            </selectables> certificates issued by the TSF.
          </title>
          <note role="application">
            While there is a requirement that a certificate repository exists and the TOE stores
            all certificates it generates in that repository, the repository can physically be
            within the TOE or in the OE. If the repository is provided by the TOE, then the first
            item in the first selection is chosen. If the storage is provided by the OE, then the
            second item in the first selection is chosen. It should be noted that the physical
            implementation of the certificate repository is left to the vendor; for instance, it
            can be a standalone store, or incorporated within the audit trail. 
          </note>
          <aactivity>
            <TSS>The evaluator shall examine the TSS to determine that it describes the certificate repository. If the
              certificate repository is provided by the OE, the evaluator shall check the TSS to ensure it describes the
              interfaces invoked by the TOE to store certificates.<h:p/></TSS>
            <Guidance>The evaluator shall ensure that the guidance describes any operations necessary to cause certificates to
              be stored in the repository.
            <h:p/></Guidance>
            <Tests>The evaluator shall cause a certificate to be generated by the TSF. The evaluator shall confirm that
              the certificate is stored in the certificate repository.</Tests>
          </aactivity>
        </f-element>
          <audit-event/>
      </f-component>
        
        <f-component name="Audit Data Generation (STIP)" cc-id="fau_gen.1" iteration="STIP" id="fau-gen-1">
          <consistency-rationale>
            This SFR is iterated from the Base-PP to add new auditable events for STIP functionality. 
            It does not modify or replace any of the required auditable events defined in the Base-PP under the un-iterated FAU_GEN.1.
            </consistency-rationale>
          <f-element id="fau-gen-1e1-stip">
            <title>
              The TSF shall be able to generate an audit record of the following
              auditable events: <h:ol type="a">
                <h:li>Start-up and shutdown of the audit functions</h:li>
                <h:li>All auditable events for the [<h:i>not specified</h:i>] level of audit; and</h:li>
                <h:li>[<h:i>auditable events defined in Auditable Events for Mandatory Requirements table, </h:i></h:li>
                <h:li><h:i>applicable auditable events defined in Auditable Events for Selection-based Requirements table</h:i>].</h:li>
              </h:ol>
            </title>
            <note role="application">
              The "Start-up and shtudown of the audit functions" event is identical to the event defined in the Base-PP's iteration of FAU_GEN.1.
              The TOE is not required to have two separate events for this behavior if there is only a single audit stream that which all audit events use.
              If the TOE does maintain a separate logging facility for STIP-related behavior, then this event must be addressed for it. Note that if 
              the audit functions cannot be started and stopped separately from the TOE itself, then auditing the start-up and shutdown of the TOE is sufficient to address this.
            </note>
          </f-element>
          <f-element id="fau-gen-1e2-stip">
            <title>The TSF shall record within each audit record at least the following
              information: <h:ol type="a">
                <h:li>Date and time of the event, type of event, subject identity (if
                  applicable), and the outcome (success or failure) of the event; and </h:li>
                <h:li>For each audit event type, based on the auditable event
                  definitions of the functional components included in the PP/ST,
                  <h:li>[<h:i>additional information defined in Auditable Events for Mandatory Requirements table, </h:i></h:li>
                  <h:li><h:i>additional information defined in applicable auditable events in Auditable Events for Selection-based Requirements table</h:i>].</h:li>
                [<h:i>additional information defined in Auditable Events table for each auditable event, where applicable</h:i>].</h:li>
              </h:ol>
              <!-- 
              <h:table>
                <h:tr class="header"><h:td>Requirement</h:td><h:td>Auditable Events</h:td><h:td>Additional Audit Record Contents</h:td></h:tr>
                <h:tr><h:td>FAU_GCR_EXT.1</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FAU_SCR_EXT.1 (selection-based)</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FAU_SAR.1 (optional)</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FAU_SAR.3 (optional)</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FAU_STG.4 </h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FCS_CKM_EXT.5 (selection-based)</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FCS_STG_EXT.1</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FCS_TTTC_EXT.1</h:td><h:td>Establishment of TLS session</h:td><h:td>TLS session parameters</h:td></h:tr>
                <h:tr><h:td rowspan="2">FCS_TTTC_EXT.3 (selection-based)</h:td><h:td>Mutual authentication authorized</h:td><h:td><selectables>
                  <selectable>client certificate value</selectable>
                  <selectable><assignable>client certificate object identifier</assignable></selectable>
                </selectables></h:td></h:tr>
                <h:tr><h:td>Mutual authentication not authorized</h:td><h:td>None</h:td></h:tr>
                <h:tr><h:td>FCS_TTTC_EXT.4 (selection-based)</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FCS_TTTC_EXT.5</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FCS_TTTS_EXT.1</h:td><h:td>Establishment of TLS session</h:td><h:td>TLS session parameters</h:td></h:tr>
                <h:tr><h:td rowspan="2">FCS_TTTS_EXT.3 (selection-based)</h:td><h:td>Mutual authentication required and valid client certificate received</h:td><h:td>Client certificate</h:td></h:tr>
                <h:tr><h:td>Mutual authentication not used</h:td><h:td>None</h:td></h:tr>
                <h:tr><h:td>FCS_TTTS_EXT.4 (selection-based)</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FDP_CER_EXT.1</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FDP_CER_EXT.2</h:td><h:td>Linking of issued certificate to validated certificate</h:td><h:td>
                  Success: <selectables>
                    <selectable>issued certificate value</selectable>
                    <selectable>issued certificate object identifier</selectable>
                  </selectables>, <selectables>
                    <selectable>validated certificate value</selectable>
                    <selectable>validated certificate object identifier</selectable>
                  </selectables>
                  <h:p/>
                  Failure: Reason for failure
                </h:td></h:tr>
                <h:tr><h:td>FDP_CER_EXT.3</h:td><h:td>Certificate generation</h:td><h:td>Success: <selectables>
                  <selectable>certificate value</selectable>
                  <selectable>certificate object identifier</selectable>
                </selectables></h:td></h:tr>
                <h:tr><h:td>FDP_CER_EXT.4 (selection-based)</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FDP_CER_EXT.5 (selection-based)</h:td><h:td>Certificate generation</h:td><h:td>Success: <selectables>
                  <selectable>certificate value</selectable>
                  <selectable>certificate object identifier</selectable>
                </selectables></h:td></h:tr>
                <h:tr><h:td>FDP_CRL_EXT.1 (selection-based)</h:td><h:td>Failure to generate CRL</h:td><h:td>None</h:td></h:tr>
                <h:tr><h:td>FDP_CSI_EXT.1 (selection-based)</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FDP_CSI_EXT.2 (selection-based)</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FDP_CSIR_EXT.1 (selection-based)</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FDP_OCSP_EXT.1 (selection-based)</h:td><h:td>Failure to generate certificate status information</h:td><h:td>None</h:td></h:tr>
                <h:tr><h:td>FDP_OCSPS_EXT.1 (selection-based)</h:td><h:td>Failure to include certificate status information in TLS handshake message</h:td><h:td>None</h:td></h:tr>
                <h:tr><h:td>FDP_PIN_EXT.1 (optional)</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FDP_PPP_EXT.1</h:td><h:td>Configuration changes to the plaintext processing policy</h:td><h:td>None</h:td></h:tr>
                <h:tr><h:td>FDP_PRC_EXT.1</h:td><h:td>Plaintext routed to inspection processing functional component</h:td><h:td>TLS session thread identifier, <assignable>processing element identifier</assignable></h:td></h:tr>
                <h:tr><h:td>FDP_RIP.1</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FDP_STG_EXT.1</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td rowspan="4">FDP_STIP_EXT.1</h:td><h:td>Establishment of a TLS inspection session thread</h:td><h:td><assignable>TLS session thread attributes</assignable>, 
                  <assignable>client attributes</assignable>, and <assignable>server attributes</assignable> associated with the thread</h:td></h:tr>
                <h:tr><h:td>Establishment of an encrypted TLS data flow</h:td><h:td><assignable>encrypted TLS data flow attributes</assignable></h:td></h:tr>
                <h:tr><h:td>Bypass operation invoked</h:td><h:td>TLS session thread identifier, identifier(s) of processing element(s) bypassed, reason for bypass</h:td></h:tr>
                <h:tr><h:td>Block operation invoked</h:td><h:td>TLS session thread identifier, reason for blocking</h:td></h:tr>
                <h:tr><h:td>FDP_STIP_EXT.2 (selection-based)</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FDP_TEP_EXT.1</h:td><h:td>Mutual authentication authorized</h:td><h:td><assignable>client attributes obtained from valid client certificate</assignable></h:td></h:tr>
                <h:tr><h:td>FIA_ENR_EXT.1</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FIA_ESTC_EXT.1 (selection-based)</h:td><h:td>EST requests</h:td><h:td>None</h:td></h:tr>
                <h:tr><h:td>FIA_ESTC_EXT.2 (objective)</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FIA_X509_EXT.1/STIP</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FMT_MOF.1/STIP</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FMT_SMF.1/STIP</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FPT_FLS.1</h:td><h:td>Invocation of failures under this requirement</h:td><h:td>Indication that the TSF has failed with the type of failure that occurred</h:td></h:tr>
                <h:tr><h:td>FPT_KST_EXT.1</h:td><h:td colspan="2">None</h:td></h:tr>
                <h:tr><h:td>FPT_KST_EXT.2</h:td><h:td>
                  All attempts to use the TOE's embedded CA's private signing key and <selectables>
                    <selectable><assignable>other secret and private keys</assignable></selectable>
                    <selectable>no other secret and private keys</selectable>
                  </selectables>
                </h:td><h:td>Identifier of user or process that attempted access</h:td></h:tr>
                <h:tr><h:td rowspan="2">FPT_RCV.1</h:td><h:td>The fact that a failure or service discontinuity occurred</h:td><h:td>None</h:td></h:tr>
                <h:tr><h:td>Resumption of regular opartion</h:td><h:td>TSF failure types that are available on recovery</h:td></h:tr>
                <h:tr><h:td>FTA_TAB.1/TLS (selection-based)</h:td><h:td colspan="2">None</h:td></h:tr>
              </h:table><h:br/>
              <h:b><ctr ctr-type="Table" id="manaudit">: Auditable Events</ctr></h:b>
              -->
            </title>
            <note role="application">The ST author only needs to include the auditable events that correspond to the SFRs claimed in the ST.
              The TOE is not required to generate auditable events for selection-based or optional SFRs that it does not claim.</note>
            <aactivity>
              <!-- Note: New EA for iterated SFR, is it ok -->
              <TSS>
                The evaluator shall examine the TSS to verify that it describes the audit mechanism(s) that the TOE uses to generate audit records for STIP behavior. 
                <!-- 
                
                If any audit mechanisms the TSF uses for this
                are not used to generate audit records for events defined by FAU_GEN.1 in the Base-PP, the evaluator shall ensure that any STIP-specific audit mechanisms 
                also meet the relevant functional claims from the Base-PP.
                <h:p/>
                For example, FAU_STG_EXT.1 requires all audit records to be transmitted to the OE over a trusted channel. This includes the audit records that are required by FAU_GEN.1/STIP. Therefore, if the TOE has an audit mechanism
                that is only used for STIP functionality, the evaluator shall ensure that the STIP related audit records meet this requirement, even if the mechanism used to generate these audit records does not apply to any of the auditable
                events defined in the Base-PP. 
                -->
              <h:p/></TSS>
              <Guidance>
                The evaluator shall examine the operational guidance to verify that it identifies all security-relevant auditable events claimed in the ST and includes sample records of each event type. If the TOE uses multiple
                audit mechanisms to generate different sets of records, the evaluator shall verify that the operational guidance identifies the audit records that are associated with each of the mechanisms such that the source of each audit record type
                is clear.
              <h:p/></Guidance>
              <Tests>
                The evaluator shall test the audit functionality by performing actions that trigger each of the claimed audit events and verifying that the audit records are accurate and that their format is consistent with what is specified 
                in the operational guidance. The evaluator may generate these audit events as a consequence of performing other tests that would cause these events to be generated.
              </Tests>
            </aactivity>
          </f-element>
        </f-component>
        
        
        <f-component name="Prevention of Audit Data Loss" cc-id="fau_stg.4" id="fau-stg-4">
          <consistency-rationale>This SFR applies to the prevention of audit data loss by the inclusion of the
            auditor role which is not listed in the Base-PP.</consistency-rationale>
          <comp-lev/>
          <management/>
          <audit/>
          <dependencies/>
          <f-element id="fau-stg-4e1">
            <title>
              The TSF shall [<h:i>prevent audited events, except those taken by the <h:b><selectables>
                <selectable>Security Administrator</selectable>
                <selectable>Auditor</selectable></selectables></h:b></h:i>] and <assignable>other actions to be taken in
                  case of audit storage failure</assignable> if the audit trail <h:b>cannot be written to</h:b>.
            </title>
            <note role="application">
              This requirement applies to the TOE regardless of whether the audit trail is stored
              within the TOE boundary or on an external system in the Operational
              Environment. If the audit trail is stored locally, then the requirement applies when
              the audit trail cannot be written to when it is full. If the audit trail (in whole or in
              part) is stored on a system external to the TOE, then the requirement applies when
              the connection between the TOE and the external audit server becomes 
              disconnected and the audit trail cannot be written to. In the case where the audit
              trail is external to the TOE and cannot be written to because it is full (and the TOE
              has some way of detecting that), then the requirement applies in that case as well.
              In all cases, the ST author is expected to describe (in the TSS) how the TSF is made
              aware of any such failures and how it behaves in response.
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it describes the behavior of the TSF when the audit trail
                cannot be written to. The evaluator shall ensure the TSS describes where the audit trail is stored (locally,
                remotely, or both), how the TSF detects audit full conditions if the audit trail is stored locally, whether
                and how the TSF detects audit full conditions for remote audit repositories, and how the TSF detects loss
                of communication with external audit repositories (if using an external audit server). The evaluator shall
                also ensure the TSS describes what actions can be performed by the privileged user, if any, in each case
                where the audit trail cannot be written.
              <h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure it describes what conditions result in the
                audit trail not being able to be written to, and how an Auditor recognizes that such a condition has
                occurred. The evaluator shall also examine the operational guidance to ensure it includes remedial steps
                for correcting these issues. <h:p/></Guidance>
              <Tests>
                The evaluator shall perform the following tests. The tests are conditional on where the audit data are
                being stored.
                <h:p/>
                <xref to="fau-stg-4-local"/> demonstrates the capability of the TOE to react to an indication that the repository is full; this is
                always applicable if the audit data are stored locally. If the TOE has a means to detect that a remote audit
                repository is full, then this test will be run for those types of TOEs as well. <xref to="fau-stg-4-remote"/> is only executed in cases
                where an external repository is supported, and tests the ability of the TOE to detect when the connection
                to the repository becomes unavailable:
                <testlist>
                  <test id="fau-stg-4-local">(conditional, the audit trail is local to the TOE) The evaluator shall cause the audit trail to become full, verify that the TSF
                    behaves as documented in the TSS, and verify that a privileged user can perform the
                    documented remedial steps.</test>
                  <test id="fau-stg-4-remote">(conditional, the audit trail is stored in the Operational Environment) The evaluator shall cause the audit trail to become unavailable, verify that
                    the TSF behaves as documented in the TSS, and verify that a privileged user can perform the
                    documented remedial steps.
                  </test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
      </section>
      
      <!-- Cryptographic Support (FCS) -->
      <section title="Cryptographic Support (FCS)" id="m-fcs">

        <f-component name="Cryptographic Operation (Data Encryption/Decryption in Support of STIP)" cc-id="fcs_cop.1" iteration="STIP" id="fcs-cop-1-stip">
          <consistency-rationale>This SFR provides encryption/decryption cipher suites used in support for
            the through-traffic processing of the TOE.</consistency-rationale>
          <f-element id="fcs-cop-1e1-stip">
            <title>
              The TSF shall perform encryption/decryption in accordance with a specified
              cryptographic algorithms [<h:i>AES in CCM and CCM-8 mode and <selectables>
                <selectable>TDES used
                in CBC mode with 3 distinct keys in its key set</selectable>
                <selectable>no other algorithms
                </selectable></selectables></h:i>] and
              cryptographic key sizes <selectables>
                <selectable>128 bits</selectable>
                <selectable>192 bits</selectable>
                <selectable>256 bits</selectable>
                </selectables> that meet the
              following: [<h:i>AES as specified in ISO 18033-3, CCM and CCM-8 as specified in NIST
              SP 800-38C and <selectables>
                <selectable>TDES as specified in NIST SP 800-67 Rev 2 and CBC mode
                  as specified in NIST SP 800-38A addendum</selectable>
                <selectable>no other standards</selectable>
              </selectables></h:i>].
            </title>
            <note role="application">This requirement, in conjunction with FCS_COP.1/DataEncryption from the Base-PP, is used to support FCS_TTTC_EXT.1 and FCS_TTTS_EXT.1. Note that
              FCS_TTTC_EXT.1 and FCS_TTTS_EXT.1 may necessitate certain selections.</note>
            <aactivity>
              <TSS>
                The evaluator shall verify that the TSS includes a description of encryption functions used for user data
                encryption, and that this description includes the key sizes and modes of operation.
                <h:p/>
                The evaluator shall check that the TSS describes how the TOE satisfies constraints on key sizes specified
                in the SFR. 
              <h:p/></TSS>
              <Guidance>
                The evaluator shall verify that the operational guidance documentation includes instructions for meeting this
                requirement, including any configuration required to ensure the TSF only supports Triple Data Encryption
                Standard (TDES) with three distinct keys.
              <h:p/></Guidance>
              <Tests>
                <!-- Note: does any of this need to change now that we switched to ACVP -->
                <testlist>
                  <test>The evaluator shall verify the AES implementation used to support TLS cipher suites in accordance
                    with the requirements by conducting the following tests:
                    <h:p/>
                    <h:b>AES-CCM Test</h:b>
                    <h:p/>
                    The evaluator shall perform the following tests.
                    <h:p/>
                    <h:b>Preconditions for testing:</h:b>
                    <h:p/>
                    <h:ul>
                      <h:li>Specification of keys as input parameter to the function to be tested</h:li>
                      <h:li>Specification of required input parameters such as modes</h:li>
                      <h:li>Specification of user data (plaintext)</h:li>
                      <h:li>Tapping of encrypted user data (ciphertext) directly in the non-volatile memory</h:li>
                    </h:ul>
                    <h:p/>
                    These tests are intended to be equivalent to those described in the NIST document, “The CCM
                    Validation System (CCMVS),” updated 9 Jan 2012, found at
                    <h:a href="http://csrc.nist.gov/groups/STM/cavp/documents/mac/CCMVS.pdf"/>.
                    It is not recommended that evaluators use values obtained from static sources such as
                    <h:a href="http://csrc.nist.gov/groups/STM/cavp/documents/mac/ccmtestvectors.zip"/>
                    or use values not generated expressly to exercise the AES-CCM implementation.
                    <h:p/>
                    The evaluator shall test the generation-encryption and decryption-verification functionality of AES-CCM
                    for the following input parameter and tag lengths:
                    <h:p/>
                    <h:ul>
                      <h:li><h:b>Keys:</h:b> All supported and selected key sizes (e.g., 128, 256 bits).</h:li>
                      <h:li><h:b>Associated Data:</h:b> Two or three values for associated data length: The minimum (≥ 0
                        bytes) and maximum (≤ 32 bytes) supported associated data lengths, and 2^16 (65536)
                        bytes, if supported.
                      </h:li>
                      <h:li><h:b>Payload:</h:b> Two values for payload length: The minimum (≥ 0 bytes) and maximum (≤ 32
                        bytes) supported payload lengths.</h:li>
                      <h:li><h:b>Nonces:</h:b> All supported nonce lengths (7, 8, 9, 10, 11, 12, 13) in bytes.</h:li>
                      <h:li><h:b>Tags:</h:b> All supported tag lengths (4, 6, 8, 10, 12, 14, 16) in bytes.</h:li>
                    </h:ul>
                    <h:p/>
                    The testing for CCM consists of five tests. To determine correctness in each of the below tests, the
                    evaluator shall compare the ciphertext with the result of encryption of the same inputs with a known
                    good implementation.
                    <h:p/>
                    <h:b>Variable Assocated Data Test</h:b>
                    <h:p/>
                    For each supported key size and associated data length, and any supported payload length, nonce length,
                    and tag length, the evaluator shall supply one key value, one nonce value, and 10 pairs of associated data
                    and payload values, and obtain the resulting ciphertext.
                    <h:p/>
                    <h:b>Variable Payload Test</h:b>
                    <h:p/>
                    For each supported key size and payload length, and any supported associated data length, nonce length,
                    and tag length, the evaluator shall supply one key value, one nonce value, and 10 pairs of associated data
                    and payload values, and obtain the resulting ciphertext.
                    <h:p/>
                    <h:b>Variable Nonce Test</h:b>
                    <h:p/>
                    For each supported key size and nonce length, and any supported associated data length, payload length,
                    and tag length, the evaluator shall supply one key value, one nonce value, and 10 pairs of associated data
                    and payload values, and obtain the resulting ciphertext.
                    <h:p/>
                    <h:b>Variable Tag Test</h:b>
                    <h:p/>
                    For each supported key size and tag length, and any supported associated data length, payload length,
                    and nonce length, the evaluator shall supply one key value, one nonce value, and 10 pairs of associated
                    data and payload values, and obtain the resulting ciphertext.
                    <h:p/>
                    <h:b>Decryption-Verification Process Test</h:b>
                    <h:p/>
                    To test the decryption-verification functionality of AES-CCM, for each combination of supported
                    associated data length, payload length, nonce length, and tag length, the evaluator shall supply a key value
                    and 15 sets of input plus ciphertext, and obtain the decrypted payload. Ten of the 15 input sets supplied
                    should fail verification and five should pass.
                  </test>
                  
                  <test>(conditional, the TSF supports TDES): The evaluator shall test the TDES implementation used to support TLS cipher suites
                    in accordance with NIST SP 800-67 Rev 2, by conducting the following tests:
                    <h:p/>
                    <h:b>Variable Plaintext/Ciphertext Known Answer Test:</h:b>
                    <h:p/>
                    For i=1..64, the evaluator shall verify the encrypt functionality by using
                    Key1=Key2=Key3=0x0101010101010101, and IV=0x0000000000000000, to encrypt plaintext p_1{i}=ith
                    basis vector input as a type 2 input, and comparing the resulting ciphertext=c_1{i} output as a type 2 output
                    to known results indicated in table A.1 of NIST SP800-20.
                    <h:p/>
                    For i=1..64, evaluator shall verify the decrypt functionality by using
                    Key1=Key2=Key3=0x0101010101010101, and IV=0x0000000000000000, to decrypt ciphertext, c_1{i} and
                    verifying the resulting plaintext to p_1{i}, the ith basis vector.
                    <h:p/>
                    <h:b>Inverse/Initial Permutation Known Answer Test:</h:b>
                    For i=1..64, the evaluator shall verify the encrypt functionality by using
                    Key1=Key2=Key3=0x0101010101010101, and IV=0x0000000000000000, to encrypt plaintext p_2{i}=c_1{i}
                    from the Variable Plaintext Known Answer Test, input as a type 5 input, and verifying the resulting
                    ciphertext, c_2{i} output as type 2 output, is equal to the ith basis vector, p_1{i}.
                    <h:p/>
                    For i=1..64, the evaluator shall verify the decrypt functionality by using
                    Key1=Key2=Key3=0x0101010101010101, and IV=0x0000000000000000, to decrypt ciphertext
                    c_2{i]=p_1{i}, input as input type 5, and verifying the resulting plaintext, p_2{i} output as type 2 output, is
                    equal to c_1{i}.
                    <h:p/>
                    <h:b>Variable Key Known Answer Test:</h:b>
                    <h:p/>
                    For i=1..64 not zero mod 8, the evaluator shall verify the encrypt function using Key1{i}=Key2{i}=Key3{i}
                    equal to the vector consisting of a one in the ith position, zeros in all other positions not zero mod 8, and
                    parity bits in positions 0 mod 8 computed to make each byte have odd parity, and using
                    IV=0x0000000000000000, to encrypt plaintext p_3{i}=0x0000000000000000, input as a type 2 input, and
                    comparing the resulting ciphertext, c_3{i} output as a type 2 output to known results indicated in table A.2
                    of NIST SP800-20.
                    <h:p/>
                    For i=1..64 not zero mod 8, the evaluator shall verify the decrypt functionality using the same
                    Key1{i}=Key2{i}=Key3{i} above, and IV=0x0000000000000000, to decrypt ciphertext c_3{i} and comparing
                    the resulting plaintext to 0x0000000000000000.
                    <h:p/>
                    <h:b>Permutation Operation Known Answer Test:</h:b>
                    <h:p/>
                    For i=0..31, the evaluator shall verify the encrypt functionality by using Key1{i}=Key2{i}=Key3{i} equal to
                    the round i key in table A.3 of NIST SP800-20, and IV=0x0000000000000000 to encrypt plaintext =
                    0x0000000000000000, and verifying that the resulting ciphertext c4{i} matches the known result for round
                    I indicated in table A.3 of NSIT SP800-20.
                    <h:p/>
                    For i=0..31, the evaluator shall verify the decrypt functionality by using Key1{i}=Key2{i}=Key3{i} equal to
                    the round I key in table A.3 of NIST SP800-20, and IV=0x0000000000000000 to decrypt ciphertext c4{i}
                    above, and verifying that the resulting plaintext for each round equals 0x0000000000000000.
                    <h:p/>
                    <h:b>Substitution Table Known Answer Test</h:b>
                    <h:p/>
                    For i=0..18, the evaluator shall verify the encrypt functionality by using Key1{i}=Key2{i}=Key3{i} equal to
                    the round i key in table A.4 of NIST SP800-20, and IV=0x0000000000000000 to encrypt the round i
                    plaintext, p4{i} in table A.4 of NIST SP300-20, and verifying that the resulting ciphertext c4{i} matches the
                    known result for round i indicated in table A.4 of NSIT SP800-20.
                    <h:p/>
                    For i=0..18, the evaluator shall verify the decrypt functionality by using Key1{i}=Key2{i}=Key3{i} equal to
                    the round i key in table A.4 of NIST SP800-20, and IV=0x0000000000000000 to decrypt ciphertext =c4{i}
                    above, and verifying that the resulting plaintext matches p4{i} above.
                    <h:p/>
                    <h:b>Monte Carlo Test:</h:b>
                    <h:p/>
                    Three-key test: <h:ul>
                      <h:li>The evaluator shall conduct the Monte Carlo Test for the Cipher Block Chaining (CBC)
                        mode of Triple Data Encryption Algorithm (TDEA) encryption indicated in NIST SP 800-20
                        Section 2.1.5.6 against the TOE, using three distinct keys, Key1 not equal to Key2, Key2
                        not equal to Key3 and Key3 not equal to Key1, and validate the results against a known
                        good implementation of TDEA.</h:li>
                      <h:li>The evaluator shall conduct the Monte Carlo Test for the CBC mode of TDEA decryption
                        indicated in NIST SP 800-20 Section 2.2.5.6 against the TOE, using three distinct keys,
                        Key1 not equal to Key2, Key2 not equal to Key3 and Key3 not equal to Key1, and
                        validate the results against a known good implementation of TDEA.
                      </h:li>
                    </h:ul>
                  </test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
        <ext-comp-def fam-id="FCS_STG_EXT" title="Cryptographic Key Storage">
          <fam-behavior>Components in this family define requirements for the secure storage of cryptographic keys.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="Cryptographic Key Storage" cc-id="fcs_stg_ext.1" id="fcs-stg-ext-1">
          <consistency-rationale>This SFR applies to the storage of persistent private and secret keys which is
            not defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to store persistent secret and private keys
            using a hardware-protected storage mechanism.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>No dependencies.</dependencies>
          <f-element id="fcs-stg-ext-1e1">
            <title>Persistent private and secret keys shall be stored within the TSF using
              <assignable>method of hardware-protected storage</assignable>.</title>
            <note role="application">This requirement ensures that persistent secret keys and private keys are stored
              securely when not in use. Methods of hardware protected storage can be direct
              or via encryption with a KEK which is protected by hardware.
              <h:p/>
              The application notes for FPT_KST_EXT.2.1 contain further discussion of private
              and secret keys referenced by this SFR</note>
            <aactivity>
              <TSS>The evaluator will check the TSS to ensure it lists each persistent secret and private key needed to meet
                the requirements in the ST. For each of these items, the evaluatorshall confirm that the TSS lists for what
                purpose it is used, and how it is stored, and that the storage is hardware-protected.<h:p/></TSS>
              <Guidance>There are no guidance EAs for this component.<h:p/></Guidance>
              <Tests>There are no test EAs for this component.</Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
        <ext-comp-def fam-id="FCS_TTTC_EXT" title="Thru-Traffic TLS Inspection Client Protocol">
          <fam-behavior>Components in this family define requirements for the TOE’s ability to act as a TLS client for the purpose
            of reconstructing the original intended TLS connection that it is inserted into as a proxy.
          </fam-behavior>
        </ext-comp-def>
        
        
        <f-component name="Thru-Traffic TLS Inspection Client Protocol" cc-id="fcs_tttc_ext.1" id="fcs-tttc-ext-1">
          <!--  Note: Where do we want this intro text to go? Schema doesn't support freeform text before an f-element. Do we want to add that or should we put this somewhere else?
            We could put in an app note but the app note is already cluttered and this seems like something we want to give special emphasis to.
          Support for through-traffic processing defined in this module requires that the TSF support the TLS client
          protocol using an implementation that provides the functionality negotiated by any server requested by
          a monitored client that is to be inspected. This functionality may not be appropriate to support
          communications with the TOE for other SFRs in the Base-PP. This SFR describes the TLS connection
          established to support STIP functionality between the TOE and the requested server, such that the TOE is
          operating as the TLS client. Because it may be necessary to support “legacy” TLS versions and cipher suites
          for mission reasons, the SFR requires support for current and legacy TLS versions as well as current and
          legacy cipher suites. -->
          <consistency-rationale>This SFR applies to thru-traffic TLS inspection client protocol which is not
            defined in the Base-PP.</consistency-rationale>
          <comp-lev> defines the types of TLS client connections
            the TSF can support when acting as a proxy.</comp-lev>
          <management>The following actions could be considered for the management functions in FMT: <h:ul>
            <h:li>Ability to configure the cryptographic functionality</h:li>
          </h:ul></management>
          <audit>
            The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST: <h:ul>
              <h:li>Establishment of TLS session.</h:li>
            </h:ul>
          </audit>
          <dependencies>
            FCS_CKM.1 Cryptographic Key Generation<h:p/>
            FCS_CKM.2 Cryptographic Key Distribution<h:p/>
            FCS_COP.1 Cryptographic Operation<h:p/>
            FCS_RBG_EXT.1 Random Bit Generation<h:p/>
            FCS_TTTS_EXT.1 Thru-Traffic TLS Inspection Server Protocol<h:p/>
            FIA_X509_EXT.1 X.509 Certificate Validation<h:p/>
            FIA_X509_EXT.2 X.509 Certificate Authentication<h:p/>
          </dependencies>
          <f-element id="fcs-tttc-ext-1e1"> <!-- Note: TD0577 applied -->
            <title>
              The TSF shall implement [<h:i>TLS 1.2 (RFC 5246), TLS 1.0 (RFC 2246), and <selectables>
                <selectable>TLS 1.1 (RFC 4346)</selectable>
                <selectable>no other SSL or TLS versions</selectable>
              </selectables></h:i>] as a client to the requested server that
              supports only the following cipher suites: [<h:i><h:ul>
                <h:li>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 as defined in RFC 5289</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5288</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_256_CBC_SHA256 as defined in RFC 5246</h:li>
                <h:li>TLS_RSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5288</h:li>
                <h:li>TLS_RSA_WITH_AES_256_CBC_SHA256 as defined in RFC 5246</h:li>
                <h:li>TLS_ECDH_ECDSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384 as defined in RFC 5289</h:li>
                <h:li>TLS_DHE_RSA_ WITH_AES_256_CCM as defined in RFC 6655</h:li>
                <h:li>TLS_RSA_ WITH_AES_256_CCM as defined in RFC 6655</h:li>
                <h:li>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5289</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_128_CCM as defined in RFC 6655</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5288</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5246</h:li>
                <h:li>TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5289</h:li>
                <h:li>TLS_RSA_WITH_AES_128_CCM as defined in RFC 6655</h:li>
                <h:li>TLS_RSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5288</h:li>
                <h:li>TLS_RSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5246</h:li>
                <h:li>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA as defined in RFC 8422</h:li>
                <h:li>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA as defined in RFC 8422</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_256_CBC_SHA as defined in RFC 5246</h:li>
                <h:li>TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA as defined in RFC 8422</h:li>
                <h:li>TLS_RSA_WITH_AES_256_CBC_SHA as defined in RFC 5246</h:li>
                <h:li>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA as defined in RFC 8422</h:li>
                <h:li>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA as defined in RFC 8422</h:li>
                <h:li>TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA as defined in RFC 8422</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_128_CBC_SHA as defined in RFC 5246</h:li>
                <h:li>TLS_RSA_WITH_AES_128_CBC_SHA as defined in RFC 5426</h:li>
                <h:li>TLS_RSA_WITH_AES_128_CCM_8 as defined in RFC 6655</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_128_CCM_8 as defined in RFC 6655</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_256_CCM_8 as defined in RFC 6655</h:li>
                <h:li>TLS_RSA_WITH_AES_256_CCM_8 as defined in RFC 6655</h:li>
              </h:ul>
                <selectables linebreak="yes">
                  <selectable>TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA as defined in RFC 8422</selectable>
                  <selectable>TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA as defined in RFC 5246</selectable>
                  <selectable>TLS_RSA_WITH_3DES_EDE_CBC_SHA as defined in RFC 5246</selectable>
                  <!-- Note: do we really want an open-ended assignment here? seems like it would create a problem for dependencies
                  (e.g. if chacha20 suites are claimed there is no supporting claim that the TSF implements this aglrotihm properly) -->
                  <selectable><assignable>other supported cipher suites</assignable></selectable>
                  <selectable>no other cipher suites</selectable>
                </selectables>
              
              </h:i>] and also supports functionality for <selectables linebreak="yes">
                <selectable id="clientAuth">mutual authentication</selectable>
                <selectable id="clientRenegotiation">session renegotiation</selectable>
                <!-- Note: is it ok that we changed this selection to make the SFR parse better if it's chosen -->
                <selectable>neither mutual authentication nor session renegotiation</selectable>
              </selectables>.
            </title>
            <ext-comp-def-title>
              <title>
                The TSF shall implement <assignable>TLS versions</assignable> as a client to the requested
                server that supports only the following cipher suites: <assignable>list of cipher suites
                and reference to RFC in which each is defined</assignable> and also supports functionality for <selectables linebreak="yes">
                  <selectable>mutual authentication</selectable>
                  <selectable>session renegotiation</selectable>
                  <selectable>neither mutual authentication nor session renegotiation</selectable>
                </selectables>.
              </title>
            </ext-comp-def-title>
            <note role="application">TLS version 1.2 and 1.0 must be supported; support for TLS version 1.1 is optional,
              and should be chosen if the STIP supports it. The list of cipher suites to support is
              mandatory but includes some selections in order to support legacy servers that
              may be required by the monitored clients; additional cipher suites can be included
              in the assignment. The order of the cipher suites above should be maintained in
              the ST; FCS_TTTC_EXT.1.4 indicates that the cipher suites are presented in order
              of preference in the Client Hello sent to the requested server, and that preference
              is defined as the order in the above SFR.
              <h:p/>
              The above list (as instantiated in the ST) limits the cipher suites that may be
              proposed by the TOE to the requested server. Behavior if the requested server
              responds with a cipher suite that is not in the list is defined in FDP_TEP_EXT.1.8.
              <h:p/>
              The selection should indicate if mutual authentication and/or session
              renegotiation is supported. These selections must be the same for both
              FCS_TTTC_EXT.1.1 and FCS_TTTS_EXT.1.1. If mutual authentication is selected,

              the requirements in Section B.4 will be included by the ST author. For this
              technology, mutual authentication is not desirable on these connections because
              the STIP will have to issue a certificate representing the client to the requested
              server, and the server will have to have a trust anchor for that certificate. If session
              renegotiation is selection, FCS_TTTC_EXT.4 from Section B.5 will be included by
              the ST author.
              <h:p/>
              The data encryption and decryption algorithms used in this element are
              performed in accordance with FCS_COP.1/STIP.</note>
            <aactivity level="element">
              <TSS>The evaluator will check the description of this protocol in the TSS to ensure that the TLS versions and
                cipher suites supported for inspection of TLS sessions are included. The evaluator shall check the TSS to
                ensure that the TLS versions and cipher suites specified for processing such traffic include those listed in
                FCS_TTTC_EXT.1.1, and no others. The evaluator shall ensure the TSS describes how the cipher suites 
                included in a Client Hello message to a specific requested server might be restricted in accordance with
                allowances described in the TLS session establishment policy. 
              <h:p/></TSS>
              <Guidance>
                The evaluator shall check the guidance documentation to ensure it contains instructions on configuring
                the TOE so that the versions and cipher suites used conform with FCS_TTTC_EXT.1.1 and the configured
                TLS session establishment policy.
                <h:p/>
                The evaluator shall verify that the operational guidance includes instructions for setting the reference identifier
                to be used for the purposes of certificate validation in TLS. 
              <h:p/></Guidance>
              <Tests>
                The evaluator shall establish one or more monitored clients and requested servers that are
                configured to pass TLS sessions through the TOE, and configure the SSL/TLS inspection proxy policy to use
                the inspection operation for these clients and servers with all supported versions and cipher suites in its
                allowed set. The evaluator shall configure the monitored client to present a TLS Client Hello with TLS
                version 1.2 and the full list of supported cipher suites, and use the SNI extension to indicate the DNS name
                of the requested server for each test. The evaluator shall establish a certification authority (the trusted
                CA) able to issue certificates for the servers as indicated in the following tests, and install the certification
                authority’s certificate in appropriate trust anchors within the TSF to validate the issued certificates.
                Additional configuration instructions for the monitored client, the requested server or the server’s
                certificate are indicated in each of the tests: 

                <testlist>
                  <test id="tttc-ciphers">For each version and cipher suite combination supported, as indicated in FCS_TTTC_EXT.1.1, the
                    evaluator shall configure a server requested by a monitored client to negotiate the version and cipher
                    suite, and issue the server a valid certificate from the trusted CA containing a subjectAltName (SAN) extension
                    containing the expected DNS name of the server. The evaluator shall then initiate a TLS session from a monitored client through the
                    TOE to the requested server, as indicated in the SNI extension of the Client Hello, and observe that the
                    TLS session between the TOE and the requested server cipher suites is successful. Additionally, the
                    evaluator shall verify that the Client Hello sent from the TSF to the requested server contains the full,
                    ordered list of cipher suites supported for the selected version in accordance with FCS_TTTC_EXT.1.4.
                  </test>
                  <test id="tttc-eku">
                    The evaluator shall choose a supported version and cipher suite combination. For each
                    extendedKeyUsage condition for server certificates that allows the TLS session to be completed, as
                    indicated in FIA_X509_EXT.1.1/STIP, the evaluator shall configure a requested server to negotiate the
                    version and cipher suite combination and issue the requested server a new certificate from the trusted
                    CA that has the indicated extendedKeyUsage condition, and is otherwise identical to the certificate used
                    for the similarly configured server from <xref to="tttc-ciphers"/>. The evaluator shall configure the server to present the new
                    certificate in its TLS handshake. The evaluator shall then make a TLS request in turn from a monitored
                    client to each of the reconfigured servers through the TOE, and observe that the TLS session from the TOE
                    to the requested server is established.
                  </test>
                  <test>
                    The evaluator shall establish a new certificate for a server as configured for <xref to="tttc-eku"/> where the
                    extendedKeyUsage field is present, does not include either the ‘Any’ purpose or
                    ServerAuthentication purpose and which does contain the CodeSigning purpose, and configure the server
                    to present the new certificate in its TLS handshake. The evaluator shall make a request to that server from
                    a monitored client through the TOE and verify that the TLS session between the TSF and the server is
                    attempted, but fails. 
                  </test>
                  <test>
                    For each of the following, the evaluator shall issue a new certificate as specified from the trusted
                    CA containing the indicated public key type for a server configured to negotiate a supported version and
                    cipher suite as specified, so the server presents a certificate with a signature or static public key type that
                    is incompatible with the negotiated cipher suite: <h:ol type="a">
                      <h:li>For a supported cipher suite that uses RSA for signature, the evaluator shall issue a certificate
                      containing an Elliptic Curve Digital Signature Algorithm (ECDSA) public key to represent a
                      server configured to negotiate the cipher suite</h:li>
                      <h:li>For a supported cipher suite that uses ECDSA for signature, the evaluator shall issue a
                      certificate containing an RSA public key to represent a server configured to negotiate the
                      cipher suite</h:li>
                      <h:li>For a supported cipher suite that uses RSA for key transport, the evaluator shall issue a
                      certificate containing a Diffie-Hellman (DH) public key to represent a server configured to
                      negotiate the cipher suite</h:li>
                      <h:li>For a supported cipher suite that uses RSA for key transport, the evaluator shall issue a
                      certificate containing an Elliptic-Curve Diffie-Hellman (ECDH) public key to represent a server
                      configured to negotiate the cipher suite</h:li>
                      <h:li>For a supported cipher suite that uses static DH key establishment, the evaluator shall issue a
                      certificate containing an RSA public key to represent a server configured to negotiate the
                      cipher suite</h:li>
                      <h:li>For a supported cipher suite that uses static DH key establishment, the evaluator shall issue a
                      certificate containing an ECDH public key to represent a server configured to negotiate the
                      cipher suite</h:li>
                      <h:li>For a supported cipher suite that uses static ECDH, the evaluator shall issue a certificate
                      containing an RSA public key that represents a server configured to negotiate the cipher suite</h:li>
                      <h:li>For a supported cipher suite that uses static ECDH, the evaluator shall issue a certificate
                      containing a DH public key that represents a server configured to negotiate the cipher suite.</h:li>
                    </h:ol><h:p/>
                    The evaluator shall make, in turn, a TLS request to each so-configured server from a monitored client. In
                    each case, the evaluator shall observe that the TSF attempts to establish a TLS session with the requested
                    server and after the server negotiates the cipher suite, the evaluator shall send the new certificate in a
                    server certificate message to the TSF in the place of the expected certificate message, and observe that
                    the TSF does not establish a TLS session with the server. 
                  </test>
                  <test>The evaluator shall configure a server to select the TLS_NULL_WITH_NULL_NULL cipher suite. The
                    evaluator shall make a request from a monitored client to the so configured server and verify that the TLS
                    session between the TSF and the server is attempted but not established.</test>
                  <test>
                    For each of the following, the evaluator shall configure a requested server to negotiate a supported
                    version and cipher suite, as indicated, and use a valid certificate from the trusted CA, but send TLS
                    messages as indicated and otherwise respond as a valid TLS server. For each in turn, the evaluator shall
                    initiate a TLS connection between a monitored client and the requested server through the TOE and
                    observe the indicated behavior of the TOE on receiving the server message: 
                    
                    <testlist>
                      <test> Configure the requested server to send an undefined TLS version (for example, 1.5
                        represented by the two bytes 03 06) and verify that the TSF rejects the connection.</test>
                      <test>  Configure the requested server to send a Server Hello with the TLS version set to
                        SSL 3.0 (represented by the two bytes 03 00) and verify that the TSF rejects the connection.</test>
                      <test>  Configure the requested server to use a DHE cipher suite and configure the
                      requested server to send a Server Hello message with at least one byte in the server’s nonce 
                      in the Server Hello handshake message modified from the expected response, and verify
                      that the TSF rejects the connection. Repeat this test using a requested server configured to
                      use an ECDHE cipher suite and observe that the TSF rejects the connection.</test>
                      <test>  Configure the requested server to respond to a Client Hello with a cipher suite that
                      is not supported by the TSF, and therefore not present in the Client Hello received by the
                      server. The evaluator shall verify that the TSF rejects the connection.</test>
                      <test>  Using requested servers configured to use a cipher suite using DHE, and send a
                      KeyExchange handshake message with an invalid signature (e.g., by modifying the signature
                      block in the expected KeyExchange handshake message), and verify that the TSF rejects the
                      connection. Repeat this test with a requested server configured to use a cipher suite using
                      ECDHE and verify that the TSF rejects the connection.</test>
                      <test>Configure the requested server to respond with an invalid Server Finished message
                      (e.g., by modifying a byte in the expected Server Finished handshake message) and verify
                      that the TSF rejects the connection.</test>
                    </testlist>
                    
                  </test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-tttc-ext-1e2">
            <title>The TSF shall verify that the presented identifier matches the reference identifier
              of the server requested by the monitored client using methods described in RFC
              6125 section 6 for DNS name types, and via exact, byte-by-byte matching for IP
              address name types.</title>
            <note role="application">
              The rules for verification of identity are described in Section 6 of RFC 6125. The
              monitored client may specify the server name in the SNI extension of the Client
              Hello, or via some other method (e.g., DNS lookup) supported by the TSF. The
              method for determining that the identity presented matches that expected by the
              client should be fully described in the ST.
              <h:p/>
              Additionally, support for use of IP addresses in the Subject Name or Subject
              Alternative Name of TLS server certificates is discouraged as against best practices
              but may be implemented by requested servers. When no DNS name type reference
              ID is available from the monitored client and the certificate presented by the 
              requested server includes an IP address name type, exact byte-by-byte matching
              of the IP address to an IP address reference ID is required. If the certificate does
              not contain an identifier of type IP address, and no other name type is included as
              a reference Identifier, the IP address from the underlying transport layer protocol
              between the TSF and the requested servers should match the IP address reference
              identifier.
            </note>
            <aactivity level="element">
              <TSS>
                The evaluator shall ensure that the TSS describes the TSF method of establishing all reference identifiers
                for through-traffic processing, including which types of reference identifiers are supported and whether
                IP addresses and wildcards are supported. The evaluator shall ensure that the TSS describes how the TSF
                determines reference identifiers from the various identity attributes associated to the requested server
                and match what is expected by the monitored client. The evaluator shall ensure that the TSS describes
                how the reference identifiers are matched to the identifiers presented in the server’s certificate.
              <h:p/></TSS>
              <Guidance>The evaluator shall ensure that the guidance contains instructions on establishing reference identifiers if
                supported through an administrative interface.<h:p/></Guidance>
              <Tests>
                Using the setup for FCS_TTTC_EXT.1.1, the evaluator shall perform the following tests. Note that <xref to="tttc-ciphers"/> of
                FCS_TTTC_EXT.1.1 confirms the TSF properly validates the reference ID of a certificate containing a DNS
                name in the subjectAltName matching the SNI contained in the Client Hello of a monitored client, and is
                not repeated. The remaining tests cover support for other name forms and negative testing.
                <testlist>
                  <test>The evaluator shall issue a certificate from the trusted CA that represents a requested server that
                    contains a SAN extension with a valid DNS name type. The evaluator shall configure the requested server
                    to use a valid, supported version and cipher suite combination consistent with the certificate, and provide
                    the certificate in response to a TLS request. The evaluator shall establish a TLS session from a monitored
                    client to the requested server through the TOE using an SNI extension in the Client Hello that does not
                    match the name in the certificate. The evaluator shall ensure the TOE does not succeed in establishing a
                    TLS connection to the requested server.</test>
                  <test>(conditional, the TSF supports additional reference identifiers not used in FCS_TTTC_EXT.1.1 <xref to="tttc-ciphers"/>): 
                    For each additional reference identifier described in the TSS, the evaluator shall establish a
                    monitored client and requested server that causes the TSF to establish a reference identifier of the
                    indicated type. The evaluator shall issue a new certificate for the requested server from the trusted CA
                    which contains a name of the same type in the subject name or the SAN extension as appropriate for the
                    reference identifier, and that matches the reference identifier. The evaluator shall configure the
                    requested server to use a valid, supported version and cipher suite combination consistent with the
                    certificate, and provide the new certificate in a valid server certificate message. The evaluator shall initiate
                    a TLS session from the monitored client to the requested server through the TOE and observe that the
                    TSF establishes the TLS session to the requested server. </test>
                  <test>(conditional, the TSF supports additional reference identifiers): For each additional reference
                    identifier described in the TSS, the evaluator shall establish a monitored client and requested server to
                    cause the TSF to use the indicated reference identifier and issue a certificate for a server from the trusted
                    CA that contains a name of the same type in the subject name or the SAN extension as appropriate for
                    the reference identifier, but that does not match the reference identifier. The evaluator shall configure
                    the requested server to use a valid, supported version and cipher suite combination consistent with the
                    certificate, and provide the new certificate in a valid server certificate message. The evaluator shall initiate
                    a TLS session between the monitored client and the server through the TOE and observe that the TSF does
                    not establish a valid TLS session to the requested server.
                  </test>
                  <test>The evaluator shall perform the following wildcard tests with each type of reference identifier
                    based on DNS name types. This test is not intended for reference identifiers using IP addresses. The
                    support for wildcards is intended to be optional. If wildcards are supported, the first, second, and third
                    tests below shall be executed. If wildcards are not supported, then the fourth test below shall be executed.
                    For each test, the evaluator shall establish a monitored client and requested server, issue the requested
                    server a valid certificate with the specified identifier from the trusted CA, and configure the server to use
                    a valid version and cipher suite combination consistent with the certificate. The evaluator shall configure
                    the monitored client and requested server in such a way that causes the TSF to establish the indicated
                    reference identifiers. For each certificate identifier presented and for each reference identifier specified,
                    the evaluator shall initiate a TLS session between the monitored client and requested server through the
                    TSF, causing the TSF to attempt to match the presented identifier to the established reference identifier
                    and observe the indicated result: 
                    <testlist>
                      <test> (conditional, the TSF supports wildcards): The evaluator shall use a server certificate
                      containing a wildcard that is not in the left-most label of the presented identifier (e.g.,
                      foo.*.example.com) and verify that the connection fails.</test>
                      <test> (conditional, the TSF supports wildcards): The evaluator shall use a server certificate
                      containing a wildcard in the left-most label but not preceding the public suffix (e.g.,
                      *.example.com). The evaluator shall cause the reference identifier to have a single left-most
                      label (e.g., foo.example.com) and verify that the connection succeeds. The evaluator shall
                      cause the reference identifier to be without a left-most label as in the certificate (e.g.,
                      example.com) and verify that the connection fails. The evaluator shall cause the reference
                      identifier to have two left-most labels (e.g., bar.foo.example.com) and verify that the
                      connection fails.</test>
                      <test> (conditional, the TSF supports wildcards): The evaluator shall use a server certificate
                      containing a wildcard in the left-most label immediately preceding the public suffix (e.g.,
                      *.com). The evaluator shall cause the reference identifier to have a single left-most label
                      (e.g., foo.com) and verify that the connection fails. The evaluator shall cause the reference
                      identifier to have two left-most labels (e.g., bar.foo.com) and verify that the connection
                      fails.</test>
                      <test> (conditional, the TSF does not support wildcards): The evaluator shall use a server
                      certificate containing a wildcard in the left-most label (e.g., *.example.com). The evaluator
                      shall cause the reference identifier to have a single left-most label (e.g., foo.example.com)
                      and verify that the connection fails.</test>
                    </testlist>
                  </test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-tttc-ext-1e3">
            
            <title>The TSF shall validate the certificate presented by the server and terminate the
              connection if the certificate is invalid, except as allowed by FIA_X509_EXT.2.2<h:b>/STIP</h:b>.</title>
            <ext-comp-def-title>
              <title>The TSF shall validate the certificate presented by the server and terminate the
                connection if the certificate is invalid, except as allowed by FIA_X509_EXT.2.2.</title>
            </ext-comp-def-title>
            <note role="application">
              Validity is determined by the identifier verification, certificate path, the expiration
              date, processing of critical extensions, and the revocation status in accordance
              with RFC 5280. Certificate validity is specified by and tested in accordance with
              FIA_X509_EXT.1/STIP. The result of the checks will be one of 1) the certificate is
              valid; 2) the certificate is invalid; 3) the validity of the certificate is indeterminate
              because a connection cannot be established to check the revocation status of the
              certificate (but all other validity checks have passed). FCS_X509_EXT.2.2 (in
              conjunction with FDP_TEP_EXT.1.5) indicates what the TSF is supposed to do if a
              connection cannot be established to check the revocation status for this
              connection (the TOE to a requested server).
            </note>
            <aactivity level="element">
              <TSS>
                The evaluator shall ensure that the TSS describes the TSF’s behavior for certificate validation results,
                including any dependencies on the configured TLS session establishment policy for establishing a TLS
                session when revocation information is not available, as indicated in the selection for FIA_X509_EXT.2.2/STIP.
              <h:p/></TSS>
              <Guidance>
                If the TSS indicates that the TLS session establishment policy is used to determine the TSF’s behaviour for
                establishing a TLS session for through-traffic processing when certificate revocation information is not
                available, the evaluator shall validate that the operational guidance includes instructions to configure the
                allowances to allow or not allow such connections.
              <h:p/></Guidance>
              <Tests>Using the setup for <xref to="tttc-ciphers"/> of FCS_TTTC_EXT.1.1, the evaluator shall establish one or more trusted
                subordinate CAs by issuing them valid CA certificates from the trusted CA. The evaluator shall establish a
                certificate status capability for both the trusted subordinate CAsand the trusted CA that uses a method
                supported by the TSF. The evaluator shall also establish an untrusted CA to use a self-signed CA certificate
                not loaded into the TSF trust store. The evaluator shall establish one or more requested servers to use a
                valid TLS version and cipher suite combination and to respond using valid TLS handshake messages except
                for the certificate message and certificate verify messages as described in each test. The evaluator shall
                issue certificates for the following tests to the requested server that have the indicated failures, initiate a
                TLS session from a monitored client through the TOE to the requested server presenting the certificate
                with the indicated failures, and verify that the TSF terminates the TLS handshake with the requested
                server:
                <testlist>
                  <test>The evaluator shall issue a valid certificate for the requested server from the untrusted CA. The
                    evaluator shall confirm that the TSF rejects the TLS session with the requested server when it presents a
                    valid certificate message and certificate verify message using the certificate issued by the untrusted CA.</test>
                  <test>The evaluator shall issue a valid certificate for the requested server by the subordinate CA, but not
                    load it into the TSF trust store, and shall ensure the requested server does not provide the subordinate
                    CA in the certificate chain. The evaluator shall confirm that the TSF rejects the TLS session with the
                    requested server when the server presents a valid certificate message and certificate verify message using
                    the certificate that does not properly chain to a trusted root.</test>
                  <test>The evaluator shall establish a valid certificate for the requested server issued by the subordinate
                    CA, and establish valid revocation information from the trusted subordinate CA using a supported
                    mechanism for end-entity certificates, indicating the requested server’s certificate is revoked. The
                    evaluator shall ensure the subordinate CA is included in the certificate chain provided by the requested
                    server and the revocation information is available. The evaluator shall confirm that authentication fails.</test>
                  <test>The evaluator shall issue a valid certificate for the requested server from the subordinate CA, and
                    establish valid revocation information from the subordinate CA using a supported mechanism for endentity certificates, indicating the requested server’s certificate is revoked. The evaluator shall ensure the
                    subordinate CA is included in the certificate chain provided by the requested server and ensure the
                    revocation information is not available to the TSF. The evaluator shall confirm that the default behavior
                    for revocation information not available is performed by the TSF. If this behavior is configurable (the first
                    item is claimed in the first selection for FIA_X509_EXT.2.2/STIP), the evaluator shall in turn follow guidance 
                    documentation to configure the TSF for each response, and initiate the TLS session from the monitored
                    client to demonstrate the TSF performs the configured behavior.
                  </test>
                  <test>The evaluator shall issue a valid certificate for the requested server from the subordinate CA, and
                    generate valid revocation information from the trusted subordinate CA using a supported mechanism for
                    end-entity certificates, indicating the requested server’s certificate is valid, and generate valid revocation
                    information from the trusted CA using a supported mechanism for CA certificates, indicating the
                    subordinate CA’s certificate is revoked. The evaluator shall ensure the subordinate CA is included in the
                    certificate chain provided by the requested server and all revocation information is available. The
                    evaluator shall confirm that authentication fails.
                  </test>
                  <test>The evaluator shall issue a valid certificate for the requested server from trusted subordinate CA,
                    and generate valid revocation information from the trusted subordinate CA using a supported mechanism
                    for end-entity certificates indicating the requested server’s certificate is valid, and generate valid
                    revocation information from the trusted CA using a supported mechanism for CA certificates, indicating
                    the subordinate CA’s certificate is revoked. The evaluator shall ensure the subordinate CA is included in
                    the certificate chain provided by the requested server and the revocation information from the
                    subordinate CA is available, but revocation information from the trusted CA is not available to the TSF.
                    The evaluator shall confirm that the default behavior for revocation information not available is
                    performed by the TSF. If this behavior is configurable (the first item is claimed in the selection for
                    FIA_X509_EXT.2.2/STIP), the evaluator shall, in turn, follow guidance documentation to configure the TSF for each
                    response, and initiate the TLS session from the monitored client to demonstrate the TSF performs the
                    configured behavior. </test>
                  <test>The evaluator shall issue a valid certificate from the trusted CA for the requested server that
                    expires prior to initiating the TLS session from the monitored client, and generate revocation information
                    indicating the requested server’s certificate is not revoked. The evaluator shall initiate a TLS session from
                    the monitored client to the requested server through the TOE after the certificate has expired, and ensure
                    the certificate status information from the trusted CA is available to the TSF. The evaluator shall observe
                    that the TSF fails to establish the TLS connection with the requested server, demonstrating that a server
                    using a certificate which has passed its expiration date results in an authentication failure.</test>
                  <test>The evaluator shall establish a new subordinate CA from the trusted CA, by issuing the subordinate
                    CA a certificate that expires prior to initiating the TLS session from the monitored client. The evaluator
                    shall issue a valid certificate for the requested server from the subordinate CA but which does not expire
                    prior to initiating the TLS session from the monitored client and generate valid revocation information
                    using supported methods indicating both the subordinate CA and the server’s certificate are not revoked.
                    The evaluator shall initiate a TLS session from the monitored client to the requested server through the
                    TOE and observe that the TLS session between the TSF and requested server fails, demonstrating that a
                    server using a valid certificate (not yet expired) issued by a subordinate CA that has passed its expiration
                    date results in an authentication failure.</test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-tttc-ext-1e4">
            <title>The TSF shall formulate the Client Hello such that it presents the highest version
              of the TLS protocol supported by the proxy function in the version field, and
              presents the list of cipher suites in descending order of preference associated with
              requested server.</title>
            <note role="application">
              This applies to the initial Client Hello sent to the requested server. This may result
              in a connection being established for an inspect operation, or may not lead to a
              connection if a bypass or block operation is determined. It should be noted that
              this transaction may be made even though the result will eventually be block or
              bypass, because the rule (see FDP_TEP_EXT.1) may require the verified identity of
              the server, so this connection would be required so that the server certificate could
              be obtained and verified.
            </note>
            <aactivity level="element">
              <TSS>The evaluator shall ensure that the TSS includes a description of cipher suite dependence on the TLS
                session establishment policy allowances and that the ordering of cipher suites within a Client Hello sent
                by the TSF to a requested server is in accordance with FCS_TTTC_EXT.1.4.
              <h:p/></TSS>
              <Guidance>The evaluator shall ensure that the operational guidance documents include instructions on configuring the TLS
                session establishment policy to restrict the inclusion of cipher suites in a Client Hello to a particular
                requested server for through-traffic processing.<h:p/></Guidance>
              <Tests>Setup: The evaluator shall establish one or more monitored clients and requested servers that are
                configured to pass TLS sessions through the TOE, and configure the TLS session establishment policy to
                use the inspection operation for these clients and servers, allowing negotiation of TLS 1.2, but not any
                other version, and allowing only a subset of cipher suites indicated in FCS_TTTC_EXT.1.1 consisting of a
                single cipher suite supported for each supported TLS version. The evaluator shall issue certificates for the
                servers that are valid in accordance with FIA_X509_EXT.1/STIP, and install the appropriate trust anchors
                within the TSF to validate the certificates (the trusted CA). Additional configuration instructions for the
                monitored client, the requested server or the server’s certificate are indicated in each of the tests.
              <testlist>
                <test>For each supported version other than TLS 1.2, the evaluator shall configure a server requested by
                  a monitored client to negotiate the version and an allowed cipher suite for that version, regardless of the
                  Client Hello message received. The evaluator shall, in turn, establish a TLS connection from the monitored
                  client to the requested server through the TOE and observe that the TSF sends a Client Hello to the
                  requested server that includes the allowed version and cipher suites, in the order indicated in
                  FCS_TTTC_EXT.1.1. The evaluator shall confirm that the requested server sends the TOE a Server Hello
                  indicating the configured version and cipher suite, and confirm that the TSF responds by terminating the
                  TLS handshake with the requested server.</test>
                <test>The evaluator shall follow operational guidance to reconfigure the TLS session establishment policy to
                  allow any supported version to the requested servers, but only allow the subset of cipher suites as
                  indicated in the setup. For each supported version, the evaluator shall configure the requested server to
                  negotiate the version and a valid cipher suite for that version which is included in FCS_TTTC_EXT.1.1, but
                  not allowed for the requested server, as in the setup, regardless of the Client Hello received. The evaluator
                  shall in turn initiate a TLS session from the monitored client to the requested server configured for the
                  supported version, through the TOE. The evaluator shall observe that the Client Hello generated by the
                  TSF specifies version 1.2 and the allowed cipher suites in the order indicated in FCS_TTTC_EXT.1.1. The
                  evaluator shall confirm that the server sends the TOE a Server Hello message as configured and confirm
                  that the TSF responds by terminating the TLS handshake with the requested server.</test>
              </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Establishment of TLS session</audit-event-descr>
            <audit-event-info>TLS session parameters</audit-event-info>
          </audit-event>
        </f-component>
        
        <f-component name="Thru-Traffic TLS Inspection Client Support for Supported Groups Extension" cc-id="fcs_tttc_ext.5" id="fcs-tttc-ext-5">
          <consistency-rationale>This SFR applies to client supported groups extension for thru-traffic TLS
            inspection.</consistency-rationale>
          <comp-lev> requires the
            TSF to use the TLS Supported Groups Extension when establishing a proxy connection to a requested
            server to ensure the use of appropriate key establishment parameters</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>FCS_TTTC_EXT.1 Thru-Traffic TLS Inspection Client Protocol</dependencies>
          <f-element id="fcs-tttc-ext-5e1">
            <title>
              The TSF shall present the Supported Groups Extension in the Client Hello with the supported groups 
                <selectables linebreak="yes">
                  <selectable>secp256r1</selectable>
                  <selectable>secp384r1</selectable>
                  <selectable>secp521r1</selectable>
                  <selectable>ffdhe2048(256)</selectable>
                  <selectable>ffdhe3072(257)</selectable>
                  <selectable>ffdhe4096(258)</selectable>
                  <selectable>ffdhe6144(259)</selectable>
                  <selectable>ffdhe8192(260)</selectable>
                  <selectable><assignable>other supported curves]</assignable></selectable>
                </selectables>.
            </title>
            <ext-comp-def-title>
              <title>
                The TSF shall present the Supported Groups Extension in the Client Hello with the
                supported groups <assignable>list of permissible Supported Groups values</assignable>.
              </title>
            </ext-comp-def-title>
            <note role="application">
              Since support for all of the cipher suites listed in FCS_TTTC_EXT.1.1 is required, at
              least one of the curves and one of the finite field groups must be chosen by the ST
              author as appropriate for the cipher suites and the implementation.
              <h:p/>
              If additional elliptic curves are supported, ST author should describe the elliptic
              curve parameters for each supported elliptic curve in the assignment in
              accordance with RFC 7919. No additional Diffie-Hellman groups should be claimed
              in the assignment.
              <h:p/>
              The Supported Groups Extension was previously referred to as the Supported
              Elliptic Curves Extension and is described in RFC 7919.
              <h:p/>
              Since a requested server session might not adhere to RFC 7919 processing rules,
              the TOE should accept additional DH groups that might be presented in the
              requested server’s key exchange message.
            </note>
            <aactivity>
              <TSS>The evaluator shall check the TSS and ensure that it describes the supported groups extension. The
                evaluator shall ensure the TSS describes any configurable aspects of the use of supported groups,
                including configuration of allowances controlling the use of curves other than the NIST named curves,
                secp256r1, secp384r1, or secp521r1, if supported.<h:p/></TSS>
              <Guidance>If the TSS indicates that the TOE must be configured to meet FCS_TTTC_EXT.5.1 requirements for the
                Supported Elliptic Curves Extension, the evaluator shall verify the operational guidance includes instructions for
                configuration of the Supported Elliptic Curves Extension.
              <h:p/></Guidance>
              <Tests>
                <testlist>
                   <test>The evaluator shall establish a requested server to negotiate a supported version and cipher suite
                   using ECDSA signature and ECDHE key exchange using a custom elliptic curve not included in
                   FCS_TTTC_EXT.5.1, regardless of the Client Hello received. The evaluator shall follow operational guidance to
                   configure the TLS session establishment policy so the TSF inspects traffic to the so configured server from
                   a monitored client. The evaluator shall initiate a TLS session to the requested server from the monitored
                   client through the TOE and observe that the TSF sends a Client Hello to the requested server, and receives
                   the configured server Hello Message from the requested server. The evaluator shall confirm that the TSF
                   terminates the TLS handshake with the requested server.</test>
                  <test>(conditional, the TSF supports additional elliptic curves that are managed via TLS session establishment policy allowances): 
                    For each elliptic curve claimed in the assignment of FCS_TTTC_EXT.5.1, the evaluator shall establish a
                    requested server to use the curve in a TLS handshake with a supported version and cipher suite using
                    ECDSA signature and ECDHE key exchange, using the curve. The evaluator shall follow operational guidance to
                    configure the TLS session establishment policy to perform the inspection operation for TLS traffic to the
                    server and allow the server to negotiate the additional curve. The evaluator shall initiate a TLS request
                    from a monitored client to the server and observe that the Client Hello sent from the TSF to the requested
                    includes the allowed curve. The evaluator shall confirm that the configured server sends a Server Hello
                    message to the TSF that selects the curve, and that the TSF accepts the connection. </test>
                  <test>(conditional, the TSF supports additional elliptic curves that are managed via TLS session establishment policy allowances): 
                    For each elliptic curve claimed in the assignment of FCS_TTTC_EXT.5.1, the evaluator shall establish a
                    requested server to use the curve in a TLS handshake with a supported version and cipher suite using
                    ECDSA signature and ECDHE key exchange, regardless of the Client Hello received. The evaluator shall
                    follow operational guidance to configure the TLS session establishment policy to perform the inspection
                    operation for TLS traffic to the server, but not allow the server to negotiate the additional curve. The
                    evaluator shall initiate a TLS request from a monitored client to the server and observe that the Supported
                    Groups extension Client Hello sent from the TSF to the requested does not include the curve. The
                    evaluator shall confirm that the configured server sends a Server Hello message to the TSF that selects
                    the curve, and that the TSF terminates the TLS handshake with the requested server.</test>
                </testlist></Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>

        <ext-comp-def fam-id="FCS_TTTS_EXT" title="Thru-Traffic TLS Inspection Server Protocol">
          <fam-behavior>Components in this family define requirements for the TOE’s ability to act as a TLS server for the purpose
            of reconstructing the original intended TLS connection that it is inserted into as a proxy.
          </fam-behavior>
        </ext-comp-def>

        <f-component name="Thru-Traffic TLS Inspection Server Protocol" cc-id="fcs_ttts_ext.1" id="fcs-ttts-ext-1">
          <!--  Note: Where do we want this intro text to go? Schema doesn't support freeform text before an f-element. Do we want to add that or should we put this somewhere else?
            We could put in an app note but the app note is already cluttered and this seems like something we want to give special emphasis to.
          Support for thru-traffic processing defined in this module requires that the TSF support the TLS server
protocol using an implementation that provides functionality expected for the set of monitored clients
being protected by the TOE. In general, the functionality may not be appropriate to support
communications with the TOE for other SFR in the Base-PP. This SFR describes the TLS connection
established to support STIP functionality between the monitored client and the TOE, such that the TOE is
operating as the TLS client. Because it may be necessary to support “legacy” TLS versions and cipher suites
for mission reasons, the SFR requires support for current and legacy TLS versions as well as current and
legacy cipher suites. -->
          <consistency-rationale>This SFR applies to thru-traffic TLS inspection server protocol which is not
            defined in the Base-PP.</consistency-rationale>
          <comp-lev> defines the types of TLS server connections
            the TSF can support when acting as a proxy.</comp-lev>
          <management>The following actions could be considered for the management functions in FMT:
          <h:ul>
            <h:li>Ability to configure the cryptographic functionality.</h:li>
          </h:ul></management>
          <audit>
            The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST: <h:ul>
              <h:li>Establishment of TLS session.</h:li>
            </h:ul>
          </audit>
          <dependencies>
            FCS_CKM.1 Cryptographic Key Generation<h:p/>
            FCS_CKM.2 Cryptographic Key Distribution<h:p/>
            FCS_COP.1 Cryptographic Operation<h:p/>
            FCS_RBG_EXT.1 Random Bit Generation<h:p/>
            FCS_TTTC_EXT.1 Thru-Traffic TLS Inspection Client Protocol<h:p/>
            FIA_X509_EXT.1 X.509 Certificate Validation<h:p/>
            FIA_X509_EXT.2 X.509 Certificate Authentication
          </dependencies>
          <f-element id="fcs-ttts-ext-1e1"> <!-- Note: TD0577 applied -->
            <title>
              The TSF shall implement [<h:i>TLS 1.2 (RFC 5246), TLS 1.0 (RFC 2246), and <selectables>
                <selectable>TLS 1.1 (RFC 4346)</selectable>
                <selectable>no other SSL or TLS versions</selectable>
              </selectables></h:i>] as a server to the monitored client that
              supports only the following cipher suites: [<h:i><h:ul>
                <h:li>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 as defined in RFC 5289</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5288</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_256_CBC_SHA256 as defined in RFC 5246</h:li>
                <h:li>TLS_RSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5288</h:li>
                <h:li>TLS_RSA_WITH_AES_256_CBC_SHA256 as defined in RFC 5246</h:li>
                <h:li>TLS_ECDH_ECDSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384 as defined in RFC 5289</h:li>
                <h:li>TLS_DHE_RSA_ WITH_AES_256_CCM as defined in RFC 6655</h:li>
                <h:li>TLS_RSA_ WITH_AES_256_CCM as defined in RFC 6655</h:li>
                <h:li>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5289</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_128_CCM as defined in RFC 6655</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5288</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5246</h:li>
                <h:li>TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5289</h:li>
                <h:li>TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5289</h:li>
                <h:li>TLS_RSA_WITH_AES_128_CCM as defined in RFC 6655</h:li>
                <h:li>TLS_RSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5288</h:li>
                <h:li>TLS_RSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5246</h:li>
                <h:li>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA as defined in RFC 8422</h:li>
                <h:li>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA as defined in RFC 8422</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_256_CBC_SHA as defined in RFC 5246</h:li>
                <h:li>TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA as defined in RFC 8422</h:li>
                <h:li>TLS_RSA_WITH_AES_256_CBC_SHA as defined in RFC 5246</h:li>
                <h:li>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA as defined in RFC 8422</h:li>
                <h:li>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA as defined in RFC 8422</h:li>
                <h:li>TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA as defined in RFC 8422</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_128_CBC_SHA as defined in RFC 5246</h:li>
                <h:li>TLS_RSA_WITH_AES_128_CBC_SHA as defined in RFC 5426</h:li>
                <h:li>TLS_RSA_WITH_AES_128_CCM_8 as defined in RFC 6655</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_128_CCM_8 as defined in RFC 6655</h:li>
                <h:li>TLS_DHE_RSA_WITH_AES_256_CCM_8 as defined in RFC 6655</h:li>
                <h:li>TLS_RSA_WITH_AES_256_CCM_8 as defined in RFC 6655</h:li>
              </h:ul>
                <selectables linebreak="yes">
                  <selectable>TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA as defined in RFC 8422</selectable>
                  <selectable>TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA as defined in RFC 5246</selectable>
                  <selectable>TLS_RSA_WITH_3DES_EDE_CBC_SHA as defined in RFC 5246</selectable>
                  <!-- Note: do we really want an open-ended assignment here? seems like it would create a problem for dependencies
                  (e.g. if chacha20 suites are claimed there is no supporting claim that the TSF implements this aglrotihm properly) -->
                  <selectable><assignable>other supported cipher suites</assignable></selectable>
                  <selectable>no other cipher suites</selectable>
                </selectables>
              </h:i>] and also supports functionality for <selectables linebreak="yes">
                <selectable id="serverAuth">mutual authentication</selectable>
                <selectable id="serverRenegotiation">session renegotiation</selectable>
                <!-- Note: is it ok that we changed this selection to make the SFR parse better if it's chosen -->
                <selectable>neither mutual authentication nor session renegotiation</selectable>
              </selectables>.
            </title>
            <ext-comp-def-title>
              <title>
                The TSF shall implement <assignable>TLS versions</assignable> as a server to the monitored
                client that supports only the following cipher suites: <assignable>list of cipher suites
                  and reference to RFC in which each is defined</assignable>, and also supports functionality for <selectables linebreak="yes">
                  <selectable>mutual authentication</selectable>
                  <selectable>session renegotiation</selectable>
                  <selectable>neither mutual authentication nor session renegotiation</selectable>
                </selectables>.
              </title>
            </ext-comp-def-title>
            <note role="application">TLS version 1.2 and 1.0 must be supported; support for TLS version 1.1 is optional,
              and should be chosen if the STIP supports it. The list of cipher suites to support is
              mandatory but includes some selections in order to support legacy clients that
              may be required by the organization; additional cipher suites can be included in
              the assignment.
              <h:p/>
              The above list (as instantiated in the ST) limits the cipher suites that may be
              specified by the TOE when responding to the monitored client.
              The data encryption and decryption algorithms used in this element are
              performed in accordance with FCS_COP.1/STIP.
              <h:p/>
            The selection should indicate if mutual authentication and/or session
            renegotiation is supported. These selections must be the same for both
            FCS_TTTC_EXT.1.1 and FCS_TTTS_EXT.1.1. If mutual authentication is selected,
            the requirements in Section B.4 will be included by the ST author. For this
            technology, mutual authentication is not desirable on these connections because
            the STIP will have to issue a certificate representing the client to the requested
            server, and the server will have to have a trust anchor for that certificate. If session
            renegotiation is selected, FCS_TTTS_EXT.4 in section B.5 will be included by the
            ST author.
              <h:p/>
            The data encryption and decryption algorithms used in this element are
            performed in accordance with FCS_COP.1/STIP.</note>
            <aactivity level="element">
              <TSS>The evaluator shall check the description of this protocol in the TSS to ensure that the TLS versions and
                cipher suites supported for establishing a TLS session with a monitored client include those listed in
                FCS_TTTS_EXT.1.1 and determine if configuration is needed to restrict the use of other versions or cipher
                suites. The evaluator shall ensure the TSS description of TLS includes all TLS server handshake messages
                and error alerts used, and conditions for which error alerts are used.
              <h:p/></TSS>
              <Guidance>The evaluator shall check the guidance documentation to ensure it contains instructions as indicated in
                the TSS on configuring the TOE so that the versions and cipher suites used conform with
                FCS_TTTS_EXT.1.1.<h:p/></Guidance>
              <Tests>
                The evaluator shall establish one or more monitored clients and servers that are configured to pass
                TLS sessions through the TOE, and configure the TLS session establishment policy to use the inspection
                operation for these clients and servers with the required versions and cipher suites. The evaluator shall
                establish certificates for the servers that are valid in accordance with FIA_X509_EXT.1/STIP and install the
                appropriate trust anchors within the TSF to validate the certificates. Additional configuration instructions
                for the monitored client, the requested server or the server’s certificate are indicated in each of the tests: 
                <testlist>
                  <test>For each version and each valid cipher suite for the version, as indicated in FCS_TTTS_EXT.1.1, the
                    evaluator shall configure the monitored client to include the version and a list consisting of a single
                    element specifying the indicated cipher suite in the Client Hello. The evaluator shall follow operational guidance
                    to configure the TLS session establishment policy to allow the TSF to negotiate the version and cipher
                    suite for that client. The evaluator shall then initiate a TLS session from the so configured monitored client
                    through the TOE to a requested server and observe that a TLS session between the monitored client and
                    the TSF using the specified version and cipher suite is successful. </test>
                  <test>For each supported version indicated in FCS_TTTS_EXT.1.1, the evaluator shall select a valid cipher
                    suite in FCS_TTTS_EXT.1.1 and configure a monitored client to present the version and a cipher suite list
                    containing the single cipher suite. The evaluator shall follow operational guidance to configure the TLS session
                    establishment policy so that use of the cipher suite is not allowed for the client. The evaluator shall initiate
                    a TLS session from the monitored client through the TOE to a requested server and observe that a TLS
                    session between the monitored client and the TSF is denied. </test>
                  <test>For each supported version other than TLS 1.2 indicated in FCS_TTTS_EXT.1.1, the evaluator shall
                    configure a monitored client to include the version and a cipher suite list consisting of a cipher suite valid
                    for TLS 1.2 and another valid for the version in its Client Hello. The evaluator shall follow operational guidance to
                    configure the TLS session establishment policy to only allow the client to use TLS 1.2. The evaluator shall
                    initiate a TLS session from the monitored client to a requested server through the TOE and observe that
                    a TLS session between the monitored client and the TSF is not established.</test>
                  <test>For each supported version indicated in FCS_TTTS_EXT.1.1, the evaluator shall configure a
                    monitored client to include the version and a cipher suite list consisting of a single
                    TLS_NULL_WITH_NULL_NULL cipher suite. The evaluator shall follow operational guidance to configure the TLS
                    session establishment policy to allow any version and cipher suite for the client. The evaluator shall initiate
                    a TLS session from the monitored client to a requested server through the TOE and observe that the TLS
                    session between the monitored client and the TSF is denied.
                  </test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-ttts-ext-1e2">
            <title>
              The TSF shall deny connections from clients requesting [SSL 2.0, SSL 3.0, and
              <selectables>
                <selectable>TLS 1.1</selectable>
                <!-- Note: is it ok that we changed this selection to make the SFR parse better when it's chosen -->
                <selectable>no other SSL or TLS versions</selectable>
              </selectables>
              for thru-traffic processing.
            </title>
            <ext-comp-def-title>
              <title>The TSF shall deny connections from clients requesting <assignable>unsupported
                TLS versions</assignable> for thru-traffic processing.</title>
            </ext-comp-def-title>
            <note role="application">
              All SSL versions are denied regardless of exception specifications. Any TLS versions
              not selected in FCS_TTTS_EXT.1.1 should be selected here.
            </note>
            <aactivity level="element">
              <TSS>The evaluator shall verify that the TSS contains a description of the denial of SSL versions and TLS versions
                consistent with the selections in FCS_TTTS_EXT.1.2 and determine if configuration is needed to restrict
                the use of those versions.<h:p/></TSS>
              <Guidance>The evaluator shall check the guidance documentation to ensure it contains instructions on configuring
                the TOE as indicated in the TSS so that the versions indicated in FCS_TTTS_EXT.1.2 are denied.
              <h:p/></Guidance>
              <Tests>For each SSL or TLS version indicated in FCS_TTTS_EXT.1.2, the evaluator shall configure a
                monitored client to include the version in its Client Hello. The evaluator shall initiate a TLS session from
                the monitored client to a requested server through the TOE and observe that a TLS session between the
                monitored client and the TOE is not established.<h:p/>
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-ttts-ext-1e3">
            <title>
              The TSF shall perform key establishment for TLS with a monitored client using [<h:i>
                <h:ul>
                  <h:li>RSA with key size 2048 bits, <selectables>
                    <selectable>1024 bits</selectable>
                    <selectable>1536 bits</selectable>
                    <selectable>3072 bits</selectable>
                    <selectable>4096 bits</selectable>
                    <selectable>no other sizes</selectable>
                  </selectables></h:li>
                  <h:li><selectables linebreak="yes">
                    <selectable>Diffie-Hellman parameters of size 2048 bits, 
                      <selectables>
                        <selectable>1024 bits</selectable>
                        <selectable>1536 bits</selectable>
                        <selectable>3072 bits</selectable>
                        <selectable>4096 bits</selectable>
                        <selectable>8192 bits</selectable>
                        <selectable>no other sizes</selectable></selectables></selectable>
                    <selectable>
                      Diffie-Hellman groups ffdhe2048, <selectables> 
                      <selectable>ffdhe3072</selectable>
                      <selectable>ffdhe4096</selectable>
                      <selectable>ffdhe6144</selectable>
                      <selectable>ffdhe8192</selectable>
                      <selectable>no other groups</selectable>
                      </selectables>
                    </selectable>
                  </selectables>
                  </h:li>
                  <h:li>EC Diffie-Hellman parameters using elliptic curves 
                    <selectables>
                      <selectable>secp256r1</selectable>
                      <selectable>secp384r1</selectable>
                      <selectable>secp521r1</selectable>
                      <selectable><assignable>other curves</assignable></selectable>
                    </selectables> and no other curves.</h:li>
                </h:ul>
              </h:i>
            </title>
            <ext-comp-def-title>
              <title>The TSF shall perform key establishment for TLS with a monitored client using
                <assignable>supported key establishment parameter types and key
                  sizes/identifiers, based on the claimed cipher suites in FCS_TTTS_EXT.1.1</assignable>.</title>
            </ext-comp-def-title>
            <note role="application">
              The selections in this element should indicate all key establishment sizes and/or
              groups supported.
            </note>
            <aactivity level="element">
              <TSS>The evaluator shall verify that the TSS describes the TOE’s supported key agreement parameters for a
                server key exchange message with a monitored client to ensure TOE supports the required key agreement
                parameters and can be limited to use only those indicated in FCS_TTTS_EXT.1.3.
              <h:p/></TSS>
              <Guidance>The evaluator shall check the guidance documentation to ensure it contains instructions on configuring
                the TOE so that the key exchange parameters used conforms with FCS_TTTS_EXT.1.3.<h:p/></Guidance>
              <Tests>
                The evaluator shall establish one or more monitored clients and servers that are configured to pass
                TLS sessions through the TOE, and configure the TLS session establishment policy to use the inspection
                operation for these clients and servers with the required versions and cipher suites. The evaluator shall
                establish certificates for valid servers in accordance with FIA_X509_EXT.1/STIP and install the appropriate
                trust anchors within the TSF to validate the certificates. Additional configuration instructions for the
                monitored client, the requested server, or the server’s certificate are indicated in each of the tests.
                <testlist>
                  <test>For each of the key parameter selections in FCS_TTTS_EXT.1.3, the evaluator shall configure a
                    monitored client to use a valid supported version and cipher suite combination that supports the key
                    parameter, and follow operational guidance to configure the TSF to use a cipher suite supporting the parameters.
                    The evaluator shall initiate a TLS session from the monitored client to a requested server through the TOE,
                    and observe that a TLS session between the monitored client and the TLS uses the key parameters and is
                    successful.</test>
                  <test>The intent of this test is to show that the TSF properly handles unexpected KeyExchange messages
                    from a client that does not agree with the negotiated cipher suite.
                    <h:p/>
                    For each of the key parameter selections claimed for FCS_TTTS_EXT.1.3, the evaluator shall configure a
                    monitored client and follow operational guidance to configure the TSF to use a cipher suite supporting the
                    parameters.
                    <h:p/>
                    For each such configuration, the evaluator shall, in turn, initiate a number of TLS sessions from the
                    monitored client to a requested server through the TOE, interrupting the TLS exchanges after receiving a
                    server certificate from the TSF and sending the specified client KeyExchange message and observe the
                    results as indicated below:  
                  <h:ol type="a">
                    <h:li>For a cipher suite that uses RSA for key transport, the evaluator shall, in turn, perform each
                      of the following: <h:ol type="i">
                        <h:li>First, send a KeyExchange message of RSA
                          type with the EncryptedPreMasterSecret field consisting of a randomly generated value
                          of size equal to the size of the EncryptedPreMasterSecret expected in the key parameter.
                          The evaluator shall observe that the TSF sends a fatal TLS alert message and note the
                          specific alert type received agrees with the TSS description of error messages.</h:li>
                        <h:li>Second, send a KeyExchange message of
                          RSA type with the EncryptedPreMasterSecret field consisting of a randomly generated
                          value of size 1024 bits. The evaluator shall observe that the TSF sends a fatal TLS alert
                          message.</h:li>
                        <h:li>Third, send the TSF a KeyExchange message
                          of DHE type containing a randomly generated ClientDiffieHellmanPublic value of size
                          2048 bits. The evaluator shall observe that the TSF sends a fatal TLS alert message and shall note whether
                          the error message is different than that received when a randomly generated value was used in the EncryptedPreMasterSecret field.</h:li>
                        <h:li>Fourth, send the TSF a KeyExchange
                          message of ECDH type, containing a random point on a curve supported by the TSF, in a
                          EC point format supported by the TSF. The evaluator shall observe that the TSF sends a fatal TLS alert message and shall note whether
                          the error message is different than that received when a randomly generated value was used in the EncryptedPreMasterSecret field.</h:li>
                      </h:ol><h:p/>
                      If the alert messages in the third and fourth case above are identical to that received in the first case,
                      the evaluator shall attempt
                      to verify that the errors are a result of the unexpected KeyExchange message, and not just due to an
                      invalid finished message. It might be necessary to configure additional (debug) logs to be generated by
                      the TSF or examine detailed behavior of the TSF to distinguish unexpected KeyExchange messages from
                      other errors.
                    </h:li>
                    <h:li>
                      For a cipher suite that uses ephemeral DH key establishment:
                      <h:ol type="i">
                        <h:li>First, the evaluator shall modify a byte in the
                          ClientDiffieHellmanPublic value produced by the client, send the modified KeyExchange
                          message to the TSF, and observe that the TSF sends a fatal TLS alert message and note
                          that the specific error message agrees with the TSS description of error messages.</h:li>
                        <h:li>Second, the evaluator shall ensure the TSF is not configured to
                          request client authentication. The evaluator shall send a KeyExchange message
                          consisting of a null value, specifying an implicit Client Diffie-Hellman Public key. 
                          The evaluator shall send the modified KeyExchange message to the TOE, observe that the TSF sends a fatal TLS alert message, and note whether
                          the error message is different than that received when the KeyExchange message included the modified ClientDiffieHellmanPublic value.
                        </h:li>
                        <h:li>Third, the evaluator shall send the TSF a KeyExchange message
                          of RSA type, containing a randomly generated EncryptedPreMasterSecret value of size
                          2048 bits. The evaluator shall observe that the TSF sends a fatal TLS alert message and
                          notes whether the error message is different than that received when the KeyExchange message included the modified ClientDiffieHellmanPublic value.</h:li>
                        <h:li>(conditional, the TSF supports client authentication): Fourth, the
                          evaluator shall configure the TSF to request client authentication. After the TSF sends
                          the client certificate request message, the evaluator shall send the TOE a valid client
                          certificate message followed by a KeyExchange message of ECDH type that contains a
                          random point on a curve supported by the TSF in an ECpoint format supported by the
                          TSF. The evaluator shall observe that the TSF sends a fatal TLS alert message and
                          notes whether the error message is different than that received when the KeyExchange message included the modified ClientDiffieHellmanPublic value.</h:li>
                      </h:ol><h:p/>
                      If the error messages in any of the latter three cases are identical to that provided in the first case, the evaluator shall
                      attempt to verify that the errors are a result of the unexpected KeyExchange message, and not just due
                      to an invalid finished message. It might be necessary to configure additional (debug) logs to be generated
                      by the TSF or examine detailed behavior of the TSF to distinguish unexpected KeyExchange messages from
                      other errors.
                    </h:li>
                    <h:li>
                      If the cipher suite uses ephemeral ECDH key establishment: <h:ol type="i">
                        <h:li>First, the evaluator shall replace the EC point in the
                          KeyExchange message produced by the client with a random point on the curve
                          specified by the TSF’s Server key exchange message, using the same EC point format
                          used in the client’s expected KeyExchangeMessage. The evaluator shall observe that the
                          TSF sends a fatal TLS alert message and the specific alert message agrees with the error
                          message description in the TSS.</h:li>
                        <h:li>Second, the evaluator shall ensure the TSF is not configured to
                          request client authentication, and send the TSF a KeyExchange message consisting of
                          the null value, indicating an implicit client Elliptic Curve Diffie Hellman Public key. The
                          evaluator shall observe that the TSF sends a fatal TLS alert message and notes whether
                          the error message is different than that received when the EC point in the KeyExchange message is replaced
                          with a random point on the curve.</h:li>
                        <h:li>Third, the evaluator shall send the TSF a KeyExchange message
                          of RSA type with a randomly generated 2048-bit value used for the
                          EncryptedPreMasterSecret value. The
                          evaluator shall observe that the TSF sends a fatal TLS alert message and notes whether
                          the error message is different than that received when the EC point in the KeyExchange message is replaced
                          with a random point on the curve. 
                          </h:li>
                        <h:li>Fourth, the evaluator shall send the TSF a KeyExchange
                          message of type DH with a randomly generated 2048-bit value for the
                          ClientDiffieHellman value in place of the ephemeral public key. The
                          evaluator shall observe that the TSF sends a fatal TLS alert message and notes whether
                          the error message is different than that received when the EC point in the KeyExchange message is replaced
                          with a random point on the curve.
                        </h:li>
                      </h:ol><h:p/>
                      If the error messages in any of the latter three cases are identical to that provided in the first case, the evaluator
                      shall attempt to verify that the errors are a result of the unexpected KeyExchange message, and not just
                      due to an invalid finished message. It might be necessary to configure additional (debug) logs to be
                      generated by the TSF or examine detailed behavior of the TSF to distinguish unexpected KeyExchange
                      messages from other errors.
                    </h:li>
                    <h:li>(conditional, the TSF supports client authentication): The evaluator shall configure the TSF to
                      request client authentication. For a cipher suite that uses static DH for key transport, the
                      evaluator shall send the TSF a valid client certificate message, followed by a KeyExchange
                      message of DHE type containing a randomly generated ClientDiffieHellmanPublic value of size
                      2048 bits, and observe that the TSF sends a fatal TLS alert message.</h:li>
                    <h:li>For a cipher suite that uses static ECDH for key transport, the evaluator shall send the TSF a
                      valid certificate message, followed by a KeyExchange message of ECDHE type, containing a
                      random point on a curve supported by the TSF, in a ECpoint format supported by the TSF, and
                      observe that the TSF sends a fatal TLS alert message.
                    </h:li>
                  </h:ol>
                  </test>
                  <test id="ttts-invalid-rsa-kex">
                    The intent of this test is to ensure the TSF, when negotiating cipher suites using RSA key transport,
                    responds to invalid RSA KeyExchange messages consistently in order to resist a well-known class of chosen
                    ciphertext attacks against RSA key transport mechanisms, which are especially problematic in TLS 1.0. 
                    <h:p/>
                    Initial setup: The evaluator shall establish a monitored client with full debugging and control of the TLS
                    functions to send a TLS Client Hello indicating support for TLS 1.0 and a single cipher suite using RSA key
                    transport. The evaluator shall establish a requested server configured to negotiate TLS 1.0 with the cipher
                    suite indicated by the monitored client. The evaluator shall configure the TSF to inspect traffic between
                    the monitored client and requested server and to allow the version and cipher suite for the client and
                    server, and note this initial configuration for subsequent sub-tests:
                    <h:p/>
                    <testlist> 
                    <test> The evaluator shall send a Client Hello from the monitored client to the requested server
                    and observe that the Server Hello from the TSF selects TLS 1.0 and the desired cipher suite in its Server
                    Hello message. The evaluator shall note the size and formatting of pre-master secret input to the client’s
                    KeyExchange message, continue the handshake from the client, and confirm that the TSF successfully
                    establishes a TLS connection with the client.</test>
                    <h:p/>
                    <test> The evaluator shall terminate the TLS sessions and restore the TSF, monitored client and
                      requested server to the initial configuration for <xref to="ttts-invalid-rsa-kex"/> above. The evaluator shall compute the following
                    KeyExchange based on encrypting the following tailored messages with the server’s public key, using a
                    random value, ran, of size equal to that of the correctly computed pre-master secret, but having a
                    different value, and properly formatted padding, pad(), of length determined so that the message is of
                    the proper size.
                    <h:ul>
                      <h:li>M1= 0x0002|| pad()||0x00||TLSversion||ran</h:li>
                      <h:li>M2= 0x4117|| pad()</h:li>
                      <h:li>M3= 0x0002|| pad()||0x0011</h:li>
                      <h:li>M4= 0x0002|| pad()</h:li>
                      <h:li>M5= 0x0002|| pad()||0x00||0x0202||ran</h:li>
                    </h:ul>
                      <h:p/>
                      For each message in turn, the evaluator shall forward the KeyExchange message including the encrypted
                      message to the TSF as part of a complete TLS handshake with the server, and observe the TLS error alert
                      response provided by the TSF. Between each iteration, the evaluator shall terminate any residual TLS
                      sessions, reset any cache, and restore the configuration of the monitored client, requested server, and
                      TOE to its initial configuration for <xref to="ttts-invalid-rsa-kex"/>.</test>
                      <h:p/>
                      <test> The evaluator shall observe that each error alert response provided by the TSF for the
                      iterations in part b match the description in the TSS and is identical for each message M1 through M5.</test>
                    </testlist>
                  </test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Establishment of TLS session</audit-event-descr>
            <audit-event-info>TLS session parameters</audit-event-info>
          </audit-event>
        </f-component>       
        
      </section>  <!-- FCS -->

	  <!-- User Data Protection -->
      <section title="User Data Protection (FDP)" id="m-fdp">

        <ext-comp-def fam-id="FDP_CER_EXT" title="Certificate Usage">
          <fam-behavior>Components in this family define requirements for the TOE’s ability to issue certificates that allow the TOE
            to act as a proxy between remote entities attempting to establish a TLS connection with one another.
          </fam-behavior>
        </ext-comp-def>

<!-- Note: come back to this one to make sure it looks ok -->
        <f-component name="Certificate Profiles for Server Certificates" cc-id="fdp_cer_ext.1" id="fdp-cer-ext-1">
          <consistency-rationale>This SFR applies to how the TOE issues TLS server certificates for STIP traffic, which is an interface that is not defined in the Base-PP.  
            </consistency-rationale>
          <comp-lev> requires the TSF to implement a certificate
            profile function and to issue TLS server certificates that conform to profiles when acting as a CA.</comp-lev>
          <management>
            The following actions could be considered for the management functions in FMT: <h:ul>
              <h:li>Ability to configure identifying information for the TOE’s embedded CA.</h:li>
              <h:li>Ability to configure a maximum certificate validity duration.</h:li>
              <h:li>Ability to configure and manage certificate profiles.</h:li>
            </h:ul>
          </management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>
            FCS_CKM.1 Cryptographic Key Generation<h:p/>
            FCS_COP.1 Cryptographic Operation<h:p/>
            FMT_SMR.1 Security Roles
          </dependencies>
          <f-element id="fdp-cer-ext-1e1">
            <title>The TSF shall implement a certificate profile function for TLS server certificates
              issued by a CA embedded within the TOE, and shall ensure that issued certificates
              are consistent with configured profiles.</title>
          </f-element>
          <f-element id="fdp-cer-ext-1e2">
            <title>
              The TSF shall generate certificates using profiles that comply with requirements
              for certificates as specified in IETF RFC 5280, “Internet X.509 Public Key
              Infrastructure Certificate and Certificate Revocation List (CRL) Profile” as refined
              below. At a minimum, the TSF shall ensure that:
              <h:ol type="a">
                <h:li>The version field shall contain the integer 2.</h:li>
                <h:li>The issuerUniqueID or subjectUniqueID fields are not populated.</h:li>
                <h:li>The serialNumber shall be unique with respect to the issuing Certification
                Authority.</h:li>
                <h:li>The validity field shall specify a notBefore value that does not precede
                the current time and a notAfter value that does not precede the value
                specified in notBefore.</h:li>
                <h:li>The issuer field is not empty and is populated with the <h:b>
                  <selectables>
                    <selectable>Security Administrator</selectable>
                    <selectable>CA Operations Staff</selectable>
                  </selectables></h:b>-configured CA name.</h:li>
                <h:li>The signature field and the algorithm in the subjectPublicKeyInfo field
                shall contain the OID for a signature algorithm specified in
                FCS_COP.1<h:b>/SigGen in the NDcPP</h:b>.</h:li>
                <h:li>The following extensions are supported:
                  <h:ol type="a">
                    <h:li>authorityKeyIdentifier</h:li>
                    <h:li>keyUsage</h:li>
                    <h:li>extendedKeyUsage</h:li>
                    <h:li>certificatePolicy</h:li>
                    <h:li><selectables>
                      <selectable>subjectKeyIdentifier</selectable>
                      <selectable>basicConstraints</selectable>
                      <selectable>cRLDistributionPoints</selectable>
                      <selectable>authorityInfoAccess</selectable>
                      <selectable>no other extensions</selectable>
                    </selectables>.</h:li></h:ol></h:li>
                <h:li>A subject field containing a null Name (e.g., a sequence of zero relative
                  distinguished names) is accompanied by a populated critical
                  subjectAltName extension.</h:li>
                <h:li>The authorityKeyIdentifier extension in any certificate issued by the TOE
                  must be populated and must be the same as the subjectKeyIdentifier
                  extension contained in the TOE’s embedded CA’s signing certificate.</h:li>
                <h:li>Populated keyUsage and extendedKeyUsage fields in the same certificate
                  shall contain consistent values reflecting exclusive TLS server use as
                  follows:
                <h:table>
                  <h:tr>
                    <h:th>keyUsage</h:th>
                    <h:th>extendedKeyUsage</h:th>
                  </h:tr>
                  <h:tr>
                    <h:td>digitalSignature</h:td>
                    <h:td>serverAuth</h:td>
                  </h:tr>
                  <h:tr>
                    <h:td>digitalSignature, keyEncipherment</h:td>
                    <h:td>serverAuth</h:td>
                  </h:tr>
                  <h:tr>
                    <h:td>digitalSignature,keyAgreement</h:td>
                    <h:td>serverAuth</h:td>
                  </h:tr>
                </h:table>
                </h:li>
                <h:li><selectables>
                  <selectable>The subjectKeyIdentifier extension is populated with a value
                    unique for each public key contained in a certificate issued by the TSF</selectable>
                  <selectable>no other constraints</selectable>
                </selectables>.</h:li>
              </h:ol>
            </title>
            <ext-comp-def-title>
            <title>
              The TSF shall generate certificates using profiles that comply with requirements
              for certificates as specified in IETF RFC 5280, “Internet X.509 Public Key
              Infrastructure Certificate and Certificate Revocation List (CRL) Profile” as refined
              below. At a minimum, the TSF shall ensure that:
              <h:ol type="a">
                <h:li>The version field shall contain the integer 2.</h:li>
                <h:li>The issuerUniqueID or subjectUniqueID fields are not populated.</h:li>
                <h:li>The serialNumber shall be unique with respect to the issuing Certification
                  Authority.</h:li>
                <h:li>The validity field shall specify a notBefore value that does not precede
                  the current time and a notAfter value that does not precede the value
                  specified in notBefore.</h:li>
                <h:li>The issuer field is not empty and is populated with the
                  <assignable>authrozied role(s)</assignable>-configured CA name.</h:li>
                <h:li>The signature field and the algorithm in the subjectPublicKeyInfo field
                  shall contain the OID for a signature algorithm specified in
                  FCS_COP.1.</h:li>
                <h:li>The following extensions are supported:
                  <h:ol type="a">
                    <h:li>authorityKeyIdentifier</h:li>
                    <h:li>keyUsage</h:li>
                    <h:li>extendedKeyUsage</h:li>
                    <h:li>certificatePolicy</h:li>
                    <h:li><selectables>
                      <selectable>subjectKeyIdentifier</selectable>
                      <selectable>basicConstraints</selectable>
                      <selectable>cRLDistributionPoints</selectable>
                      <selectable>authorityInfoAccess</selectable>
                      <selectable>no other extensions</selectable>
                    </selectables>.</h:li></h:ol></h:li>
                <h:li>A subject field containing a null Name (e.g., a sequence of zero relative
                  distinguished names) is accompanied by a populated critical
                  subjectAltName extension.</h:li>
                <h:li>The authorityKeyIdentifier extension in any certificate issued by the TOE
                  must be populated and must be the same as the subjectKeyIdentifier
                  extension contained in the TOE’s embedded CA’s signing certificate.</h:li>
                <h:li>Populated keyUsage and extendedKeyUsage fields in the same certificate
                  shall contain consistent values reflecting exclusive TLS server use as
                  follows:
                  <h:table>
                    <h:tr>
                      <h:th>keyUsage</h:th>
                      <h:th>extendedKeyUsage</h:th>
                    </h:tr>
                    <h:tr>
                      <h:td>digitalSignature</h:td>
                      <h:td>serverAuth</h:td>
                    </h:tr>
                    <h:tr>
                      <h:td>digitalSignature, keyEncipherment</h:td>
                      <h:td>serverAuth</h:td>
                    </h:tr>
                    <h:tr>
                      <h:td>digitalSignature,keyAgreement</h:td>
                      <h:td>serverAuth</h:td>
                    </h:tr>
                  </h:table>
                </h:li>
                <h:li><selectables>
                  <selectable>The subjectKeyIdentifier extension is populated with a value
                    unique for each public key contained in a certificate issued by the TSF</selectable>
                  <selectable>no other constraints</selectable>
                </selectables>.</h:li>
              </h:ol>
            </title>
            </ext-comp-def-title>
            <note role="application">
              RFC updates to RFC 5280 are included in this requirement.
              <h:p/>
              The inclusion of the cRLDistributionPoints and authorityInfoAccess extensions
              depend on the selections made in FDP_CSI_EXT.1.3.
              <h:p/>
              Uniqueness for the subject key identifier (item k above) is specific to the instance
              of the embedded CA. The same configured CA should not issue certificates with
              different public keys having the same subject key identifier.
              <h:p/>
              If subjectKeyIdentifier is chosen in the selection in item g, then the ST author
              selects the first selection in item k; otherwise, select “no other constraints.”
            </note>
          </f-element>
          <f-element id="fdp-cer-ext-1e3">
            <title>
              The TSF shall implement the following rules for populating certificate fields based
              on constraints imposed by the TOE’s embedded CA’s signing certificate: <h:ul>
                <h:li>The validity field shall specify a notAfter time that does not exceed the
                  notAfter time of the CA’s signing certificate.</h:li>
                <h:li>The issuer field identifies the <selectables>
                  <selectable>subject</selectable>
                  <selectable><h:b>
                    <selectables>
                      <selectable>Security Administrator</selectable>
                      <selectable>CA Operations Staff</selectable></selectables></h:b>-assigned identifying information
                  </selectable>
                  
                </selectables> of the CA's signing certificate.</h:li>
                
                
                <h:li><selectables linebreak="yes">
                  <selectable>The subject name is limited by name constraints specified in the CA’s
                    signing certificate</selectable>
                  <selectable><assignable>list of rules</assignable></selectable>
                  <selectable>no other rules</selectable>
                </selectables>.</h:li>
              </h:ul>
            </title>
            <ext-comp-def-title>
              <title>
                The TSF shall implement the following rules for populating certificate fields based
                on constraints imposed by the TOE’s embedded CA’s signing certificate: <h:ul>
                  <h:li>The validity field shall specify a notAfter time that does not exceed the
                    notAfter time of the CA’s signing certificate.</h:li>
                  <h:li>The issuer field identifies the <selectables>
                    <selectable>subject</selectable>
                    <selectable><assignable>authorized role(s)</assignable>-assigned identifying information
                    </selectable>
                  </selectables> of the CA's signing certificate.</h:li>
                  <h:li><selectables linebreak="yes">
                    <selectable>The subject name is limited by name constraints specified in the CA’s
                      signing certificate</selectable>
                    <selectable><assignable>list of rules</assignable></selectable>
                    <selectable>no other rules</selectable>
                  </selectables>.</h:li>
                </h:ul>
              </title>
            </ext-comp-def-title>
          </f-element>
          <f-element id="fdp-cer-ext-1e4">
            <title>
              The TSF shall implement the following rules for populating certificate fields based
              on the validated certificate and constraints imposed by the <h:b><selectables>
                <selectable>Security Administrator</selectable>
                <selectable>CA Operations Staff</selectable>
              </selectables></h:b>:
              <h:ol type="a">
                <h:li>The Subject/Subject Alternative Name shall be copied from validated
                  server certificate.</h:li>
                <h:li>The notBefore field shall not precede the notBefore field of the validated
                  server certificate.</h:li>
                <h:li>The notAfter field shall not exceed the notAfter field of the validated
                  server certificate.</h:li>
                <h:li>The notAfter field shall not exceed the current time by more than a
                  maximum validity duration value as configured by a <h:b>
                    <selectables>
                      <selectable>Security Administrator</selectable>
                      <selectable>CA Operations Staff</selectable>
                    </selectables>
                  </h:b> user.</h:li>
                <h:li>If the basicConstraints field is configured to be present, it shall be
                  populated with the value cA=False</h:li>
                <h:li>The subject public key shall be generated in accordance with
                  FCS_CKM.1.1 <h:b>in the NDcPP.</h:b></h:li>
                <h:li>
                  <selectables linebreak="yes">
                    <selectable>policy OID/policy mapping fields are populated in accordance with
                      a <h:b><selectables>
                        <selectable>Security Administrator</selectable>
                        <selectable>CA Operations Staff</selectable>
                      </selectables></h:b> configured mapping from validated server certificate values to
                        one or more stated policy OIDs</selectable>
                    <selectable><assignable>list of rules</assignable></selectable>
                    <selectable>no additional rules</selectable>
                  </selectables>.
                </h:li>
              </h:ol>
            </title>
            <ext-comp-def-title>
              <title>
                The TSF shall implement the following rules for populating certificate fields based
                on the validated certificate and constraints imposed by the <assignable>authorized role(s)</assignable>:
                <h:ol type="a">
                  <h:li>The Subject/Subject Alternative Name shall be copied from validated
                    server certificate.</h:li>
                  <h:li>The notBefore field shall not precede the notBefore field of the validated
                    server certificate.</h:li>
                  <h:li>The notAfter field shall not exceed the notAfter field of the validated
                    server certificate.</h:li>
                  <h:li>The notAfter field shall not exceed the current time by more than a
                    maximum validity duration value as configured by a <assignable>authorized role(s)</assignable> user.</h:li>
                  <h:li>If the basicConstraints field is configured to be present, it shall be
                    populated with the value cA=False</h:li>
                  <h:li>The subject public key shall be generated in accordance with
                    FCS_CKM.1.1.</h:li>
                  <h:li>
                    <selectables linebreak="yes">
                      <selectable>policy OID/policy mapping fields are populated in accordance with
                        a <h:b><selectables>
                          <selectable>Security Administrator</selectable>
                          <selectable>CA Operations Staff</selectable>
                        </selectables></h:b> configured mapping from validated server certificate values to
                          one or more stated policy OIDs</selectable>
                      <selectable><assignable>list of rules</assignable></selectable>
                      <selectable>no additional rules</selectable>
                    </selectables>.
                  </h:li>
                </h:ol>
              </title>
            </ext-comp-def-title>
            <note role="application">
              It is preferred that a new public key be generated each time a certificate is
              generated.
            </note>
            <aactivity>
              <TSS>
                The evaluator shall examine the TSS to ensure it describes the certificate profile function in accordance
                with FDP_CER_EXT.1.1. The TSS shall describe how certificate profiles are configured and then selected
                to issue certificates in accordance with FDP_CER_EXT.1.2. 
              <h:p/></TSS>
              <Guidance>
                The evaluator shall examine the operational guidance to ensure that instructions are available to
                configure certificate profiles used for certificate generation in accordance with this requirement.
              <h:p/></Guidance>
              <Tests>The evaluator shall perform the following tests:
                <testlist>
                  <test id="valid-server-profile-cert">The evaluator shall configure a certificate profile using the available guidance and establish a
                    server with a certificate that satisfies FDP_CER_EXT.1.2 items a, b, e, f, h, i, j, and k, has valid values in all
                    extensions in item g (a-e), and is a valid TLS server certificate (having
                    extendedKeyUsage field of server authentication). The evaluator shall establish a
                    monitored client and request a TLS session to the server through the TOE so that the inspection operation
                    is implemented, and then examine the certificate received at the client from the TOE to ensure it matches
                    the configured certificate profile.</test>
                  <test>The evaluator shall specifically examine the certificate generated in <xref to="valid-server-profile-cert"/> and compare it to both
                    the embedded CA’s certificate and the requested server’s certificate to ensure that it satisfies all field
                    constraints in FDP_CER_EXT.1.2, FDP_CER_EXT.1.3, and FDP_CER_EXT.1.4 as configured in the certificate
                    profile.</test>
                  <test>The evaluator shall conduct the following tests by establishing a server with certificate identical to
                    that used in <xref to="valid-server-profile-cert"/>, except for the differences described as follows (each in turn). The evaluator shall make
                    any configuration changes to the TOE as indicated, establish a monitored client, and submit a TLS request
                    for the server through the TOE so that the inspection operation is performed, and observe the certificate
                    received at the monitored client has the indicated features: 
                    <h:ul>
                      <h:li><h:b>notBefore field test:</h:b> The evaluator shall assign a notBefore value in the established server
                        certificate that precedes both the current time and the value of notBefore field in the TOE’s
                        embedded CA’s certificate, and observe that the generated certificate has a notBefore value
                        that does not precede the current time.</h:li>
                      <h:li><h:b>notAfter field test a:</h:b> The evaluator shall configure the maximum validity duration so that
                        the notAfter value of the TOE’s embedded CA certificate does not exceed the current time
                        by more than the maximum validity duration. The evaluator shall assign a notAfter value in
                        the established server certificate that exceeds the current time by more than the maximum
                        validity period, and observe that the notAfter field of the generated certificate has a
                        notAfter value that does not exceed the notAfter value of the embedded CA’s certificate.</h:li>
                      <h:li><h:b>notAfter field test b:</h:b> The evaluator shall configure the maximum validity duration so that
                        the notAfter value in the TOE’s embedded CA certificate exceeds the current time by more
                        than maximum validity duration, assign a notAfter value in the established server certificate
                        that exceeds the notAfter value in the TOE’s embedded CA’s certificate, and observe that
                        the notAfter value of the generated certificate does not exceed the current time by more
                        than the maximum validity duration.</h:li>
                      <h:li><h:b>notAfter field test c:</h:b> The evaluator shall assign a notAfter value in the established server
                        certificate that precedes both the notAfter value in the TOE’s embedded CA’s certificate,
                        and the current time plus the maximum validity duration, and observe that the generated
                        certificate has a notAfter value that does not exceed the notAfter value of the established
                        server’s certificate.</h:li>
                      <h:li><h:b>keyUsage field test:</h:b> The evaluator shall assign a KeyUsage value in the established server
                        certificate that indicates additional usage indicators (e.g., keyCertSign) and observe that
                        generated certificate has only the digitalSignature and/or keyEncipherment indicators.
                      </h:li>
                      <h:li><h:b>extendedKeyUsage field test a:</h:b> The evaluator shall omit the extendedKeyUsage field in the
                        established server certificate and observe that the generated certificate contains the
                        extendedKeyUsage field with value indicating only TLS server authentication.</h:li>
                      <h:li><h:b>extendedKeyUsage field test b:</h:b> The evaluator shall populate the extendedKeyUsage field in
                        the established server’s certificate to indicate both TLS server authentication and code
                        signing, and observe that the generated certificate only indicates TLS server authentication.</h:li>
                      <h:li><h:b>extendedKeyUsage field test c:</h:b> The evaluator shall populate the extendedKeyUsage field in
                        the established server’s certificate to indicate any usage, and observe that the generated
                        certificate only indicates TLS server authentication.
                      </h:li>
                    </h:ul>
                  </test>
                </testlist>
              </Tests>
            </aactivity>
            </f-element>
          <audit-event/>
        </f-component>
        
        <f-component name="Certificate Request Matching of Server Certificates" cc-id="fdp_cer_ext.2" id="fdp-cer-ext-2">
          <consistency-rationale>This SFR requires the TOE to maintain an association between TLS server certificates it receives and
            TLS server certificates that it issues in their place in support of STIP traffic, which is an interface that is not defined in the Base-PP.
            </consistency-rationale>
          <comp-lev> requires the TSF to maintain a linkage
            between external certificates that it has validated and internal certificates that it has issued to represent
            the entities presenting those certificates when the TOE is acting as a proxy for a TLS connection to or from
            those entities.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>
            The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST: <h:ul>
              <h:li>Linking of issued certificate to validated certificate.</h:li>
            </h:ul>
          </audit>
          <dependencies>FDP_CER_EXT.1 Certificate Profiles for Server Certificates</dependencies>
          <f-element id="fdp-cer-ext-2e1">
            <title>The TSF shall establish and record a linkage from validated certificates to issued
              certificates.</title>
            <note role="application">
              This requirement ensures that the TOE provides linkage between TLS server
              certificates validated during a TLS session establishment by the TOE and resulting
              certificates issued by the TOE to represent the requested server (or monitored
              client if supported). In terms of Certification authority operations, an
              automatically approved certificate request is implied by the validated certificate
              and the configured TLS session establishment policy identified in FDP_TEP_EXT.1.
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it describes the linkage between submitted requests and
                issued certificates and indicates where this linkage is recorded.
              <h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure it contains instructions for how to trace
                a submitted request to an issued certificate and vice versa via the TOE’s interface.
              <h:p/></Guidance>
              <!-- Note: In general, updated any cases where there is just one single test to have the EA be that test rather than "The evaluator shall perform the following test:" 
              followed by a single-item testlist, is this ok -->
              <Tests>The evaluator shall configure a certificate profile using the available guidance and establish a server
                with a server certificate which is consistent (would allow the CA to issue a certificate) with the profile. The
                evaluator shall establish a client and request a TLS session with the server so that the inspection operation
                is selected. The evaluator shall follow the administrative guidance for determining the linkage and verify
                that it provides linkage between the validated server certificate and issued certificate.
              </Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Linking of issued certificate to validated certificate</audit-event-descr>
            <audit-event-info>
              <h:p>
                Success: 
                <selectables>
                  <selectable>issued certificate value</selectable>
                  <selectable>issued certificate object identifier</selectable>
                </selectables>, <selectables>
                  <selectable>validated certificate value</selectable>
                  <selectable>validated certificate object identifier</selectable>
                </selectables>
              </h:p>
              <h:p>
                Failure: reason for failure
              </h:p>
            </audit-event-info>
          </audit-event>
        </f-component>
    
        <f-component name="Certificate Issuance Rules for Server Certificates" cc-id="fdp_cer_ext.3" id="fdp-cer-ext-3">
          <consistency-rationale>This SFR defines when the TOE will issue TLS server certificates in support of STIP traffic, which is an interface
            that is not defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to issue certificates in
            response to validated server certificates based on certain rules.</comp-lev>
          <management>The following actions could be considered for the management functions in FMT: <h:ul>
            <h:li>Ability to configure rules for automated issuance of certificates.</h:li>
          </h:ul>
          </management>
          <audit>
            The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST: <h:ul>
              <h:li>Certificate generation.</h:li>
            </h:ul>
          </audit>
          <dependencies>FDP_CER_EXT.1 Certificate Profiles for Server Certificates</dependencies>
          <f-element id="fdp-cer-ext-3e1">
            <title>The TSF shall issue certificates in response to a validated server certificate
              according to the following rules: The issued certificate is in compliance with a
              current certificate profile defined in accordance with FDP_CER_EXT.1 and
            <h:ul>
              <h:li>The TLS session establishment policy is configured to allow inspection of
                TLS sessions between monitored clients and a requested server
                authenticated to the TSF by the validated certificate,</h:li>
            </h:ul><selectables linebreak="yes">
              <selectable>A valid certificate for the same subject is not present in cache</selectable>
              <selectable>The embedded CA certificate’s name space allows issuance of a certificate
                that represents the authenticated server</selectable>
            </selectables>.</title>
          </f-element>
          <f-element id="fdp-cer-ext-3e2">
            <title>The TSF shall reject all certificate requests originating external to the TOE.</title>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it describes the certificate issuance rules, and verify that
                any interfaces available for external certificate requests (CMC, EST, PKCS#10 or any other request format)
                are identified.
              <h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure that it contains instructions for any
                configuration aspects of any certificate issuance approval function and the steps needed to prevent
                receipt and approval of external requests.
              <h:p/></Guidance>
              <Tests>
                The evaluator shall perform the following tests:
                <testlist>
                  <test>(conditional, the TSF has one or more interfaces that could be used to receive external certificate requests): 
                    For each interface that can be used to receive external certificate requests, the evaluator shall configure the certificate issuance approval function in accordance with the
                    operational guidance. The evaluator shall create a certificate request and submit it to the TOE. The
                    evaluator shall access the TOE using the defined interface and verify that the submitted request is
                    rejected.</test>
                  <test id="issue-cert-inspected-traffic">
                    The intent of this test is to exercise a representative set of SSL/TLS inspection proxy rules for the
                    supported features of the TLS session establishment policy and demonstrate certificates are generated by
                    the TSF only when the inspection operation is authorized.
                    <h:p/>
                    The evaluator shall follow operational guidance to configure a set of rules for the TLS session establishment policy
                    that exercises the inspection operation, bypass operation, and block operation for a representative
                    sample of supported monitored client requested server abstractions as indicated in FDP_TEP_EXT.1.4.
                    <h:p/>
                    The evaluator shall further configure rules that specify allowances restricting a subset of the monitored
                    client, requested server abstractions associated with the inspection operation to specific TLS versions,
                    cipher suites, supported groups, and other constraints as indicated in the selection of FDP_TEP_EXT.1.5.
                    <h:p/>
                    The evaluator shall establish TLS servers with certificates issued by an external certification authority, such
                    that for each rule specified, at least one server has attributes satisfying the rule. The evaluator shall
                    establish monitored clients so that for each rule, at least one monitored client has attributes satisfying
                    the rule. If client authentication is supported, the evaluator shall issue certificates to monitored clients
                    from a certification authority trusted by the TSF as required to exercise the rules.
                    <h:p/>
                    For each rule restricting the TLS allowances, the evaluator shall establish monitored clients, requested
                    servers, and certificates as necessary that match rules associated with the inspection operation, but
                    violate the allowances for the requested server and monitored client pair.
                    <h:p/>
                    The evaluator shall initiate TLS requests from monitored clients through the TOE, to requested servers to
                    exercise the rules. The evaluator shall observe the resulting logs to confirm the rule is exercised as
                    intended.
                    <h:p/>
                    For each instance where the rule is associated with the inspection operation and no TLS allowances are
                    violated, the evaluator shall inspect the TLS server certificate message sent from the TOE to the monitored
                    client and confirm the TOE’s embedded CA issues the certificate. The evaluator shall search the certificate
                    repository to identify the issued certificate associated with the requested server and that the certificate
                    in the repository matches the certificate sent to the monitored client.
                    <h:p/>
                    For each instance where the rule is associated with the inspection operation but the TLS allowances are
                    violated, the evaluator shall inspect the TSF logs to confirm the session was blocked. When the server TLS
                    allowances associated with the Client Hello received from the monitored client (version, cipher suites),
                    with the Server Hello received from the requested server (version, cipher suite, supported groups and
                    critical extensions), or with the requested server certificate validation (including certificate revocation
                    information not available when inspection is not allowed), are violated, the evaluator shall search the
                    certificate repository to ensure no certificate matching the subject field in the requested server’s
                    certificate is associated to the current session, and search the certificate repository to ensure no
                    certificate matching any of the names in the subject alternate name extension in the requested server’s
                    certificate is associated with the current session.
                    <h:p/>
                    Note: Certain allowances (associated with key exchange messages or client certificate messages received
                    after the server certificate message is sent) may only be determined to be violated after the TSF issues a
                    certificate for the requested server.
                    <h:p/>
                    For each instance where the rule is associated with the bypass operation, the evaluator shall inspect the
                    TLS server certificate message sent from the TOE to the monitored client, and the TLS server certificate
                    message sent from the requested server to the TOE. The evaluator shall: verify that the certificate sent to
                    the monitored client matches the certificate sent from the requested server exactly, confirm that the
                    certificate issuer indicated in the certificate is the CA trusted by the TOE, and not the TOE’s embedded
                    CA, and search the certificate repository for the certificate to confirm the certificate is not present as an
                    issued certificate.
                    <h:p/>
                    For each instance where the rule is associated with the block operation, the evaluator shall search the
                    certificate repository for any certificate matching the subject field of the requested server’s certificate
                    and observe that no certificate was issued in response to the request. The evaluator shall also search the
                    certificate repository for any certificate matching any of the names included in the requested server’s
                    subject alternate name extension and observe that no certificate was issued in response to the request. 
                  </test>
                  <test>(conditional, the TSF supports caching of issued certificates): The evaluator shall
                    configure the TSF to retain certificates in the cache, and initiate a TLS session from a monitored client to
                    a requested server as in <xref to="issue-cert-inspected-traffic"/> where the monitored client requested server combination matches a rule
                    associated with the inspection operation without allowance violations. The evaluator shall confirm that
                    the certificate issued by the TOE’s embedded CA is contained in the certificate repository. The evaluator
                    shall then establish a second monitored client for which the second monitored client and same requested
                    server also match a rule associated with the inspection operation without allowance violations. The
                    evaluator shall initiate a TLS session from the second client to the same requested server, observe logs to
                    verify that the inspection operation was performed, and search the certificate repository to confirm that
                    a new certificate for the request was not issued.</test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Certificate generation</audit-event-descr>
            <audit-event-info>
                Success: 
                <selectables>
                  <selectable>certificate value</selectable>
                  <selectable>certificate object identifier</selectable>
                </selectables>
            </audit-event-info>
          </audit-event>
        </f-component>
        
        <ext-comp-def fam-id="FDP_CSIR_EXT" title="Certificate Status Information Required">
          <fam-behavior>Components in this family define requirements for the association of certificate status information with
            certificates issued by the TOE.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="Certificate Status Information Required" cc-id="fdp_csir_ext.1" id="fdp-csir-ext-1">
          <consistency-rationale>This SFR applies to the ability to generate certificate status information if the
            validity period can be configured to last longer than 24 hours.</consistency-rationale>
          <comp-lev> requires the TSF to maintain certificate status
            information for its issued certificates or to ensure that any certificates it issues are valid for a sufficiently
            short period of time that status information is unnecessary.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>
            FDP_CER_EXT.1 Certificate Profiles for Server Certificates<h:p/>
            FDP_CER_EXT.3 Certificate Issuance Rules for Server Certificates
          </dependencies>
          <f-element id="fdp-csir-ext-1e1">
            <title>The TSF shall <selectables>
              <selectable id="genStatus">generate certificate status information</selectable>
              <selectable>only issue certificates with validity period of less than [24 hours]</selectable>
            </selectables>.
            </title>
            <ext-comp-def-title>
              <title>The TSF shall <selectables>
                <selectable id="genStatus">generate certificate status information</selectable>
                <selectable>only issue certificates with validity period of less than <assignable>length of time</assignable></selectable>
              </selectables>.
              </title>  
            </ext-comp-def-title>
            <note role="application">
   
              Based on the selection, the ST author must choose the appropriate requirements
              from Appendix B.1 of this PP-Module.
              <h:p/>
              The ST should specify whether certificate status information is generated. If the
              TSF can be configured so the validity of issued certificates is longer than 24 hours,
              certificate status information must be able to be generated.
              <h:p/>
              Certificate policies associated with the issuance of TLS server certificates imply
              that certificates issued by the TSF must be revoked within a certain time period of
              discovering they do not properly represent the asserted subject. Certificate status
              information is not required if the validity period of any issued certificate is less
              than the time in which this status information must be provided. Even for
              emergency revocations, this time period is typically greater than 24 hours. 
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it describes whether certificate status information is
                provided.
              <h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure that it contains instructions for any
                configuration aspects of the validity period that are necessary for the TSF to operate in compliance with
                this requirement.
              <h:p/></Guidance>
              <Tests>
                If the TSF provides certificate status information, testing for this functionality is performed under the certificate status information requirements that are claimed.
                If the TSF does not provide certificate status information and instead issues certificates with a lifetime under 24 hours, the evaluator shall perform the following test:
                <h:p/>
                The evaluator shall
                follow guidance documentation to configure the TSF in compliance with this SFR. The evaluator shall establish
                a monitored client and a requested server whose certificate is valid for one year, and configure the TSF to
                inspect TLS traffic between the monitored client and requested server. The evaluator shall initiate a TLS
                session between the monitored client and requested server. The evaluator shall observe that a certificate
                is received at the monitored client, which is issued by the TSF and shall verify that its validity is less than
                24 hours.
              </Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
        <ext-comp-def fam-id="FDP_PPP_EXT" title="Plaintext Processing Policy">
          <fam-behavior>Components in this family define requirements for the processing of plaintext data that has been
            decrypted from TLS.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="Plaintext Processing Policy" cc-id="fdp_ppp_ext.1" id="fdp-ppp-ext-1">
          <consistency-rationale>This SFR applies to the enforcement of the TLS processing policy which is not
            defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to apply rules to decrypted TLS traffic and
            take some information flow processing action against the traffic based on these rules.</comp-lev>
          <management>
            The following actions could be considered for the management functions in FMT: <h:ul>
              <h:li>Ability to manage inspection policy.</h:li>
            </h:ul>
          </management>
          <audit>
            The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST: <h:ul>
            <h:li>Configuration changes to the plaintext processing policy.</h:li>
            </h:ul>
          </audit>
          <dependencies>
            FCS_TTTC_EXT.1 Thru-Traffic TLS Inspection Client Protocol<h:p/>
            FCS_TTTS_EXT.1 Thru-Traffic TLS Inspection Server Protocol
          </dependencies>
          <f-element id="fdp-ppp-ext-1e1">
            <title>
              The TSF shall enforce the TLS plaintext processing policy on information flows
              containing plaintext produced by inspection processing of the TOE between TLS
              session termination points and <selectables>
                <selectable>distinct internal inspection processing functional components</selectable>
                <selectable>internal inspection processing functional components and
                  an interface to external inspection processing environment</selectable>
              </selectables>.
            </title>
            <note role="application">
              This element identifies the policy (TLS plaintext processing) that is applied to
              decrypted TLS session data received by the TSF via an external interface for which
              the TLS session establishment policy, FDP_TEP_EXT.1, determines inspection
              processing is authorized, resulting in the exposure of the underlying plaintext
              associated to the TLS session. Information flows containing such data are referred
              to as TLS session threads.
              <h:p/>
              Every network packet decrypted under the TLS session establishment policy
              inspection operation is associated to a TLS session thread and has the ruleset that
              expresses this policy applied between each distinct inspection processing
              functional component, including the points where TLS encryption/decryption
              occurs. This PP-Module allows both internal and external inspection processing
              functional components. Internal inspection processing components, if supported,
              range from simple routing functions that determine whether to abort inspection
              processing of a TLS session thread based on an identifier, to complicated intrusion
              detection/prevention functions. External inspection processing components, if
              supported, are accessed via a controlled interface of the TOE to a protected
              computing environment, considered as part of the operational environment.
            </note>
          </f-element>
          <f-element id="fdp-ppp-ext-1e2">
            <title>
              The TSF shall allow the definition of TLS plaintext processing policy rules using
              <assignable>entity attributes of the requested server</assignable>, <assignable>indicators of
              inspection processing results</assignable> and distinct interfaces.
            </title>
            <note role="application">
              This element identifies the various attributes that are applicable when
              constructing rules to be enforced by this requirement. The attributes to be
              included in this requirement include those which are exposed only for TLS sessions
              undergoing inspection processing in accordance with FDP_TEP_EXT.1 after the
              TLS application payload is decrypted, or can simply be the thread indicator to
              implicitly include attributes obtained by the TLS session establishment policy.
              Indicators can include specific error alerts from an internal inspection processing
              functional component, or can be a timeout resulting from an inspection
              processing functional component blocking traffic requiring no explicit signaling.
            </note>
          </f-element>
          <f-element id="fdp-ppp-ext-1e3">
            <title>
              The TSF shall allow the following operations to be associated with the plaintext
              processing policy: permit, block, and <selectables>
                <selectable>bypass</selectable>
                <selectable>no other operation</selectable>
              </selectables>, with
              the capability to log the operation.
            </title>
            <note role="application">
              This element defines the operations that can be associated with rules used to
              manage inspection processing of TLS session threads. Permit allows the
              information flow to continue between inspection processing functional
              components; bypass indicates that the information flow is not processed by the
              processing component, but is forwarded to either the TLS encryption/decryption
              buffer, or the next plaintext inspection functional processing component; block
              drops subsequent information flows associated to the TLS session thread and
              informs the TLS session establishment policy to transition the TLS session to a
              Block Operation for subsequent TLS messages to or from the monitored client or
              requested server. It is permissible to use timeouts as indicators between
              inspection processing functional components or between the TLS plaintext
              processing policy and the TLS session establishment policy.
              <h:p/>
              Note this requirement does not specify the behavior of the inspection processing
              functional components, as this functionality is out of scope of this PP-Module. It
              only specifies the policy controlling the TOEs response to indicators from those
              processing components or to take advantage of the requested server’s subject
              attributes exposed by decryption
            </note>
          </f-element>
          <f-element id="fdp-ppp-ext-1e4">
            <title>The TSF shall allow the Plaintext Processing Policy to be applied at each
              information flow control point between inspection processing functional
              components, including any network interface used to support external inspection
              processing.</title>
            <note role="application">
              This element indicates where the TLS plaintext processing policy can be assigned.
              A conforming TOE must be able to assign processing rules to prevent TLS data
              from being exposed to unauthorized processing units based on the requested
              server attributes, and to allow TLS sessions containing malicious or unauthorized
              data, as determined by the inspection processing functional components, to be
              blocked at the earliest possible point, avoiding compromise of the TOE or the
              monitored client.
            </note>
          </f-element>
          <f-element id="fdp-ppp-ext-1e5">
            <title>
              The TSF shall <h:ul>
              <h:li>drop Information flows between inspection processing components,
              including any interface to external inspection processing components,
              that cannot be associated to an existing TLS session thread.</h:li>
              <h:li>inform the TLS session establishment policy of the TLS session thread
              associated to any information flow that is blocked by the plaintext
              processing policy.</h:li>
              </h:ul>
            </title>
            <note role="application">
              This element identifies state information shared by the TLS inspection processing
              policy and the TLS session establishment policy associated.
              <h:p/>
              The TSF may inform the TLS session establishment policy that it has blocked a data
              flow either explicitly, by sharing state information, signaling, or other mechanism,
              or implicitly via the use of time-out mechanisms. 
            </note>
            <aactivity>
              <TSS><h:p>The evaluator shall examine the TSS to validate that internal routing functions or controls associated with
                the Plaintext Processing Policy are described.</h:p><h:p>
                The evaluator shall examine the TSS to ensure that all events that initiate a transition to the block operation based on internal routing function
                indicators are described.</h:p></TSS>
              <Guidance>The evaluator shall inspect the operational guidance documents and ensure that instructions for any
                configurable features of the Plaintext Processing Policy function are provided.<h:p/></Guidance>
              <Tests>The evaluator shall perform the following tests:
              <testlist>
                <test>For each routing option described in the routing policy, the evaluator shall attempt to construct a
                  data flow that exercises the routing option and observe the intended routing occurs.
                </test>
                <test>For each routing option described in the routing policy, the evaluator shall attempt to construct a
                  data flow that violates the routing option and observe that the violation is detected and the flow blocked.
                </test>
              </testlist></Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Configuration changes to the plaintext processing policy</audit-event-descr>
            <audit-event-info>N/A</audit-event-info>
          </audit-event>
        </f-component>
        
        <ext-comp-def fam-id="FDP_PRC_EXT" title="Plaintext Routing Control">
          <fam-behavior>Components in this family define requirements for the routing of decrypted TLS traffic.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="Plaintext Routing Control" cc-id="fdp_prc_ext.1" id="fdp-prc-ext-1">
          <consistency-rationale>This SFR applies to the routing of information flows containing plaintext
            which is not defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to route decrypted TLS traffic based on the
            results of applicable plaintext processing policy rules.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>
            The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST: <h:ul>
              <h:li>Plaintext routed to inspection processing functional component.</h:li>
            </h:ul>
          </audit>
          <dependencies>FDP_PPP_EXT.1 Plaintext Processing Policy</dependencies>
          <f-element id="fdp-prc-ext-1e1">
            <title>The TSF shall control the routing of information flows containing plaintext within
              a TLS session thread in accordance with the configured Plaintext Processing Policy
              identified in FDP_PPP_EXT.1.</title>
          </f-element>
          <f-element id="fdp-prc-ext-1e2">
            <title>The TSF shall separate information flows containing plaintext within different TLS
              session threads.</title>
          </f-element>
          <f-element id="fdp-prc-ext-1e3">
            <title>The TSF shall not expose plaintext within a TLS session thread except to inspection
              processing functional components identified in, and as authorized by the
              configured Plaintext Processing Policy, as described in FDP_PPP_EXT.1.</title>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to validate that each interface between inspection processing
                functional components and TLS decryption/encryption buffers that can be used to control the routing of
                decrypted plaintext associated to a TLS session thread and the internal routing events or rules that control
                internal routing of decrypted plaintext at each interface are described.
              <h:p/></TSS>
              <Guidance>The evaluator shall inspect the operational guidance documents and ensure that instructions for any
                configurable features of the Plaintext Routing function are provided.
              <h:p/></Guidance>
              <Tests>
                The evaluator shall perform the following tests:
                <testlist>
                  <test>The evaluator shall configure the TSF and establish monitored clients and requested servers to
                    establish multiple TLS session threads through the inspection processing functional components, in which
                    the plaintext in each thread is distinguishable, either by the expected response of an inspection processing
                    functional component, or by logs. The evaluator shall examine the observable responses and logs to
                    confirm that the threads are treated separately. </test>
                  <test>(conditional, the TSF can establish plaintext processing rules that exclude plaintext processing by a particular inspection processing component): The evaluator shall configure the TSF,
                    configure a plaintext processing policy, and establish monitored clients and requested servers to establish
                    a TLS session thread through the inspection processing functional components for which the configured
                    plaintext processing rules prohibits the processing of the data by a particular inspection processing
                    component. The evaluator shall examine the logs and/or inspection processing response to determine
                    that data is not processed by the component.
                  </test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Plaintext routed to inspection processing functional component</audit-event-descr>
            <audit-event-info>TLS session thread identifier, <assignable>processing element identifier</assignable></audit-event-info>
          </audit-event>
        </f-component>
        
        <f-component name="Subset Residual Information Protection" cc-id="fdp_rip.1" id="fdp-rip-1">
          <consistency-rationale>This SFR applies to providing the capability to allocation or deallocation of
            resources which in this PP-Module is any data buffers used to implement
            STIP functionality which is not defined in the Base-PP.</consistency-rationale>
          <f-element id="fdp-rip-1e1">
            <title>
              The TSF shall ensure that any previous information content of a resource is made
              unavailable upon the <selectables>
                <selectable>allocation of the resource to</selectable>
                <selectable>deallocation of the resource from</selectable>
              </selectables> the following objects: <assignable>list of objects</assignable>. 
            </title>
            <note role="application">
              “Resources” in the context of this requirement are any data buffers used to
              implement STIP functions, including the TLS buffers containing decrypted TLS
              payloads. The concern is that a buffer or memory area might be reused in
              subsequent function or communication channel resulting in inappropriate
              disclosure of sensitive data. “Objects” refers to any sensitive data objects that are
              under control of the TSF. 
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure that, at a minimum, it describes how the previous
                information content is made unavailable, and at what point in the buffer processing this occurs.<h:p/></TSS>
              <Guidance>There are no guidance EAs for this component.<h:p/></Guidance>
              <Tests>There are no test EAs for this component.</Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
        <ext-comp-def fam-id="FDP_STG_EXT" title="User Data Storage">
          <fam-behavior>Components in this family define requirements for the secure storage of public key and certificate data
            used by the TOE.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="Certificate Data Storage" cc-id="fdp_stg_ext.1" id="fdp-stg-ext-1">
          <consistency-rationale>This SFR enforces protection of trusted public keys and certificates
            implemented using access control or integrity mechanism which is not
            defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to protect public key and certificate data using
            either access controlled storage or a cryptographic integrity mechanism.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>FCS_CKM_EXT.5 Public Key Integrity</dependencies>
          <f-element id="fdp-stg-ext-1e1">
            <title>The TSF shall use
              <selectables>
                <selectable>access controlled storage</selectable>
                <selectable id="keyIntegrity">an integrity mechanism</selectable>
              </selectables> to protect the trusted public keys and certificates (trust store elements) used to
              validate local logon, trusted channel, and external communication to the STIP.</title>
            <note role="application">If “an integrity mechanism” is selected, FCS_CKM_EXT.5 must be included in the
              ST.</note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it describes the trusted public keys and certificates
                implemented, including trust stores that contain root CA certificates used to meet the requirements of
                this PP. This description shall contain information pertaining to how certificates are loaded into the store,
                and (if the first selection in this SFR is selected) how the store is protected from unauthorized access in
                accordance with the permissions established in FMT_MOF.1/STIP.<h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure it contains instructions for how to load
                certificates and public keys into, and remove certificates and public keys from the protected storage or
                apply (trust) or remove (untrust) the indicated protection mechanism.
              <h:p/></Guidance>
              <Tests>This test is conditional on the first option in the selection of this SFR being chosen. If the second option is
                chosen, the evaluator does not perform this and instead performs the actions called for in
                FCS_CKM_EXT.5.<h:p/>
                The evaluator shall attempt to modify the contents of the Trust Anchor Database in
                a way that violates the documented permissions and verify that the attempt fails.
              </Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
        <ext-comp-def fam-id="FDP_STIP_EXT" title="SSL/TLS Inspection Proxy Functions">
          <fam-behavior>Components in this family define requirements for the TOE to act as a man-in-the-middle for SSL/TLS
            connections by establishing two separate TLS connections between itself and the endpoints of the original
            connection.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="SSL/TLS Inspection Proxy Functions" cc-id="fdp_stip_ext.1" id="fdp-stip-ext-1">
          <consistency-rationale>This SFR applies to STIP-specific processing operations which are not defined
            in an RFC or specified in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to establish itself as a proxy for
            SSL/TLS connections between remote endpoints such that the TOE can observe the contents of the
            SSL/TLS traffic.</comp-lev>
          <management>
            Management: FDP_STIP_EXT.1
            The following actions could be considered for the management functions in FMT: <h:ul>
              <h:li>Ability to configure inspection processing.</h:li>
              <h:li>Ability to configure TLS error responses for monitored clients.</h:li>
            </h:ul>
          </management>
          <audit>
            The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST: <h:ul>
              <h:li>Establishment of a TLS inspection session thread.</h:li>
              <h:li>Establishment of an encrypted TLS data flow.</h:li>
              <h:li>Bypass operation invoked.</h:li>
              <h:li>Block operation invoked.</h:li>
            </h:ul>
          </audit>
          <dependencies>
            FCS_TTTC_EXT.1 Thru-Traffic TLS Inspection Client Protocol<h:p/>
            FCS_TTTS_EXT.1 Thru-Traffic TLS Inspection Server Protocol<h:p/>
            FDP_PPP_EXT.1 Plaintext Processing Policy<h:p/>
            FDP_PRC_EXT.1 Plaintext Routing Control<h:p/>
            FTA_TAB.1 Default TOE Access Banners
          </dependencies>
          <f-element id="fdp-stip-ext-1e1">
            <title>The TSF shall be capable of performing the Inspection Operation consisting of
              establishing a TLS session between TOE and the requested server according to
              FCS_TTTC_EXT.1, establishing a TLS session between the monitored client and the
              TOE according to FCS_TTTS_EXT.1, and routing decrypted application data from
              either of these TLS sessions to or between inspection processing functional
              components within the TOE, or between the TOE and external inspection
              processing functional components to a unique TLS session thread, according to
              FDP_PPP_EXT.1 and FDP_PRC_EXT.1.</title>
            <note role="application">This defines the inspection operation, where the TLS connection is terminated at
              both ends on the TOE and the opportunity for inspection of the contents is
              allowed.</note>
            <aactivity level="element">
              <TSS>The evaluator shall examine the TSS to ensure that inspection operation is described.
                <h:p/>
                The evaluator shall examine the TSS to ensure that the logical components of a TLS session thread are
                described, and that a method for tracking the data flows associated to a TLS session is described. The
                evaluator shall check the TSS and verify that all components of a TLS session thread are included in the
                TLS session thread description. The evaluator shall examine the TSS to ensure that separation mechanisms
                between TLS session threads is described. If TLS resumption is supported, as indicated by the final
                selection in FCS_TTTC_EXT.1, and/or the final selection in FCS_TTTS_EXT.1, the evaluator shall examine
                the TSS and verify that the description explains how TLS resumption does not create TLS sessions that are
                included in multiple TLS session threads.
              <h:p/></TSS>
              <Guidance>
                The evaluator shall examine the operational guidance to ensure instructions for any configurable
                features of the inspection operation, and any configurable features of the TLS session thread management
                to meet the requirements are provided. 
              <h:p/></Guidance>
              <Tests>
                The evaluator shall follow the operational guidance to configure the TSF. The evaluator shall establish two
                monitored clients (client a and b) each able to initiate a TLS session
                and two servers (servers 1 and 2) each able to establish TLS sessions and having valid server certificates, issued
                by a CA, different than the TOE’s embedded CA, that is trusted by the TOE. If the TSF supports TLS
                resumption, the evaluator shall configure server 1 to support TLS resumption using a mechanism (tickets
                or session number) supported by the TSF, and configure server 2 to refuse TLS resumption and instead
                respond with a full TLS handshake when requested to do resumption. The evaluator shall follow operational
                guidance to configure the TLS session establishment policy so TLS sessions through the TOE between each
                of the client-server combinations will be inspected. The evaluator shall use appropriate tools to monitor
                the traffic between the clients and the TOE, and between the TOE and the server to observe the TLS
                handshake messages. If the TSF supports TLS session resumption, the evaluator shall clear any TLS session
                state that might be retained by the TSF and configure the TSF to use session resumption. Note that the 
                first two tests have additional instructions if TLS resumption is supported, but apply regardless of TLS resumption
                support. The third test should only be performed if TLS resumption is supported.
                The evaluator shall perform the following tests, in order: <h:p/>
                <testlist>
                  <test id="stip-unique-client-sessions">The evaluator shall initiate a TLS session from client ‘a’ to server 1, and initiate a TLS session from
                    client ‘b’ to server 2. The evaluator shall observe the traffic between the TOE and the servers the data
                    decrypted at the servers to verify that the TLS sessions are distinct. The evaluator shall also observe the
                    traffic between the clients and the TOE and observe that the TLS sessions are distinct. The evaluator shall
                    note and retain the TLS session information for the remaining tests and ensure that the sessions are not
                    terminated during <xref to="stip-unique-server-sessions"/>.
                  </test>
                  <test id="stip-unique-server-sessions">The evaluator shall retain the state of the TOE from <xref to="stip-unique-client-sessions"/>. If TLS resumption is supported, the
                    evaluator shall ensure the TLS state in server 1 is retained. The evaluator shall initiate a TLS session from
                    client ‘b’ to server 1 through the TOE. The evaluator shall observe the traffic between the TOE and server
                    1, and data received at server 1 to confirm the TLS session thread between client ‘b’ and server 1 is
                    different than the TLS session between the TOE and server 1 associated to the TLS session thread between
                    client ‘a’ and server 1 established in <xref to="stip-unique-client-sessions"/>. The evaluator shall observe that the TLS session between client
                    ‘b’ and the TOE associated to the TLS session thread between client ‘b’ and server 1 is different than the
                    TLS session between client ‘b’ and the TOE associated to the TLS session thread between client b and
                    server 2 established in <xref to="stip-unique-client-sessions"/>. The evaluator shall terminate the TLS sessions from client ‘b’ to the TOE and
                    observe that both TLS sessions associated to the TLS session threads, one to server 1 and the other to
                    server 2, are terminated.</test>
                  <test>(conditional, the TSF supports session resumption): The evaluator shall initiate a TLS session resumption
                    between client ‘b’ and server 2 through the TOE, and observe that the TSF responds with a full TLS
                    handshake.</test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fdp-stip-ext-1e2">
            <title>The TSF shall obtain a certificate from the TOE CA that represents the requested
              server for establishment of the TLS session with the monitored client when
              performing an inspect operation.</title>
            <note role="application">Certificates are generated by the TOE’s embedded CA function, or obtained from
              an optional certificate cache maintained by the TOE. Certificate caching is not
              required, however, in the case where certificate caching is supported, the TSF will
              still need to perform certificate generation if no corresponding cache entry can be
              found for the requested server that matches the current certificate profile.</note>
            <aactivity level="element">
              <TSS>The evaluator shall examine the TSS to ensure it contains a description of the TOEs embedded certification
                authority function and any certificate caching in support of the inspection operation. <h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure instructions to configure the TOE’s
                embedded CA function and any certificate caching function required to meet the requirements is
                provided.
              <h:p/></Guidance>
              <Tests>
                The evaluator shall perform the following tests: <h:p/>
                <testlist>
                  <test id="stip-toe-issues-server-cert">The evaluator shall configure and establish a monitored client and a requested server, and ensure
                    the requested server has a certificate issued by a CA trusted by the TSF, but different than the TOE’s
                    embedded CA. The requested server certificate shall contain a valid identifier of DNS name type
                    identifying the requested server subject alternate name extension. The monitored client will be
                    configured to send the same DNS name for the requested server in the SNI extension of its Client Hello.
                    The evaluator shall follow operational guidance to configure the TLS session establishment policy to inspect TLS
                    sessions between the monitored client and the requested server. The evaluator shall initiate a TLS session
                    between the monitored client and the requested server through the TOE, and observe that the certificate
                    received in the server certificate message at the monitored client is issued by the TOE’s embedded signing
                    certificate and contains the same DNS name for the server in the subject alternate name extension, as
                    requested by the client.</test>
                  <test>(conditional, the TSF supports certificate caching): The evaluator shall follow the operational guidance to
                    configure the TSF to retain generated certificates in cache for a short time. The evaluator shall establish
                    three monitored clients and a single requested server, and follow operational guidance to ensure TLS sessions
                    between the monitored clients and the requested server are inspected as in <xref to="stip-toe-issues-server-cert"/>. The evaluator shall
                    establish a TLS session from two of the monitored clients to the same requested server within the
                    configured cache time, and confirm that the certificates received at each client are identical. The evaluator
                    shall wait until the cache time has expired, and then initiate a TLS connection from the third monitored
                    client and note that the certificate received at the third client is different than the previous certificates
                    receive at the first two clients.</test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fdp-stip-ext-1e3">
            <title>The TSF shall <selectables>
              <selectable>require administrator confirmation of consent</selectable>
              <selectable id="banner">provide a consent to monitor banner to the client, in accordance with
                FTA_TAB.1<h:b>/TLS</h:b>, and receive an affirmative response</selectable>
            </selectables> prior to sending decrypted TLS application data from a monitored client to
              inspection processing functional component as part of an inspection operation.</title>
            <ext-comp-def-title>
              <title>The TSF shall <selectables>
                <selectable>require administrator confirmation of consent</selectable>
                <selectable id="banner">provide a consent to monitor banner to the client, in accordance with
                  FTA_TAB.1, and receive an affirmative response</selectable>
              </selectables> prior to sending decrypted TLS application data from a monitored client to
                inspection processing functional component as part of an inspection operation.</title>
            </ext-comp-def-title>
            <note role="application">The selection “require administrator confirmation of consent” means that there is
              a means for the administrator to approve the operation based on receiving
              consent from the monitored client(s). This would include “real-time” approval
              mechanisms (a pop-up, for instance, accessible to an administrator) as well as
              configuration settings indicating “pre-approval” (again, only accessible by the
              administrator) such as one-time approval at installation (prior to any decryption),
              or included in a logon banner for administrators. A particular mechanism is not
              specified as it is up to the implementation. The intent is simply to ensure consent
              is obtained prior to monitoring. </note>
            <aactivity level="element">
              <TSS>The evaluator shall examine the TSS to ensure it describes the mechanism used to determine clients have
                consented to monitoring in accordance with the requirement. If the second option in the selection is
                claimed, the evaluator shall confirm that the TSS includes a description of the confirmation exchange
                between the TSF and monitored clients.<h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to confirm that any instructions to configure the
                TSF to meet this requirement are provided. If the second option in the selection is claimed, the evaluator
                shall confirm that instructions for configuring the consent banner is provided.<h:p/></Guidance>
              <Tests>The following test is conditional on the TSF supporting a consent to monitor banner for monitored clients:
                <h:p/>
                The
                evaluator shall establish a monitored client and requested server, and follow operational guidance to configure
                the TSF to present monitored clients a consent to monitor banner. The evaluators shall follow operational
                guidance to inspect TLS traffic between the monitored client and requested server, and initiate a TLS
                session from the monitored client to the requested server through the TOE. The evaluator shall observe
                that the consent to monitor banner is provided to the client and that no traffic from the client is inspected
                until consent is provided.<h:p/>
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fdp-stip-ext-1e4">
            <title>The TSF shall provide the Bypass operation functionality by forwarding traffic
              between the monitored client and requested server such that monitored client
              can establish and maintain a TLS connection to the requested server.</title>
            <note role="application">This merely defines the Bypass operation, where the STIP does not inspect the
              traffic, and just forwards packets between the monitored client interface and the
              requested server interface.</note>
            <aactivity level="element">
              <TSS>The evaluator shall examine the TSS to ensure that the Bypass Operation is described.<h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to verify that instructions for configuring the bypass
                operation, to include logging of bypassed TLS sessions, is provided.
              <h:p/></Guidance>
              <Tests>The evaluator shall establish a monitored client and a requested server. The evaluator shall follow
                operational guidance to configure the TOE and its TLS session establishment policy so that TLS traffic between
                the monitored client and the requested server is processed via the Bypass Operation and so that bypassed
                TLS sessions are logged. The evaluator shall initiate a TLS session from the monitored client to the
                requested server through the TOE. The evaluator shall monitor traffic between the monitored client and
                the TOE and between the TOE and the requested server. The evaluator shall then observe that the TLS
                client handshake messages between the client and the TOE are identical to the client handshake messages
                between the TOE and the server, and that the TLS server handshake messages between the server and
                the TOE are identical to the TLS server handshake messages between the TOE and the client. The evaluator
                shall observe the TOE logs to ensure that the TLS session between the client and server is logged.<h:p/>
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fdp-stip-ext-1e5">
            <title>When initiating a Block operation, the TSF shall be capable of providing a
              <selectables>
                <selectable>TLS error response</selectable>
                <selectable><assignable>other error message</assignable></selectable>
              </selectables> to the
              monitored client associated with the blocked TLS session.</title>
            <note role="application">This requires the TOE to provide some form of notification to monitored client
              when the monitored client attempts to initiate a connection and that connection
              is blocked. This can be done through the TLS error response, or (using the
              “assignment” part of the selection) some other means defined by the ST author.</note>
            <aactivity level="element">
              <TSS>
                The evaluator shall examine the TSS to ensure that the block operation is described and includes the
                response to the monitored client when TLS sessions are blocked.
                <h:p/>
                The evaluator shall examine the TSS to ensure that all events that initiate a transition to the block
                operation are described.
              <h:p/></TSS>
              <Guidance>The evaluator shall examine operational documentation and verify that instructions to configure any
                configurable features of the block operation are provided.<h:p/></Guidance>
              <Tests>
                The evaluator shall establish a monitored client and a requested server. The evaluator shall follow
                operational guidance to configure the TOE and its TLS session establishment policy so that TLS sessions between
                the monitored client and the requested server through the TOE are processed by the block operation. The
                evaluator shall initiate a TLS session from the monitored client to the requested server through the TOE
                and observe that the TLS session is blocked. The evaluator shall confirm that the monitored client receives
                the specified error message.
              </Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Establishment of a TLS inspection session thread</audit-event-descr>
            <audit-event-info>
              <assignable>TLS session thread attributes</assignable>,
              <assignable>client attributes</assignable>, and
              <assignable>server attributes</assignable> associated with the thread
            </audit-event-info>
          </audit-event>
          <audit-event>
            <audit-event-descr>Establishment of an encrypted TLS data flow</audit-event-descr>
            <audit-event-info><assignable>Encrypted TLS data flow attributes</assignable></audit-event-info>
          </audit-event>
          <audit-event>
            <audit-event-descr>Bypass operation invoked</audit-event-descr>
            <audit-event-info>TLS session thread identifier, identifier(s) of processing element(s) bypassed, reason for bypass</audit-event-info>
          </audit-event>
          <audit-event>
            <audit-event-descr>Block operation invoked</audit-event-descr>
            <audit-event-info>TLS session thread identifier, reason for blocking</audit-event-info>
          </audit-event>
        </f-component>
        
        
        <ext-comp-def fam-id="FDP_TEP_EXT" title="TLS Establishment Policy">
          <fam-behavior>Components in this family define requirements for SSL/TLS inspection proxy functions.
          </fam-behavior>
        </ext-comp-def>
        
        <!-- Modified by TD0516 -->        
        <f-component name="SSL/TLS Inspection Proxy Policy" cc-id="fdp_tep_ext.1" id="fdp-tep-ext-1">
          <consistency-rationale>This SFR applies to the enforcement of the TLS session establishment policy
            which is not defined by the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF perform SSL/TLS inspection and enforce
            SSL/TLS inspection proxy rules that define how SSL/TLS traffic received by the TOE is decrypted, inspected,
            re-encrypted, forwarded, discarded, or logged, depending on the applicable rules.</comp-lev>
          <management>
            The following actions could be considered for the management functions in FMT: <h:ul>
              <h:li>Ability to manage inspection policy.</h:li>
              <h:li>Ability to configure TLS error responses for monitored clients.</h:li>
            </h:ul>
          </management>
          <audit>
            The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST:<h:ul>
              <h:li>Mutual authentication authorized.</h:li>
            </h:ul>
          </audit>
          <dependencies>
            FCS_TTTC_EXT.1 Thru-Traffic TLS Inspection Client Protocol<h:p/>
            FCS_TTTC_EXT.3 Thru-Traffic TLS Inspection Client Protocol with Mutual
            Authentication Representing Monitored Clients<h:p/>
            FCS_TTTC_EXT.5 Thru-Traffic TLS Inspection Client Support for Supported Groups
            Extension<h:p/>
            FCS_TTTS_EXT.1 Thru-Traffic TLS Inspection Server Protocol<h:p/>
            FCS_TTTS_EXT.3 Thru-Traffic TLS Inspection Server Protocol with Mutual
            Authentication of Monitored Clients<h:p/>
            FDP_PPP_EXT.1 Plaintext Processing Policy<h:p/>
            FIA_X509_EXT.1 X.509 Certificate Validation<h:p/>
            FIA_X509_EXT.2 X.509 Certificate Authentication
          </dependencies>
          <f-element id="fdp-tep-ext-1e1">
            <title>The TSF shall perform SSL/TLS Inspection Proxy functions and enforce SSL/TLS
              Inspection Proxy rules on TLS traffic received by the TSF from monitored clients
              and servers requested by monitored clients, and on TLS traffic controlled by the
              TSF to be sent to monitored clients and servers requested by monitored clients.</title>
            <note role="application">
              This element defines the policy and requires the rules (defined in other elements
              of this component) to be applied to TLS network traffic from monitored clients to
              requested servers that is processed at the TOE’s network interfaces (as required
              in subsequent elements).
              <h:p/>
              This requirement is to be enforced even if the network interfaces are
              saturated/overwhelmed with network traffic.
              <h:p/>
              The requirement only applies to network traffic at the external interfaces that is
              identified as TLS traffic between a monitored client and requested server. This
              does not apply, for instance, to TLS traffic associated with administration of the
              STIP.
            </note>
          </f-element>
          <f-element id="fdp-tep-ext-1e2">
            <title>
              The TSF shall allow the definition of SSL/TLS Inspection Proxy rules based on the
              following attributes of each monitored client and requested server: [<h:i>
              <h:ul>
                <h:li>Network Protocol fields: <selectables>
                  <selectable>IPv4</selectable>
                  <selectable>IPv6</selectable>
                  <selectable><assignable>other internet protocol</assignable></selectable> 
                </selectables>: <h:ul>
                  <h:li>Source address</h:li>
                  <h:li>Destination address</h:li>
                  <h:li>Source port</h:li>
                  <h:li>Destination port</h:li>
                  <h:li><selectables>
                    <selectable><assignable>other fields containing identity attributes for the monitored client or requested server</assignable></selectable>
                    <selectable>no other fields</selectable>
                  </selectables></h:li>
                </h:ul>
                </h:li>
                <h:li>TLS Client Hello handshake message: <h:ul>
                  <h:li>Server_name extension of the requested server</h:li>
                  <h:li>Client side interface</h:li>
                </h:ul>
                </h:li>
                <h:li>TLS Server Certificate message: <h:ul>
                  <h:li>Issuer</h:li>
                  <h:li>Subject</h:li>
                  <h:li>SubjectAlternateName</h:li>
                </h:ul>
                </h:li>
                <h:li>Distinct interface:</h:li>
                <h:li><selectables linebreak="yes">
                  <selectable>TLS client certificate message <selectables linebreak="yes">
                    <selectable>Certificate issuer</selectable>
                    <selectable>Certificate subject</selectable>
                    <selectable>Certificate subject alt name</selectable></selectables>
                  </selectable>
                  <selectable><assignable>other attributes</assignable></selectable>
                  <selectable>no other attributes</selectable>
                </selectables></h:li>
              </h:ul></h:i>].
            </title>
            <ext-comp-def-title>
              <title>
              The TSF shall allow the definition of SSL/TLS Inspection Proxy rules based on the
              following attributes of each monitored client and requested server: <assignable>
              list of attributes associated with TLS connection endpoints or the traffic that is
              transmitted between them</assignable>.
              </title>
            </ext-comp-def-title>
            <note role="application">This element identifies the various attributes that are applicable when
              constructing rules to be enforced by this requirement. The rules apply to external
              interfaces receiving TLS messages from a monitored client (client side interface),
              and to the TLS messages received by the TOE in response to the TSF initiating a TLS connection to a server requested by the monitored client (server side
              interface).
              <h:p/>
              Network Protocol fields are used by the TSF to determine the IP address of the
              monitored client and the IP address of the requested server in traffic received on
              the client side interface only. Indicate which network protocols, including the
              internet layer and transport layer protocols that are used to determine the
              indicated fields that can be applicable when constructing rules for this policy.
              <h:p/>
              The TLS Client Hello messages, and optional client certificate messages are
              received on the client side interface only. If the TSF supports client authentication,
              ‘TLS client certificate message’ should be selected (with the appropriate subselections supported by the TOE), and FCS_TTTS_EXT.3,
              Authentication of Monitored Clients should be claimed.
              <h:p/>
              The TLS certificate message is received on a server side interface prior to the TSF
              sending a Server Hello done message on the client side interface. </note>
          </f-element>
          <f-element id="fdp-tep-ext-1e3">
            <title>The TSF shall allow the following operations to be associated with SSL/TLS
              Inspection Proxy rules: block, bypass, or inspect, with the capability to log the
              operation.</title>
          </f-element>
          <f-element id="fdp-tep-ext-1e4">
            <title>The TSF shall be able to define monitored clients, requested servers, and
              <selectables>
                <selectable>specific client-server connections</selectable>
                <selectable>no other abstractions</selectable>
              </selectables>
              in terms of
              the attributes associated with the SSL/TLS Inspection Proxy function.</title>
            <note role="application">This element requires that there must be a mechanism to define a “monitored
              client” and “requested server” via the attributes specified in FDP_TEP_EXT.1.2.
              This entity will then have associated rules defined in other elements in this
              component related to the STIP functionality and operations. If the TOE is able to
              define a set of attributes that represent a unique client-server connection, then
              the first selection item should be chosen.</note>
          </f-element>
          <f-element id="fdp-tep-ext-1e5">
            <title>The TSF shall be able to associate a monitored client, requested server, and
              <selectables>
                <selectable>specific client-server connections</selectable>
                <selectable>no other abstractions</selectable>
              </selectables> with the
              allowed TLS version or versions, TLS cipher suites (including TLS key exchange
              algorithms and key sizes), the supported groups per FCS_TTTC_EXT.5.1, and <selectables>
                <selectable>mutual authentication block-bypass</selectable>
                <selectable>requested server certificate revocation status unavailable</selectable>
                <selectable>critical extension in a certificate unrecognized</selectable>
                <selectable>nothing else</selectable>
              </selectables> that shall be used when performing the SSL/TLS Inspection Proxy
              operations.</title>
            <ext-comp-def-title>
              <title>The TSF shall be able to associate a monitored client, requested server, and
                <selectables>
                  <selectable>specific client-server connections</selectable>
                  <selectable>no other abstractions</selectable>
                </selectables> with the
                allowed TLS version or versions, TLS cipher suites (including TLS key exchange
                algorithms and key sizes), the supported groups per FCS_TTTC_EXT.5.1, and 
                <assignable>other TLS connection characteristics or attributes</assignable> 
                that shall be used when performing the SSL/TLS Inspection Proxy
                operations.</title>
            </ext-comp-def-title>
            <note role="application">
              This element requires a mechanism that defines, for each “monitored client” and
              “requested server” (and, if supported, unique client-server pairs), the allowed set
              of the indicated TLS characteristics associated with those entities. This association
              allows the enforcement of rules defined by other elements in this component.
              <h:p/>
              The first selection is chosen if the TOE supports rules based on both a monitored
              client and requested server pair.
              <h:p/>
              The second selection indicates events specified in other requirements that need to
              be associated with monitored clients/requested servers in rules so that
              appropriate actions can be taken.
              <h:p/>
              The first item is chosen if the TOE supports multiple responses to a client certificate request message from a requested server; FDP_TEP_EXT.1.7 and its Application Note have additional details.
              <h:p/>
              The second item is chosen if FIA_X509_EXT.2/STIP indicates a privileged user may
              indicate their choice on whether to accept a requested server certificate for which
              revocation information is not available using allowances. See also
              FDP_TEP_EXT.1.8.
              <h:p/>
              The third item is chosen if the TOE supports detection of a critical extension in a
              certificate (being validated according to FIA_X509_EXT.1/STIP) that it cannot
              interpret. RFC 5280 indicates that this situation results in an invalid certificate, but
              FIA_X509_EXT.1/STIP provides an additional option that—instead of treating the
              certificate as invalid (and thus blocking the connection)—the administrator can
              indicate that the “Bypass” operation is to be applied to the connection instead
              (which essentially defers the decision to make the connection to the client). See
              also FDP_TEP_EXT.1.8.
            </note>
          </f-element>
          <f-element id="fdp-tep-ext-1e6">
            <title>The TSF shall allow the SSL/TLS Inspection Proxy rules to be assigned to each
              distinct network interface.</title>
          </f-element>
          <f-element id="fdp-tep-ext-1e7">
            <title>The TSF shall <selectables>
              <selectable>perform a 
                <selectables>
                  <selectable>block</selectable>
                  <selectable>bypass</selectable>
                  <selectable>mutual authentication inspection</selectable>
                </selectables> operation</selectable>
              <selectable>send an empty certificate list as part of the inspection operation</selectable>
            </selectables> on the session when receiving a 
              TLS certificate request message from the requested server when establishing the TLS in accordance with FCS_TTTC_EXT.1.</title>
            <note role="application">
              The ST author will select one or more response options according to the capabilities of the TSF. 
              A mutual authentication inspection operation is a variant of the inspection operation. 
              If this item is selected, the mutual authentication SFRs FCS_TTTC_EXT.3 and FCS_TTTS_EXT.3 must be claimed. 
              If mutual authentication is not supported, one or more of the remaining options is selected: 'Block' and 
              'send an empty certificate list as part of the inspection operation' are alternative methods to ensure that 
              certificates issued by the TOE's embedded certificate authority are not provided to requested servers that are not known to trust the CA. 
              Block is initiated by the TSF; the TOE terminates the TLS session, whereas 'send an empty certificate list...' 
              allows the requested server to continue with the TLS session without client authentication or terminate the session.
              <h:p/>
              Inspection of mutual authenticated TLS requires both the client and server to trust the embedded CA, 
              and therefore has limited use. 
              It is preferred that inspection of mutual authenticated TLS be performed by components of the requested server security architecture 
              (e.g. via a traffic filtering firewall or an attribute-based access control mechanism) 
              and not be performed by devices described in this PP-Module. 
              If mutual authentication inspection is selected, 
              then the selection-based requirements FCS_TTTC_EXT.3 and FCS_TTTS_EXT.3 will be included by the ST author, 
              and the “mutual authentication” item will be selected in FCS_TTTC_EXT.1.1 and FCS_TTTS_EXT.1.1.
              <h:p/>
              If more than one response option is selected, the ‘mutual authentication block-bypass’ exception specification must be claimed in FDP_TEP_EXT.1.5 
              and be configurable within the TLS session establishment policy to determine which of the supported operations will be applied for a specific requested server. 
              It is expected, but not required, that one of the selected operations will be a default operation and the other determined by the server matching the exception specification.
            </note>
          </f-element>
          <f-element id="fdp-tep-ext-1e8">
            <title>
              The TSF shall <h:ul>
              <h:li>Block the connection if the monitored client does not support a TLS
              version, cipher suite, key exchange, and key size that are in its allowed
              set as defined in FDP_TEP_EXT.1.5</h:li>
              <h:li>Block the connection if the requested server does not negotiate a TLS
              version, cipher suite, key exchange, and key size that are in its allowed
              set as defined in FDP_TEP_EXT.1.5</h:li>
              <h:li>Either block or <selectables>
                <selectable>require administrative approval to inspect or bypass</selectable>
                <selectable>no other rule</selectable>
              </selectables> the connection if the requested server does not
              negotiate a TLS version, cipher suite, key exchange, and key size that are
              in the set proposed by the monitored client in its Client Hello message</h:li>
              <h:li>Block or <selectables>
                <selectable>inspect</selectable>
                <selectable>bypass</selectable>
                <selectable>no other rule</selectable>
              </selectables> the connection if TOE
              certificate processing indicates revocation information is not available for
              a requested server or <selectables>
                <selectable>monitored client</selectable>
                <selectable>no other entity</selectable>
              </selectables></h:li>
              <h:li>Block or <selectables>
                <selectable>bypass</selectable>
                <selectable>no other rule</selectable>
              </selectables> a connection if TOE certificate
              processing indicates an uninterpretable critical extension is present in the
              certificate of a requested server.</h:li>
              </h:ul>
            </title>
            <note role="application">
              Support by a client for the revocation information unavailable case is determined
              by the TLS handshake protocol messages and fatal errors from the client received
              during TLS session negotiation with the TOE in accordance with FCS_TTTS_EXT.1.
              <h:p/>
              In the case where a critical extension is encountered that cannot be interpreted
              by the TOE in accordance with FIA_X509_EXT.1.1/STIP “bypass” can be selected
              in the last bullet item above. Note that it is not allowed for the administrator to
              select “Inspect” in this case.
            </note>
          </f-element>
          <f-element id="fdp-tep-ext-1e9">
            <title>
              The TSF shall enforce the following default SSL/TLS Inspection Proxy rules on all
              SSL/TLS network traffic received from interfaces associated with monitored
              clients and requested servers: <h:ul>
              <h:li>The TSF shall drop and be capable of 
                <selectables>
                  <selectable>counting</selectable>
                  <selectable>logging</selectable>
                </selectables> invalid
                TLS messages</h:li>
              <h:li>The TSF shall drop and be capable of logging TLS Client Hello messages
              for which no valid client can be determined</h:li>
              <h:li>The TSF shall drop a TLS Client Hello message for which no valid server
              attribute can be determined</h:li>
                <h:li>The TSF shall drop and be capable of <selectables>
                  <selectable>counting</selectable>
                  <selectable>logging</selectable>
                </selectables> TLS messages other than a Client Hello if the message is not associated with
              an existing TLS session thread established via the inspection operation or
              a TLS encrypted data flow established via a bypass operation</h:li>
              <h:li>The TSF shall terminate a TLS session thread if it receives a fatal TLS error
              message from the monitored client</h:li>
              <h:li>The TSF shall attempt to 
                <selectables>
                  <selectable>resume the session</selectable>
                  <selectable>renegotiate the session</selectable>
                  <selectable>terminate the TLS session thread and provide a 
                    <selectables>
                      <selectable>TLS error message</selectable>
                      <selectable><assignable>method of notification</assignable> to the monitored client associated with the TLS session thread</selectable>
                    </selectables>
                  </selectable>
                </selectables>
               if it receives a fatal TLS error
              message on the TLS session to the requested server</h:li>
              <h:li>The TSF shall terminate a TLS session thread established via the inspect
              operation, and terminate a TLS encrypted data flow established by the
              bypass operation, if the TSF receives no traffic from the associated
              monitored client for a configurable period</h:li>
              <h:li>The TSF shall transition a TLS session thread state from inspect operation
              to block operation, when indicated to do so by the TLS plaintext
              processing policy.</h:li>
              </h:ul>
            </title>
            <ext-comp-def-title>
              <title>
                The TSF shall enforce the following default SSL/TLS Inspection Proxy rules on all
                SSL/TLS network traffic received from interfaces associated with monitored
                clients and requested servers: <h:ul>
                  <h:li>The TSF shall drop and be capable of 
                    <selectables>
                      <selectable>counting</selectable>
                      <selectable>logging</selectable>
                    </selectables> invalid
                    TLS messages</h:li>
                  <h:li>The TSF shall drop and be capable of logging TLS Client Hello messages
                    for which no valid client can be determined</h:li>
                  <h:li>The TSF shall drop a TLS Client Hello message for which no valid server
                    attribute can be determined</h:li>
                  <h:li>The TSF shall drop and be capable of <selectables>
                    <selectable>counting</selectable>
                    <selectable>logging</selectable>
                  </selectables> TLS messages other than a Client Hello if the message is not associated with
                    an existing TLS session thread established via the inspection operation or
                    a TLS encrypted data flow established via a bypass operation</h:li>
                  <h:li>The TSF shall terminate a TLS session thread if it receives a fatal TLS error
                    message from the monitored client</h:li>
                  <h:li>The TSF shall attempt to 
                    <assignable>corrective or reactive actions</assignable>
                    if it receives a fatal TLS error
                    message on the TLS session to the requested server</h:li>
                  <h:li>The TSF shall terminate a TLS session thread established via the inspect
                    operation, and terminate a TLS encrypted data flow established by the
                    bypass operation, if the TSF receives no traffic from the associated
                    monitored client for a configurable period</h:li>
                  <h:li>The TSF shall transition a TLS session thread state from inspect operation
                    to block operation, when indicated to do so by the TLS plaintext
                    processing policy.</h:li>
                </h:ul>
              </title>
            </ext-comp-def-title>
            <note role="application">
              Dropping a message, performing a block operation, and transitioning to a block
              operation are different. Dropping a message is typically a silent operation;
              performing block operation may require messages to be sent to the monitored
              client associated to the TLS Client Hello; transitioning to a block operation involves
              termination of the TLS session thread, and potentially sending TLS alert messages
              to the requested server and TLS alert messages or other messages to the
              monitored client. 
            </note>
          </f-element>
          <f-element id="fdp-tep-ext-1e10">
            <title>The TSF shall block all connections for which an Inspection or Bypass operation is
              not defined.</title>
            <note role="application">This is the deny by default rule. Note that the block rule does not need to be
              explicitly defined. This element should not be interpreted that all Client Hello
              packets should be blocked; the intent is that the Client Hello is initiated from the
              monitored client, and then the TOE performs processing to determine what to do
              with the requested connection. If it cannot find a rule that applies for the
              requested connection, then this element requires that the connection be blocked.</note>
          
            <aactivity>
              <TSS>
                The evaluator shall examine the TSS and verify that the TLS session establishment policy is adequately
                described. The evaluator shall verify that the TSS description of the TLS session establishment policy
                includes a discussion of the TOE’s initialization/startup process, which clearly indicates where processing
                of TLS messages begins and provides a discussion that supports the assertion that TLS messages are
                dropped during this process.
                <h:p/>
                The evaluator shall verify that the TSS also includes a narrative that identifies the components involved in
                processing TLS messages and describe the safeguards that would prevent inspection or Bypass Operation
                functions being performed in the event of a component failure. This could include the failure of a
                component or a failure within a component. The evaluator shall also verity that the TSS description
                indicates how the TLS protocol is recognized at each client side and server side interface.
                <h:p/>
                The evaluator shall examine the TSS and verify that it describes any non-configurable rules implementing
                the TLS session establishment policy and that it describes how such rules invoke the inspect, bypass, or
                block operations based on the subject attributes included in FDP_TEP_EXT.1.2.
                <h:p/>
                The evaluator shall verify that the TSS describes a TLS session establishment policy and the attributes
                identified in FDP_TEP_EXT.1.2 are identified as being configurable within the TLS session establishment
                policy rules. The evaluator shall verify that each configurable rule of the TLS session establishment policy
                can identify the block, bypass or inspect operation, with the option to log block and bypass operation.
                <h:p/>
                The evaluator shall examine the TSS and verify that rules to define server allowances, 
                client allowances, and other entity allowances (if supported) for TLS parameter usage and 
                TLS processing errors that depend on the TLS session establishment policy is described and 
                includes all conditions indicated in FDP_TEP_EXT.1.5. 
                If multiple response options for receiving a client certificate request message from a requested server are selected in FDP_TEP_EXT.1.7, 
                the evaluator shall confirm that the ‘mutual authentication block-bypass’ specification is claimed in FDP_TEP_EXT.1.5 and 
                that a description of the processing rules for a TLS client certificate request are included in the TSS description of the TLS session establishment policy.
                <h:p/>
                If mutual authentication for thru-traffic processing is supported, the evaluator shall examine the TSS
                and verify that policy rules to define when mutual authentication is allowed are described.
                <h:p/>
                The evaluator shall examine the TSS and verify that description of the TLS protocol and TLS session
                establishment policy describe the policy-specified behavior that results from TLS protocol errors as
                required in FDP_TEP_EXT.1.8.
                <h:p/>
                The evaluator shall examine the TSS and verify that the default rules indicated in FDP_TEP_EXT.1.9 and
                FDP_TEP_EXT.1.10 are described.
              <h:p/></TSS>
              <Guidance>
                
                The evaluator shall examine the operational guidance to verify that instructions to configure the
                TLS session establishment policy are provided.
                <h:p/>
                The evaluator shall examine the operational guidance documents and verify that they identify all attributes
                included in FDP_TEP_EXT.1.2 as being configurable within the TLS session establishment policy, which is
                that all configurable features of the TLS session establishment policy function are described in the
                operational guidance.
                <h:p/>
                The evaluator shall examine the operational guidance documents and verify they indicate each rule can identify
                the following operations: block, bypass, and inspect. The evaluator shall confirm that instructions for
                configuring the inspection, bypass, and block operations within rules are included.
                <h:p/>
                The evaluator shall examine the operational guidance documents and verify they specify each rule indicating
                block or bypass operations can designate whether logging or counting of TLS Client Hello messages
                invoking the operation is performed.
                <h:p/>
                The evaluator shall examine the operational guidance documents and verify they provide instructions on
                configuring the TLS parameter allowances identified in FDP_TEP_EXT.1.5 and those responses to TLS
                protocol errors identified in FDP_TEP_EXT.1.8.are indicated.
                <h:p/>
                The evaluator shall examine the operational guidance documents and verify that any instructions required to
                configure the TLS session establishment policy to meet the requirements in this component are provided.
              <h:p/></Guidance>
              <Tests>
                <h:b>Setup:</h:b> The evaluator shall configure one or more monitored clients to present TLS requests to various TLS
                servers through the TOE. The TLS servers will obtain certificates issued by an external certification
                authority trusted by the TSF. The client, server, and the server certificates will meet the conditions
                described in each test. The evaluator shall configure the TOE according to operational guidance to have
                non-trivial rules for all TLS session establishment policy states. The evaluator shall conduct the following
                tests, establishing any additional configuration requirements as indicated in each.
                <testlist>
                  <test>For each rule of the TLS establishment policy indicating inspection operation processing, the
                    evaluator shall ensure the monitored client  and requested server are configured to communicate 
                    through the TOE and that the server
                    certificate is valid. The evaluator shall configure the TSF so the rule
                    applies to the monitored client and requested server. The evaluator shall establish a TLS session from the
                    monitored client to the requested server through the TOE. The evaluator shall then observe the TSF audit
                    record, certificate repository, TLS Server Hello data received at the client, plaintext encrypted at the client,
                    and plaintext decrypted by the requested server. The evaluator shall then confirm that the TSF established
                    a TLS session with the requested server, issued a certificate representing the requested server, established
                    a TLS session with the monitored client, decrypted the data, performed any inspection processing, and
                    presented the data to the requested server via the established TLS session.</test>
                  <test>For each rule of the TLS establishment policy indicating bypass processing, the evaluator shall
                    establish a monitored client, requested server, and server certificate that meets the rule. The evaluator
                    shall send a TLS request from the monitored client to the requested server through the TOE, and then
                    inspect logs, certificate repository, certificate received by the monitored client in the Server Hello
                    message, plaintext encrypted by the monitored client, and plaintext decrypted by the requested server to
                    confirm that bypass processing occurred.</test>
                  <test>The evaluator shall follow operational guidance to ensure the TSF is configured to log blocked TLS sessions.
                    For each rule of the TLS establishment policy indicating blocking of the TLS session, as indicated in any
                    element of this component, the evaluator shall establish that a monitored client, a requested server, and
                    a server certificate meet the rule. The evaluator shall send a TLS session from the monitored client to the
                    requested server through the TOE and observe that the monitored client receives an error response in
                    accordance with FDP_STIP_EXT.1.5 indicating that the session was blocked. The evaluator shall inspect
                    the TSF logs to verify that each session was recorded as blocked.</test>
                  <test>For each event that initiates a transition from the inspection operation to the block operation, the
                    evaluator shall attempt to establish a monitored client and requested server, and configure the TOE and
                    its TLS session establishment policy to invoke the event. For each such event, the evaluator shall initiate
                    a TLS session from the monitored client to the requested server through the TOE. The evaluator shall
                    monitor traffic between the monitored client and the TOE, and monitor traffic between the TOE and the
                    requested client, observing that TLS handshake messages prior to the event are sent, and that any TLS
                    sessions established prior to the event are terminated on transition of the session to the block operation.
                    The evaluator shall observe that the monitored client receives the specified error message indicating that
                    the TLS session is blocked.
                  </test>
                  <test>
                    <!-- Note: changed conditional statement to make it more obvious what the trigger is for this test --> 
                    (conditional, both 'mutual authentication inspection' and 'send an empty certificate list as part of the inspection operation' are selected in FDP_TEP_EXT.1.7):
                    The evaluator shall establish a server to send certificate requests in its TLS handshake. 
                    The evaluator shall extablish a monitored client configured to provide a valid client certificate in response to a certificate request. 
                    The evaluator shall follow operational guidance to configure the TLS inspection proxy policy to send an empty certificate list in a certificate message to the server, 
                    and initiate a TLS request from a monitored client to the server through the TOE. 
                    The evaluator shall observe network traffic between the TOE and the requested server and confirm that the TOE sends an empty certificate list to the server after receiving the certificate request.
                    <h:p/>
                    Using the same server, the evaluator shall follow operational guidance to configure the TSF to perform mutual authentication inspection with the server, 
                    and initiate a TLS request from the same monitored client ro the same requested server through the TOE. 
                    The evaluator shall observe network traffic between the TOE and the requested server and confirm the TOE sends a certificate message containing a client certificate representing the monitored client.
                  </test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Mutual authentication authorized</audit-event-descr>
            <audit-event-info><assignable>client attributes obtained from the validated client certificate</assignable></audit-event-info>
          </audit-event>
        </f-component>
        
    
      </section>  <!-- FDP -->
      
      
      <!-- Identification and Authentication (FIA) -->
      <section title="Identification and Authentication (FIA)" id="m-fia">
        
        <ext-comp-def fam-id="FIA_ENR_EXT" title="Certificate Enrollment">
          <fam-behavior>Components in this family define requirements for generation of certificate requests.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="Certificate Enrollment" cc-id="fia_enr_ext.1" id="fia-enr-ext-1">
          <consistency-rationale>This SFR applies to the ability to generate a certificate request which is not
            defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to support PKCS#10 or Enrollment over Secure
            Transport as a method of requesting a certificate from an external CA.</comp-lev>
          <management>The following actions could be considered for the management functions in FMT:<h:ul>
            <h:li>Ability to generate and export PKCS#10 messages.</h:li>
          </h:ul>
          </management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>
            [FIA_ESTC_EXT.1 Enrollment over Secure Transport (EST) Client, OR<h:p/>
            FIA_X509_EXT.3 X.509 Certificate Requests]
          </dependencies>
          <f-element id="fia-enr-ext-1e1">
            <title>
              The TSF shall be able to generate a certificate request to an external certification
              authority to receive a certificate for the TOE’s embedded CA’s signing key using <selectables linebreak="yes">
              <selectable>PKCS#10 in accordance with FIA_X509_EXT.3</selectable>
              <selectable id="EST">Enrollment over Secure Transport (EST) in accordance with
              FIA_ESTC_EXT.1</selectable>
              </selectables>.
            </title>
            <note role="application">The external certification authority may be a root or intermediate certification
              authority that is used to issue and manage the TOE’s embedded CA’s certificate.
              It is not to be used to directly issue end entity certificates to requested servers
              instead of the TOE’s embedded CA.</note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure that it describes the certificate enrollment function options.
              <h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance documentation and confirm that it contains
                instructions for obtaining a certificate for the embedded CA using the options claimed in FIA_ENR_EXT.1.1.<h:p/></Guidance>
              <Tests>Testing for this SFR is addressed through evaluation of FIA_X509_EXT.3 or FIA_ESTC_EXT.1, depending on the selections made in FIA_ENR_EXT.1.1.</Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>  
        
        <f-component name="X.509 Certificate Validation (STIP)" cc-id="fia_x509_ext.1" iteration="STIP" id="fia-x509-ext-1-stip">
          <consistency-rationale>This SFR specifies validation of certificates used for connections supporting
            STIP functions.</consistency-rationale>
          <f-element id="fia-x509-ext-1e1-stip">
            <title>The TSF shall validate certificates used for connections supporting STIP
              functions in accordance with the following rules: <h:ul>
                <h:li>RFC 5280 certificate validation and certification path validation
                  supporting a minimum path length of three certificates.</h:li>
                <h:li>The certification path must terminate with a trusted CA certificate
                  designated as a trust anchor.</h:li>
                <h:li>The TSF shall validate a certification path by ensuring that all CA
                  certificates in the certification path contain the basicConstraints
                  extension with the CA flag set to TRUE.</h:li>
                <h:li>The TSF shall validate the revocation status of the certificate using <selectables>
                  <selectable>the Online Certificate Status Protocol (OCSP) as specified in
                    RFC 6960</selectable>
                  <selectable>a Certificate Revocation List (CRL) as specified in RFC 5280
                    Section 6.3</selectable>
                  <selectable>Certificate Revocation List (CRL) as specified in RFC 8603</selectable>
                </selectables>.</h:li>
                <h:li>The TSF shall validate the extendedKeyUsage field according to the
                  following rules depending on the certificate type and purpose:
                <h:ul>
                  <h:li>Server certificates presented in a TLS certificate message for Thru-Traffic processing TLS shall have meet one of the following checks:
                  <h:ul>
                    <h:li>There is no extendedKeyUsage field</h:li>
                    <h:li>The extendedKeyUsage field is present and contains the Server
                      Authentication purpose (id-kp 1 with OID 1.3.6.1.5.5.7.3.1)</h:li>
                    <h:li>The extendedKeyUsage field is present and contains the ‘any’
                      purpose (id-…)</h:li>
                  </h:ul>
                  </h:li>
                  <h:li>Server certificates presented for TLS not associated with the Thru-Traffic processing include an extendedKeyUsage field that contains
                    the ServerAuthentication purpose (id-kp 1 with OID
                    1.3.6.1.5.5.7.3.1).</h:li>
                  <h:li>Code-signing certificates include the extendedKeyUsage field that
                    contains the CodeSigning purpose.</h:li>
                  <h:li>Client certificates presented for TLS for any purpose shall include
                    the extendedKeyUsage field that contains the Client
                    Authentication purpose (id-kp 2 with OID 1.3.6.1.5.5.7.3.2) in the
                    extendedKeyUsage field.</h:li>
                  <h:li>OCSP certificates presented for OCSP responses shall have the
                    OCSP Signing purpose (id-kp 9 with OID 1.3.6.1.5.5.7.3.9) in the
                    extendedKeyUsage field.</h:li>
                  <h:li>All other certificates used for any other purpose include an
                    extendedKeyUsage field that DOES NOT contain the ‘any’ purpose.</h:li>
                </h:ul>
                </h:li>
                <h:li>The TSF shall validate all extensions marked as critical and verify the
                  value is appropriate for the functionality that uses the value.</h:li>
              </h:ul>
            </title>
          </f-element>
          <f-element id="fia-x509-ext-1e2-stip">
            <title>The TSF shall only treat a certificate as a CA certificate if the basicConstraints
              extension is present and the CA flag is set to TRUE.</title>
            <note role="application">
              FIA_X509_EXT.1.1/STIP lists the rules for validating certificates for STIP
              Functions. The text that says what to do if revocation information is not
              available, or if a critical extension cannot be processed, is provided in
              FCS_TTTC_EXT.1.3.
              <h:p/>
              The ST author selects whether revocation status is verified using OCSP or CRLs.
              The SFR indicates that the TOE be capable of supporting a minimum path length
              of three certificates. This means that the TOE supports a hierarchy comprising
              of at least a self-signed root CA certificate, a subordinate CA certificate, and a
              leaf certificate. The chain validation is expected to terminate with a trust
              anchor. This means the validation can terminate with any trusted CA certificate
              designated as a trust anchor. This CA certificate must be loaded into the trust
              store ('certificate store', ' trusted CA Key Store' or similar) managed by the TOE
              trust store. If the TOE’s trust store supports loading of multiple hierarchical CA
              certificates or certificate chains, the TOE must clearly indicate all certificates
              that it considers trust anchors. The validation of X.509v3 leaf certificates
              comprises several steps: <h:ol type="a">
                <h:li>A Certificate Revocation Check refers to the process of determining the
                  current revocation status of an otherwise structurally valid certificate.
                  This must be performed every time a certificate is used for
                  authentication. This check must be performed for each certificate in the
                  chain up to, but not including, the trust anchor. This means that CA
                  certificates that are not trust anchors, and leaf certificates in the chain,
                  must be checked. It is not required to check the revocation status of any
                  CA certificate designated a trust anchor, however if such check is
                  performed it must be handled consistently with how other certificates
                  are checked.</h:li>
                <h:li>An expiration check must be performed. This check must be conducted
                  for each certificate in the chain, up to and including the trust anchor.</h:li>
                <h:li>The continuity of the chain must be checked, showing that the signature
                  on each certificate that is presented to the TOE is valid and the chain
                  terminates at the trust anchor.</h:li>
                <h:li>The presence of relevant extensions in each certificate in the chain such
                  as the extendedKeyUsage parameters of the leaf certificate must
                  correspond to SFR-relevant functionality. For example, a peer acting as
                  a web server should have TLS Web Server Authentication listed as an
                  extendedKeyUsage parameter of its X.509v3 certificate. The TOE
                  ensuresthat the relevant extensions in each certificate in the chain such
                  as the extendedKeyUsage parameters of the leaf certificate correspond
                  to the SFR-relevant functionality they are used with.</h:li>
              </h:ol><h:p/>
              It is expected that revocation checking is performed when a certificate is used
              in an authentication step. It is expected that revocation checking is performed
              on both leaf and intermediate CA certificates when a leaf certificate is presented
              to the TOE as part of the certificate chain during authentication. Revocation
              checking of any CA certificate designated a trust anchor is not required.
              <h:p/>
              If the TOE implements mutual authentication or acts as a server, there is no
              expectation of performing any checks on TOE’s own leaf certificate during
              authentication. FIA_X509_EXT.1.2/STIP applies to certificates that are used and
              processed by the TSF and restricts the certificates that may be added as trusted
              CA certificates.
            </note>
            <aactivity>
              <TSS>
                The evaluator shall ensure the TSS describes where the check of validity of requested server TLS
                certificates, associated OCSP certificates, and if mutual authentication for thru-traffic processing is
                supported, where the check of validity of monitored client TLS certificates takes place.
                <h:p/>
                The TSS shall describe when revocation checking is performed and on what certificates. If the revocation
                checking during authentication is handled differently depending on whether a full certificate chain or only
                a leaf certificate is being presented, any differences must be summarized in the TSS section and explained
                in the guidance.
                <h:p/>
                It is expected that revocation checking is performed when a certificate is used in an authentication step
                and on both leaf and intermediate CA certificates when a leaf certificate is presented to the TOE as part
                of the certificate chain during authentication. Revocation checking of any CA certificate designated a trust
                anchor is not required. It is not sufficient to perform a revocation check of a CA certificate that is not
                designated a trust anchor (e.g., for an intermediate CA), only when it is loaded onto the device.
              <h:p/></TSS>
              <Guidance>There are no guidance EAs for this component.<h:p/></Guidance>
              <Tests>
                The evaluator shall demonstrate that checking the validity of a certificate is performed when a certificate
                is used in an authentication of a requested server certificate, or, if mutual authentication for throughtraffic processing is supported, a monitored client certificate, as well as CA certificates included in the
                certificate path and any for OCSP responses used in validating these certificates. The evaluator shall
                perform the following tests for FIA_X509_EXT.1.1/STIP. These tests must be repeated for each distinct
                security function that uses X.509v3 certificates in association with thru-traffic processing. For
                example, if the TOE implements mutual authentication for thru-traffic processing, then it shall be
                tested with each of FCS_TTTC_EXT.1 and FCS_TTTS_EXT.3.
                <!-- Note: another case of re-numbering tests because testlist requires them to be sequential -->
                <testlist>
                  <test id="valid-cert-chain"> The evaluator shall present the TOE with a valid chain of certificates (terminating in a trusted CA
                    certificate) as needed to validate the leaf certificate to be used in the function, and shall use this chain to
                    demonstrate the function succeeds. This test shall be designed so that the chain can be broken in <xref to="broken-cert-chain"/>
                    by either being able to remove the trust anchor from the TOEs trust store or by setting up the trust store
                    in a way that at least one intermediate CA certificate needs to be provided together with the leaf
                    certificate from outside the TOE, to complete the chain (e.g. by storing only the root CA certificate in the
                    trust store).
                  </test>
                  <test id="broken-cert-chain">The evaluator shall then ‘break’ the chain used in <xref to="valid-cert-chain"/> by either removing the trust anchor in
                    the TOE's trust store used to terminate the chain, or by removing one of the intermediate CA certificates
                    (provided together with the leaf certificate in <xref to="valid-cert-chain"/>) to complete the chain. The evaluator shall show
                    that an attempt to validate this broken chain fails.
                  </test>
                  <test>The evaluator shall demonstrate that validating an expired certificate results in the function failing.
                  </test>
                  <test>The evaluator shall test that the TOE can properly handle revoked certificates–conditional on
                    whether CRL or OCSP is selected; if both are selected, then a test shall be performed for each method.
                    The evaluator shall test revocation of the peer certificate and revocation of the peer intermediate CA
                    certificate (i.e. the intermediate CA certificate should be revoked by the root CA). The evaluator shall
                    ensure that a valid certificate is used, and that the validation function succeeds. The evaluator shall then
                    attempt the test with a certificate that has been revoked (for each method chosen in the selection) to
                    ensure when the certificate is no longer valid that the validation function fails. Revocation checking is only
                    applied to certificates not designated as trust anchors. Therefore, the revoked certificates used for testing
                    shall not be a trust anchor.</test>
                  <test>If OCSP is selected, the evaluator shall configure the OCSP server or use a man-in-the-middle tool
                    to present a certificate that does not have the OCSP signing purpose and verify that validation of the OCSP
                    response fails. If CRL is selected, the evaluator shall configure the CA to sign a CRL with a certificate that
                    does not have the cRLSign key usage bit set, and verify that validation of the CRL fails.</test>
                  <test>The evaluator shall modify any byte in the first eight bytes of the certificate and demonstrate that
                    the certificate fails to validate (the certificate will fail to parse correctly).</test>
                  <test>The evaluator shall modify any byte in the last byte of the certificate and demonstrate that the
                    certificate fails to validate (the signature on the certificate will not validate).</test>
                  <test>The evaluator shall modify any byte in the public key of the certificate and demonstrate that the
                    certificate fails to validate (the hash of the certificate will not validate).</test>
                </testlist><h:p/>
                <!-- Would it be better if we broke this testing up per-element since there are two different sets of tests that explicitly reference both elements -->
                The evaluator shall perform the following tests for FIA_X509_EXT.1.2/STIP. The tests described must be
                performed in conjunction with the other certificate services assurance activities, including
                FCS_TTTC_EXT.1 and FCS_TTTS_EXT.3 if claimed. The tests for the extendedKeyUsage rules are performed
                in conjunction with the uses that require those rules, where the TSS identifies any of the rules for
                extendedKeyUsage fields for thru-traffic processing (in FIA_X509_EXT.1.1/STIP).
                <h:p/>
                The goal of the following tests to verify the TOE accepts a certificate as a CA certificate only if it has been
                marked as a CA certificate by using BasicConstraints with the CA flag set to True (and implicitly tests that
                the TOE correctly parses the BasicConstraints extension as part of X509v3 certificate chain validation).
                <h:p/>
                For each of the following tests the evaluator shall create a chain of at least three certificates: a self-signed
                root CA certificate, an intermediate CA certificate, and a leaf (node) certificate. The properties of the
                certificates in the chain are adjusted as described in each individual test below (and this modification shall
                be the only invalid aspect of the relevant certificate chain).<h:p/>
                <testlist>
                  <test>The evaluator shall ensure that at least one of the CAs in the chain does not contain the
                    BasicConstraints extension. The evaluator shall confirm that the TOE rejects such a certificate at one (or
                    both) of the following points: (i) as part of the validation of the leaf certificate belonging to this chain or
                    (ii) when attempting to add a CA certificate without the BasicConstraints extension to the TOE’s trust store
                    (i.e. when attempting to install the CA certificate as one which will be retrieved from the TOE itself when
                    validating future certificate chains).
                  </test>
                  <test>The evaluator shall ensure that at least one of the CA certificates in the chain has a BasicConstraints
                    extension in which the CA flag is set to FALSE. The evaluator shall confirm that the TOE rejects such a
                    certificate at one (or both) of the following points: (i) as part of the validation of the leaf certificate
                    belonging to this chain or (ii) when attempting to add a CA certificate with the CA flag set to FALSE to the
                    TOE’s trust store (i.e. when attempting to install the CA certificate as one which will be retrieved from the
                    TOE itself when validating future certificate chains).
                    <h:p/>
                    The evaluator shall repeat these tests for each distinct use of certificates for thru-traffic processing.
                    For example, use of certificates for establishing a TLS connection to a requested server is distinct from use
                    of certificates for client authentication of a monitored client, if supported, and both of these uses would
                    be tested. </test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
        
        
        <f-component cc-id="fia_x509_ext.2" iteration="STIP" id="fia-x509-ext-2-stip" name="X.509 Certificate Authentication (STIP)">
          <consistency-rationale>The PP-Module iterates this SFR from its definition in the Base-PP to
            specify minimum required functionality for X.509 authentication based on its use in STIP. The PP-Module
            also refines the authorized roles that can perform the related management function.</consistency-rationale>
          <f-element id="nd-fia-x509-ext-2e1">
            <title>
              The TSF shall use X.509v3 certificates as defined by RFC 5280 to support
              authentication for [<h:i>TLS</h:i>] and [<h:i>no additional uses</h:i>]. 
            </title>
          </f-element>
          <f-element id="nd-fia-x509-ext-2e2">
            <title>When the TSF cannot establish a connection to determine the <h:b>revocation status</h:b>
              of a certificate, the TSF shall <selectables>
                <selectable>allow the <h:b><selectables>
                  <selectable>Security Administrator</selectable>
                  <selectable>CA Operations Staff</selectable>
                </selectables></h:b>
                  to choose whether to <h:b><selectables>
                    <selectable>accept the certificate</selectable>
                    <selectable>associate the failed connection event per FDP_TEP_EXT.1.5</selectable>
                  </selectables></h:b> in these cases</selectable>
                <selectable>accept the certificate</selectable>
                <selectable>not accept the certificate</selectable>
              </selectables>.
            </title>
            <note role="Application">
              This SFR is iterated from its definition in the Base-PP to define the implementation of this function specifically with respect to STIP functionality.
              The Base-PP version of the SFR is used to define this function in the context of Base-PP functionality 
              (e.g. non-STIP trusted channels, code signing for software updates).  
              <h:p/>
              The second element has three modifications from that in the Base-PP. First, the
              word “validity” is replaced with “revocation status” for clarity. This is consistent
              with what is in the application note in the NDcPP, and using “revocation status”
              more directly indicates what is required.
              <h:p/>
              Second, the general notion of “administrator” is replaced with the more refined
              roles defined in this PP-Module; the ST author should make the appropriate
              selection.
              <h:p/>
              Finally, a selection is added that allows ST author flexibility in addressing the issue
              of failure to connect to check revocation status in the specific case that the
              certificates being checked are associated with either a monitored client or a
              requested server. This selection (“to associate the failed connection event per
              FDP_TEP_EXT.1.5”), when chosen, indicates that selected administrative role is
              able to specify a STIP operation (block, bypass, inspect) to be taken in the event
              that the revocation status can’t be checked. The requirement that the TOE be able
              to perform this operation when such an event occurs is specified in
              FDP_TEP_EXT.1.5.
            </note>
            <aactivity>
              <no-tests>This SFR is evaluated per the EAs for FIA_X509_EXT.2 defined in the Base-PP.</no-tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
      </section>  <!-- FIA -->

	<!-- Security Management (FMT)  -->
    <section title="Security Management (FMT)" id="m-fmt">
        The TOE is not required to maintain a management interface for STIP functions that is separate from the
        management functions that the NDcPP requires. If some or all STIP functions are managed separately, 
        the relevant management functions from the NDcPP also apply to any management interfaces used specifically to meet the requirements of this PP-Module.
        
        
      <f-component name="Management of Functions Behavior" cc-id="fmt_mof.1" id="fmt-mof-1" iteration="STIP">
        <consistency-rationale>
          This SFR applies to the restriction of management functions to certain roles that are not defined in the Base-PP, 
          which only requires management functionality to be performed by a security administrator.
        </consistency-rationale>
        <f-element id="fmt-mof-1e1">
          <title>
            The TSF shall restrict the ability to [<h:i>modify the behaviour of</h:i>] the functions
            <assignable>functions defined in the Management Functions and Privileges table
              that are claimed in FMT_SMF.1.1 and FMT_SMF.1.1/STIP</assignable> to <assignable>roles defined in the
            Management Functions and Privileges table</assignable>.
            <h:p/>
            <!-- Note: Was not sure if exact reproduction of Module 1.0 table was possible using management-function-set tags so recreated table manually, is this ok -->
            <h:table>
              <h:tr class="header"><h:td>Management Function</h:td><h:td>Security Administrator</h:td><h:td>Auditor</h:td><h:td>Account Manager</h:td><h:td>CA Operations Staff</h:td></h:tr>
              <h:tr><h:td colspan="5">Base-PP Mandatory Management Functions (FMT_SMF.1 and FMT_SMF.1/STIP)</h:td></h:tr>
              <h:tr><h:td>Ability to administer the TOE locally and remotely</h:td><h:td>M</h:td><h:td>CM</h:td><h:td>CM</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to configure the access banner</h:td><h:td>M</h:td><h:td>-</h:td><h:td>O</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td>Ability to update the TOE and to verify the updates</h:td><h:td>M</h:td><h:td>-</h:td><h:td>O</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td>Ability to configure the authentication failure parameters for FIA_AFL.1</h:td><h:td>M</h:td><h:td>-</h:td><h:td>O</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td>Ability to manage user accounts</h:td><h:td>C</h:td><h:td>-</h:td><h:td>CM</h:td><h:td>-</h:td></h:tr>
              <h:tr><h:td>Ability to manage remote audit mechanism</h:td><h:td>M</h:td><h:td>CM</h:td><h:td>-</h:td><h:td>-</h:td></h:tr>
              <h:tr><h:td>Ability to perform on-demand integrity tests</h:td><h:td>O</h:td><h:td>O</h:td><h:td>O</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td>Ability to import and remove X.509v3 certificates used for STIP into or from the Trust Anchor database</h:td><h:td>C</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to configure identifying information for the TOE's embedded CA</h:td><h:td>C</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to configure a maximum certificate validity duration</h:td><h:td>C</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to manage inspection policy</h:td><h:td>O</h:td><h:td>-</h:td><h:td>-</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td>Ability to configure inspection processing details</h:td><h:td>O</h:td><h:td>-</h:td><h:td>-</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td colspan="5">Base-PP Selectable Management Functions (FMT_SMF.1 and FMT_SMF.1/STIP)</h:td></h:tr>
              <h:tr><h:td>Ability to start and stop services</h:td><h:td>O</h:td><h:td>-</h:td><h:td>-</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td>Ability to configure local audit behavior</h:td><h:td>O</h:td><h:td>O</h:td><h:td>-</h:td><h:td>-</h:td></h:tr>
              <h:tr><h:td>Ability to modify the behavior of the transmission of audit data to an external IT entity, the handling of audit data, the audit functionality when Local Audit Storage Space is full</h:td>
                <h:td>M</h:td><h:td>CM</h:td><h:td>-</h:td><h:td>-</h:td></h:tr>
              <h:tr><h:td>Ability to search local audit</h:td><h:td>C</h:td><h:td>CM</h:td><h:td>-</h:td><h:td>-</h:td></h:tr>
              <h:tr><h:td>Ability to configure the list of TOE-provided services available before an entity is identified and authenticated, as specified in FIA_UIA_EXT.1</h:td>
                <h:td>M</h:td><h:td>-</h:td><h:td>O</h:td><h:td>-</h:td></h:tr>
              <h:tr><h:td>Ability to manage cryptographic keys</h:td><h:td>M</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to configure the cryptographic functionality</h:td><h:td>M</h:td><h:td>-</h:td><h:td>-</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td>Ability to configure thresholds for SSH rekeying</h:td><h:td>M</h:td><h:td>-</h:td><h:td>O</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td>Ability to configure the lifetime for IPsec SAs</h:td><h:td>M</h:td><h:td>-</h:td><h:td>-</h:td><h:td>-</h:td></h:tr>
              <h:tr><h:td>Ability to configure the interaction between TOE components</h:td><h:td>M</h:td><h:td>O</h:td><h:td>-</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td>Ability to enable or disable automatic checking for updates or automatic updates</h:td><h:td>M</h:td><h:td>-</h:td><h:td>-</h:td><h:td>-</h:td></h:tr>
              <h:tr><h:td>Ability to re-enable an administrator account</h:td><h:td>C</h:td><h:td>-</h:td><h:td>CM</h:td><h:td>-</h:td></h:tr>
              <h:tr><h:td>Ability to set the time which is used for time-stamps</h:td><h:td>M</h:td><h:td>O</h:td><h:td>-</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td>Ability to configure NTP</h:td><h:td>M</h:td><h:td>-</h:td><h:td>-</h:td><h:td>-</h:td></h:tr>
              <h:tr><h:td>Ability to configure the reference identifier for the peer</h:td><h:td>M</h:td><h:td>-</h:td><h:td>-</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td>Ability to manage the TOE's trust store and designate X.509v3 certificates as trust anchors</h:td><h:td>M</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to import X.509v3 certificates to the TOE's trust store</h:td><h:td>M</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to configure and manage certificate profiles</h:td><h:td>C</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to revoke issued certificates</h:td><h:td>C</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to configure certificate status services</h:td><h:td>C</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to configure automated process used to approve the revocation of a certificate or information about the revocation of a certificate</h:td>
                <h:td>C</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to clear a cache of valid issued certificates</h:td><h:td>M</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to configure rules for automated issuance of certificates</h:td><h:td>C</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to modify the CRL and/or OCSP configuration</h:td><h:td>C</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to import private keys</h:td><h:td>C</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to configure the TOE's behavior on validating certificates whose revocation status cannot be determined</h:td>
                <h:td>M</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to configure the TOE's behavior when non-supported critical extensions occur in a requested server certificate</h:td>
                <h:td>C</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to generate and export PKCS#10 messages</h:td><h:td>C</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to configure EST functionality to generate and export EST requests</h:td><h:td>C</h:td><h:td>-</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
              <h:tr><h:td>Ability to configure TLS error responses for monitored clients</h:td><h:td>M</h:td><h:td>-</h:td><h:td>-</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td>Ability to configure notification and consent message for monitored clients</h:td><h:td>M</h:td><h:td>-</h:td><h:td>-</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td>Ability to configure rules for displaying a notification and consent message for acknowledgement prior to TLS inspection processing</h:td>
                <h:td>M</h:td><h:td>-</h:td><h:td>-</h:td><h:td>O</h:td></h:tr>
              <h:tr><h:td>Ability to search the certificate repository</h:td><h:td>C</h:td><h:td>CM</h:td><h:td>-</h:td><h:td>CM</h:td></h:tr>
            </h:table>
          </title>
          <note role="application">
            <!-- is this change to the app note ok -->
            The management functions defined in this table are the same as the management
            functions defined in FMT_SMF.1 in the Base-PP as well as those defined in FMT_SMF.1/STIP in this PP-Module. The NDcPP only requires management
            functionality to be performed by a Security Administrator. This PP-Module defines optional additional management roles that may be claimed; if any of these are selected,
            this PP-Module provides guidance on how to apply those roles to the Base-PP's management functions.
            <h:p/>
            The Management Functions and Privileges table uses the following key:
            M: Mandatory (this role must perform this function)
            <h:p/>
            CM: Conditionally Mandatory (if this role is part of the TSF it must perform this
            function but if the role itself does not exist it may be satisfied elsewhere)
            <h:p/>
            C: Conditional (if a role does not exist to satisfy a conditionally mandatory
            function, this is that function’s “backup” role)
            <h:p/>
            O: Optional (this role may or may not perform this function)
            <h:p/>
            The ST author should reproduce this table and update as needed to show which
            functions are implemented by which roles.
            <h:p/>
            If a selectable function has a mandatory role mapping, this means that if the
            function is implemented it must be satisfied in a certain way; it does not mean
            that it is mandatory to implement that function.
            <h:p/>
            If a selectable function does not have a mandatory role but is mapped to multiple
            optional roles, then at least one of them must be selected if the function is
            implemented.
          </note>
          <aactivity>
            <TSS>The evaluator shall examine the TSS to ensure it identifies the restrictions consistent with this
              requirement. For every claimed management function across all interfaces, the TSS must specify how the restriction is
              achieved and by whom. <h:p/></TSS>
            <Guidance>If the role restriction mechanism is configurable, the evaluator shall examine the operational guidance to
              determine that the necessary instructions to meet the requirement for the TOE in its evaluated
              configuration are provided. This applies only to management functions implemented by or accessible
              through the TSF.<h:p/></Guidance>
            <Tests>Testing only applies to functions implemented by or accessible through the TSF. The evaluator shall, for
              each management function, assume the role defined for that function and demonstrate that the assigned
              role can perform the functions. The evaluator shall, for each management function, assume each role not
              assigned to that function, attempt to use the function, and verify that the TSF does not permit it. It may be necessary to perform multiple iterations of this test
            if the TOE has multiple interfaces that can be used to perform management functions.</Tests>
          </aactivity>
        </f-element>
        <audit-event/>
      </f-component>
	
      <f-component name="Specification of Management Functions" cc-id="fmt_smf.1" iteration="STIP" id="fmt-smf-1-stip">
        <consistency-rationale>This SFR is iterated from the Base-PP to add new management functions for STIP functionality. 
          It does not modify or replace any of the required management functions defined in the Base-PP under the un-iterated FMT_SMF.1.</consistency-rationale>
        <f-element id="fmt-smf-1e1-stip">
          <title>The TSF shall be capable of performing the following management functions <h:b>in support of STIP operations</h:b>: [<h:i>
          <h:ul>
            <h:li>Ability to manage user accounts</h:li>
            <h:li>Ability to manage remote audit mechanism</h:li>
            <h:li>Ability to perform on-demand integrity tests</h:li>
            <!-- Note: This is already covered in the Base-PP by "Ability to manage the TOE's trust store..." is it ok that we have a very similar one in the STIP iteration? 
            Alternative would be we refine FMT_SMF.1 to force the selection in Modified SFRs but then we go back to the "a second Module may modify the SFR in a contradictory manner" issue that required 
            us to iterate this SFR in the first place -->
            <h:li>Ability to import and remove X.509v3 certificates used for STIP into or from the Trust
            Anchor Database</h:li>
            <h:li>Ability to configure identifying information for the TOE’s embedded CA</h:li>
            <h:li>Ability to configure a maximum certificate validity duration</h:li>
            <h:li>Ability to manage inspection policy</h:li>
            <h:li>Ability to configure inspection processing <assignable>details beyond those covered by "inspection policy"</assignable></h:li>
          </h:ul>
            <selectables linebreak="yes">
              <selectable>Ability to configure local audit behavior</selectable>
              <selectable>Ability to configure and manage certificate profiles</selectable>
              <selectable>Ability to revoke issued certificates</selectable>
              <selectable>Ability to configure certificate status services</selectable>
              <selectable>Ability to configure automated process used to approve the
              revocation of a certificate or information about the revocation of a
              certificate</selectable>
              <selectable>Ability to clear a cache of valid issued certificates</selectable>
              <selectable>Ability to configure rules for automated issuance of certificates</selectable>
              <selectable>Ability to modify the CRL configuration</selectable>
              <selectable>Ability to modify the OCSP configuration</selectable>
              <selectable>Ability to import private keys</selectable>
              <selectable>Ability to configure the TOE’s behavior on validating certificates
              whose revocation status cannot be determined</selectable>
              <selectable>Ability to configure the TOE’s behavior when non-supported critical
              extensions occur in a requested server certificate</selectable>
              <selectable>Ability to generate and export PKCS#10 messages</selectable>
              <selectable>Ability to generate and export EST messages and accept and process
              EST responses</selectable>
              <selectable>Ability to configure TLS error responses for monitored clients</selectable>
              <selectable>Ability to configure notification and consent message for monitored
              clients</selectable>
              <selectable>Ability to configure rules for displaying a notification and consent
              message for acknowledgement prior to TLS inspection processing</selectable>
              <selectable>Ability to search the certificate repository</selectable>
              <selectable>No other capabilities</selectable></selectables>
          </h:i>].
          </title>
          <note role="application">
            This SFR defines mandatory and selectable management functions for STIP functionality specifically. The claims made here are in addition to those functions claimed for the Base-PP iteration of FMT_SMF.1.
          </note>
          <!-- Note: new EAs because SFR wasn't previously iterated -->
          <aactivity>
            <TSS>The evaluator shall examine the TSS to verify that it identifies the management functions that the TSF supports. If the TOE has multiple management interfaces, the evaluator shall verify that the TSS identifies the
            management functions that are available on each interface.<h:p/></TSS>
            <Guidance>
              For each management function that can be performed on each management interface, the evaluator shall ensure that the operational guidance includes instructions on how an authorized administrator may perform the function,
              including any restrictions or limitations on the use of the function.
            <h:p/></Guidance>
            <Tests>
              For each management function that can be performed on each management interface, the evaluator shall ensure that the operational guidance is sufficiently detailed to instruct an authorized administrator on how to perform that function.
            </Tests>
          </aactivity>
        </f-element>
        <audit-event/>
      </f-component>
      

      </section>  <!-- FMT -->

	  <!-- Protection of the TSF (FPT) -->
      <section title="Protection of the TSF (FPT)" id="m-fpt">
	 
        <f-component name="Failure with Preservation of Secure State" cc-id="fpt_fls.1" id="fpt-fls-1">
          <consistency-rationale>This SFR applies to preserving a secure state when different failures occur
            which is not defined in the Base-PP.</consistency-rationale>
          <f-element id="fpt-fls-1e1">
            <title>The TSF shall preserve a secure state when the following types of failures occur: <h:b>
              DRBG failure, integrity test failure, external audit server is unavailable, <selectables>
                <selectable>local audit storage is full</selectable>
                <selectable>update signature verification failure</selectable>
                <selectable>integrity failure on local audit</selectable>
                <selectable>integrity failure on Trust Anchor database</selectable>
                <selectable><assignable>other potential TSF failures</assignable></selectable>
              </selectables></h:b>.</title>
            <note role="application">
              The intent of this requirement is to prevent the use of failed randomization and
              other events that can compromise the operation of the TOE. This means that the
              TOE must be able to attain a secure/safe state when any of the identified failures
              occurs. If the TOE should encounter a failure in the middle of a critical operation,
              the TOE should not just quit operating, leaving key material and user data
              unprotected.
              <h:p/>
              The failure of an Operational Environment component can be just as detrimental
              to security as a failure of the TSF itself. Therefore, in addition to describing the
              potential TSF failures and how the TOE preserves a secure state in response, the
              ST author is also expected to use this SFR to express how the TOE is made aware
              of any environmental failures and how it responds to these.
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to determine that the TOE’s implementation of the fail secure
                functionality is documented, including all secure states for the TOE. The evaluator shall first examine the
                TSS section to ensure that all failure modes specified in the ST are described. The evaluator shall then
                ensure that the TOE will attain a secure state after inserting each specified failure mode type. The
                evaluator shall review the TSS to determine that the definition of secure state is defined and is suitable to
                ensure protection of key material and user data. <h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure it describes the actions that might occur in response to any detected failures 
                and provides remedial instructions for the administrator.<h:p/></Guidance>
              <Tests>The evaluator shall attempt to cause each documented failure to occur and shall verify that the
                actions taken by the TSF are those specified in FPT_FLS.1.1. For those failures that the evaluator cannot
                cause, the evaluator shall provide a justification to explain why the failure could not be induced.
              </Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Indication of failures under this requirement</audit-event-descr>
            <audit-event-info>Indication that the TSF has failed with the type of failure that occurred</audit-event-info>
          </audit-event>
        </f-component>
        
        
        <ext-comp-def fam-id="FPT_KST_EXT" title="Key Storage">
          <fam-behavior>Components in this family define requirements for secure storage of keys and secrets used by the TOE.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="No Plaintext Key Export" cc-id="fpt_kst_ext.1" id="fpt-kst-ext-1">
          <consistency-rationale>This SFR applies to the prevention of plaintext key export which is not
            defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to prevent unauthorized disclosure of all TSF
            secret and private keys.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>No dependencies.</dependencies>
          <f-element id="fpt-kst-ext-1e1">
            <title>The TSF shall prevent the plaintext export of <assignable>list of all keys used by
              the TSF</assignable>.</title>
            <note role="application">Keys include all TOE secret and private keys which includes keys generated for
              issued certificates. The intent of this requirement is to prevent the keys from being
              exported, even by a security administrator.</note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it lists all keys and specifies what interfaces exist to export
                key data, if any. <h:p/></TSS>
              <Guidance>There are no guidance EAs for this component.<h:p/></Guidance>
              <Tests>The evaluator shall access each export interface of the TOE, if any, and shall verify that the interface
                prevents the export of all keys listed in the TSS.</Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
        <f-component name="TSF Key Protection" cc-id="fpt_kst_ext.2" id="fpt-kst-ext-2">
          <consistency-rationale>This SFR applies to the prevention of unauthorized use of private and secret
            keys which is not defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to prevent unauthorized usage of all TSF secret and
            private keys.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST:<h:ul>
              <h:li>All attempts to use the TOE’s embedded CA’s private signing keys.</h:li>
              <h:li>All attempts to use specified secret and private keys in the TOE’s key storage</h:li>
            </h:ul></audit>
          <dependencies>No dependencies.</dependencies>
          <f-element id="fpt-kst-ext-2e1">
            <title>The TSF shall prevent unauthorized use of all TSF private and secret keys.</title>
            <note role="application">
              The intent of this requirement is to protect TSF private and secret keys from both
              unauthorized users, privileged users, and unprivileged processes. Keys specific to
              the TOE that should be addressed in this requirement include, but are not limited
              to, the TOE’s embedded CA’s private signing key, private keys associated to
              certificates issued by the TOE’s embedded CA and TLS session keys established to
              facilitate inspection of traffic. Users should not be able to access the keys through
              “normal” interfaces. Processes that use private or secret keys to meet the
              functionality described in this PP module are considered authorized; all other
              processes are unauthorized. When an interface allows both authorized and
              unauthorized access to a key (for example, certificate signing functions with
              access to the embedded CA’s private signing key are authorized only when
              
              certificate to be signed corresponds to a valid certificate belonging to a requested server,
              and is unauthorized at any other time), evidence of protection includes logging of
              accesses via the common interface, as indicated in Table 2 for FAU_GEN.1. 
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it describes how unauthorized use of TSF private and secret
                keys is prevented for both users and processes. <h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure it contains instructions for configuring the TOE
                or Operational Environment to prevent unauthorized access to TSF secret and private keys by users or
                processes.<h:p/></Guidance>
              <Tests>The evaluator shall assume each of the non-Administrator roles supported by the TOE and shall
                attempt to use the available TOE interface to access the keys. The evaluator shall verify that these
                attempts fail.</Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>All attempts to use the TOE's embedded CA's private signing key and 
            <selectables>
              <selectable><assignable>other secret and private keys</assignable></selectable>
              <selectable>no other secret and private keys</selectable>
            </selectables></audit-event-descr>
            <audit-event-info>Identifier of user or process that attempted access</audit-event-info>
          </audit-event>
        </f-component>
        
        <f-component name="Manual Trusted Recovery" cc-id="fpt_rcv.1" id="fpt-rcv-1">
          <consistency-rationale>This SFR applies to the maintenance mode that provides the ability to return
            to a secure state is provided which is not defined in the Base-PP.</consistency-rationale>
          <f-element id="fpt-rcv-1e1">
            <title>After <assignable>list of failures/service discontinuities</assignable> the TSF shall enter a
              maintenance mode where the ability to return to a secure state is provided.</title>
            <note role="application">
              This requirement ensures that the TSF can determine that the TOE is started up
              without protection compromise and can recover without protection compromise
              after discontinuity of operations. Anticipated failures include actions that result in
              a system crash, media failures, or discontinuity of operations caused by erroneous
              administrative action or lack of erroneous administrative action. The data that
              needs to be restored includes the TSF keys needed for signature, the Trust Anchor
              Database, keys needed for management of certificates, all signed certificates, and
              any certificate status information
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to determine that, for each failure or service discontinuity identified
                in the SFR, it describes how the TOE enters a maintenance mode after a failure and the possible actions
                that can take place while in that mode. <h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure it contains instructions for restoring the TOE to
                a secure state when it enters the maintenance mode, including the steps necessary to perform while in
                this state.<h:p/></Guidance>
              <Tests>The evaluator shall attempt to cause each documented failure to occur and shall verify that the
                result of this failure is that the TSF enters a maintenance mode. The evaluator shall also verify that the
                maintenance mode can be exited and the TSF can be restored to a secure state. This testing may be
                performed in conjunction with FPT_FLS.1.</Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>The fact that a failure or service discontinuity occurred</audit-event-descr>
            <audit-event-info>N/A</audit-event-info>
          </audit-event>
          <audit-event>
            <audit-event-descr>Resumption of regular operation</audit-event-descr>
            <audit-event-info>TSF failure types that are available on recovery</audit-event-info>
          </audit-event>
        </f-component>
   
      </section>   <!-- FPT -->
    </man-sfrs>

    <mod-sars>
      
     <!-- 5.3 TOE Security Assurance Requirements -->
<!--	<section title="TOE Security Assurance Requirements" id="s-sar">  -->
		  As a PP-Module of the NDcPP, this PP-Module does not define any additional assurance requirements
		  above and beyond what is defined in the Base-PP. In general, application of the SARs to the TOE boundary
		  described by both the NDcPP and this PP-Module is sufficient to demonstrate that the claimed SFRs have
		  been implemented correctly by the TOE. However, in some cases it may be necessary to perform
		  additional assurance activities in order to satisfy the SARs due to unique capabilities or limitations of the
		  TOE that is specified by this PP-Module. Where applicable, these evaluation activities are described below.
		
			
      
		  <section id="ava" title="Class AVA: Vulnerability Analysis"> 
		    <h:p>
		    Special attention to vulnerabilities related to outdated TLS versions and cipher suites required to process
		    traffic between monitored clients and requested servers should be paid. Additionally, vulnerabilities
		    related to the embedded CA functionality within this technology have significant consequences for both
		    the TOE and the monitored clients the TOE is intended to protect and should be thoroughly researched. 
		    </h:p>
		     
		    The evaluator shall perform the following actions in addition to the evaluation activities specified for AVA_VAN.1 in [ND-SD]: 
		    <h:ul>
		      <h:li>For Type 1 (Public Vulnerability-Based) Hypotheses, the evaluator shall also consider search phrases consisting of "TLS" 
		        in conjunction with each of the supported
		        specific cipher suite components (e.g. “TLS TDES,” “TLS CBC,” “TLS_SHA1”…) and with each supported
		        version (e.g. “TLS 1.0,” “TLS 1.2,”…) in the search criteria. Search criteria shall also include all names
		        used to represent this technology (e.g., “SSL inspection,” “TLS inspection proxy,” “middle box,” “Deep
		        inspection Firewall,”…).</h:li>
		        
		      
       
		      <h:li>For Type 2 (iTC-Source) Hypotheses, it is noted that any flaws that are specific to this PP-Module will be submitted to the NIAP TC for SSL/TLS Inspection Proxy, 
		      and that any flaws that are considered general to the technology type will be added to those that should be considered via NIAP Technical Decisions.</h:li>
		      <h:li>The evaluator shall also consider the following additional flaw hypotheses based on the TOE's inclusion of deprecated TLS versions and cipher suites that use obsolete algorithms:
		      <h:ul>
		        <h:li>Bleichenbacher type side-channel based padding Oracle flaw (CVE-2018-16868 and equivalent): this flaw is typically mitigated by randomizing computations associated with key material.</h:li>
		        <h:li>Bleichenbacher RSA padding Oracle flaw (CVE-2017-17428 and equivalent): this flaw is typically mitigated by ensuring consistency of error alerts for various events
		          related to decrypting the master key.</h:li>
		        <h:li>TLS Padding Oracle Vulnerability (CVE-2019-6485 and equivalent): this flaw is typically mitigated by randomizing the IV via insertion of empty fragments into
		          application data.</h:li>
		        <h:li>SHA-1 collision flaws (CVE-2005-4900 and equivalent): for this technology, a mitigation may include limiting the validity of issued certificates to
		          limit the number of spoofing attempts.</h:li>
		      </h:ul>
		      </h:li>
		    </h:ul><h:p/>
		    If any sections of the vulnerability analysis are not discussed here, this PP-Module does not change how they are evaluated
		  
		  </section>
		

    </mod-sars> 
	  
	<!-- Appendix A: Optional Requirements -->
 	    <!--
	    As indicated in the introduction to this PP-Module, the baseline requirements (those that must be
		performed by the TOE) are contained in the body of this PP-Module. This Appendix contains three other
		types of optional requirements that may be included in the ST but are not required in order to conform
		to this PP-Module.
		The first type (in A.1) are strictly optional requirements that are independent of the TOE implementing
		any function. If the TOE fulfills any of these requirements or supports a certain functionality, the vendor
		is encouraged but not required to add the related SFRs.
		The second type (in A.2) are objective requirements that describe security functionality not yet widely
		available in commercial technology. The requirements are not currently mandated in the body of this
		PP-Module, but will be included in the baseline requirements in future versions of this PP-Module.
		Adoption by vendors is encouraged and expected as soon as possible.
		The third type (in A.3) are implementation-dependent requirements that are dependent on the TOE
		implementing a particular function. If the TOE fulfills any of these requirements, the vendor must either
		add the related SFR or disable the functionality for the evaluated configuration.
	-->

	  <!-- A.1: Strictly Optional Requirements -->
    <!-- Note: is it ok to organize these as they were done in STIP 1.0 or should they be broken down by functional class (the order is actually the same either way) -->
    <opt-sfrs>
      <section id="opt-audit-table" title="Auditable Events for Optional SFRs">
        <audit-table table="optional" id="optional-audit-events">
          <h:br/><h:b><ctr ctr-type="Table" pre="Table " id="atref-opt">: Auditable Events for Optional SFRs</ctr></h:b>
        </audit-table>
      </section> 
      
      <section title="Persistent Local Audit Storage" id="opt-fau">
        The SFRs in this section are optional. They should be claimed if the TOE provides local audit storage (i.e.,
        if FAU_STG.1 is claimed in the base NDcPP) and that local audit storage is intended to provide a persistent,
        searchable record of security events within the TOE, either as a backup or replacement of an external
        audit capability.
        
        <f-component name="Audit Review" cc-id="fau_sar.1" id="fau-sar-1">
          <consistency-rationale>This SFR applies to who can view all the audit records which includes the
            added role of the auditor, which is not defined in the Base-PP.</consistency-rationale>
          <f-element id="fau-sar-1e1">
            <title>
              The TSF shall provide <selectables>
                <selectable>Security Administrators</selectable>
                <selectable>Auditors</selectable>
              </selectables> with the
              capability to read all information from the local audit records.
            </title>
          </f-element>
          <f-element id="fau-sar-1e2">
            <title>
              The TSF shall provide the local audit records in a manner suitable for the
              administrator to interpret the information.
            </title>
            <aactivity>
              <no-tests>This activity should be accomplished in conjunction with the testing of FAU_GEN.1/STIP. Review of each of the
                generated audit records demonstrates that these records are reviewable.</no-tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
        <f-component name="Selectable Audit Review" cc-id="fau_sar.3" id="fau-sar-3">
          <consistency-rationale>This SFR applies to the ability to search within audit records based on various
            identifiers which is not defined in the Base-PP.</consistency-rationale>
          <f-element id="fau-sar-3e1">
            <title>
              The TSF shall provide the ability to apply [<h:i>searches</h:i>] of <h:b>local</h:b> audit data based on <h:b>
                <assignable>object identifier of certificate</assignable> associated with the event</h:b>.
            </title>
            <note role="application">
              FAU_SCR_EXT.1 defines the ability of the TOE to search a certificate repository
              and/or audit trail to find certificates based on certain values of individual fields.
              The TSF will likely identify certificates using some form of unique identifier that is
              not immediately identifiable to an auditor. The intent of this SFR along with
              FAU_SCR_EXT.1 is that the auditor has the ability to obtain a certificate’s unique
              identifier by searching for other known fields and then using that unique identifier
              as an input to searching audit data for all activities involving that certificate.
            </note>
            
            <aactivity>
              <TSS>
                <h:p>
              The evaluator shall ensure that the TSS describes the TOE's ability to allow its local audit storage to be searched for audit records associated with a particular
              certificate.
              The evaluator shall also ensure that the TSS states the unique certificate object identifier used for this. 
                </h:p>
              </TSS>
              <Guidance>
                <h:p>
                  The evaluator shall ensure that the operational guidance describes how to search local audit data for records matching a given certificate identifier.
                </h:p>
              </Guidance>
              <Tests>
                <h:p>
                  The evaluator shall follow the operational guidance to search local audit data for records matching a given certificate identifier and verify that 
                  the expected results are returned.
                </h:p>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
      </section>
      <section title="Certificate Pinning" id="opt-fdp">
        Certificate pinning is an optional feature to address the threat of unauthorized access to user data
        managed by the TOE via unauthorized STIP or adversary man-in-the-middle exploits. This feature is
        desirable since implementation of a STIP to protect a client enclave will prevent the clients from effectively
        providing this feature. 
        
        <ext-comp-def fam-id="FDP_PIN_EXT" title="Certificate Pinning">
          <fam-behavior>Components in this family define requirements for the TOE’s ability to act as a TLS server for the purpose
            of reconstructing the original intended TLS connection that it is inserted into as a proxy.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="Certificate Pinning" cc-id="fdp_pin_ext.1" id="fdp-pin-ext-1">
          <consistency-rationale>This SFR applies to certificate pinning which is not defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to have the ability to associate certificate information
            with external servers and to take some action if one of these servers identifies itself using an unknown
            certificate.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>FMT_SMR.1 Security Roles</dependencies>
          <f-element id="fdp-pin-ext-1e1">
            <title>
              The TSF shall be able to detect and <selectables>
                <selectable>alert</selectable>
                <selectable>perform a [Security Administrator] managed action</selectable>
              </selectables> to changes in the 
              <selectables>
                <selectable>public key</selectable>
                <selectable>certificate</selectable>
                <selectable>certificate issuer</selectable>
              </selectables> used by requested servers according to 
              <h:b>
                <selectables>
                  <selectable>a Security Administrator configurable number of the most common requested servers</selectable>
                  <selectable>a Security Administrator specified list of servers</selectable>
                  <selectable><assignable>a Security Administrator configurable rules based on attributes of the certificates used by the server</assignable></selectable></selectables>.
              </h:b>
            </title>
            <ext-comp-def-title>
              <title>
                The TSF shall be able to detect and <selectables>
                  <selectable>alert</selectable>
                  <selectable>perform a <assignable>authorized role(s)</assignable> managed action</selectable>
                </selectables> to changes in the 
                <selectables>
                  <selectable>public key</selectable>
                  <selectable>certificate</selectable>
                  <selectable>certificate issuer</selectable>
                </selectables> used by requested servers according to 
                <assignable>characteristics of servers used for association between certificates and servers</assignable>.
              </title>
            </ext-comp-def-title>
            <note role="application">
              This requirement should be claimed if implemented by the TOE. If claimed,
              additional management functions and audit events associated with the function must be
              claimed.
            </note>
            <aactivity>
              <TSS>The evaluator shall review the TSS to ensure the certificate pinning function is described.
              <h:p/></TSS>
              <Guidance>The evaluator shall review the operational guidance to ensure it contains instructions for any configurable
                aspects of the certificate pinning function.
              <h:p/></Guidance>
              <Tests> The evaluator shall establish a monitored client and requested server with multiple certificates
                issued by one or more external certification authorities. The evaluator shall configure the TSF, to either
                pin one of the certificates, or to pin on the first certificates seen, and to alert on differences between the
                issued certificates for the requested server. If caching is supported, the evaluator shall either disable
                caching, or clear cache between TLS requests from the client. The evaluator shall then use the client to
                request a TLS session with the server using the first of the certificates, and observe that the pinning
                response is not observed. The evaluator shall then configure the server to use the second certificate, make
                a second request from the monitored client, and observe that the pinning alert response is observed.</Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
      </section>
    </opt-sfrs>

	<!-- Appendix B: Selection-Based Requirements -->
	<!--	  As indicated in the introduction to this PP-Module, the baseline requirements (those that must be
		performed by the TOE or its underlying platform) are contained in the body of this PP-Module. There are
		additional requirements based on selections in the body of the PP-Module: if certain selections are
		made, then additional requirements below will need to be included.  -->
	  
    <sel-sfrs>
      
	    <section id="sb-audit-table" title="Auditable Events for Selection-based SFRs">
        	<audit-table table="sel-based" id="sel-based-audit-events">
  	     		<h:br/><h:b><ctr ctr-type="Table" pre="Table " id="atref-sel-based">: Auditable Events for Selection-based Requirements</ctr></h:b>
	  	</audit-table>
	    </section> 
      
      <!-- Note: STIP 1.0 has the sel-based requirements organized by category rather than the usual functional class grouping. Is it ok to keep this as-is (as we've done here) 
        or should it be changed to match how PPs/Modules are more typically done? -->
      <section title="Certificate Status Information" id="s-b1">
        
        <ext-comp-def fam-id="FDP_CRL_EXT" title="Certificate Revocation List">
          <fam-behavior>Components in this family define requirements for the usage of certificate revocation lists (CRLs) as a
            method of recording certificate status information.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="Certificate Revocation List Generation" cc-id="fdp_crl_ext.1" id="fdp-crl-ext-1">
          <depends on-sel="CRLs"/>
          <consistency-rationale>This SFR applies to ability of the TOE to manage its own CRL, which is not defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to include specific information in
            any certificate revocation lists that it creates.</comp-lev>
          <management>The following actions could be considered for the management functions in FMT: <h:ul>
            <h:li>Ability to modify the CRL configuration.</h:li>
          </h:ul>
          </management>
          <audit>The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST:<h:ul>
            <h:li>Failure to generate CRL.</h:li>
            </h:ul>
          </audit>
          <dependencies>
            FCS_COP.1 Cryptographic Operation<h:p/>
            FDP_CSI_EXT.1 Certificate Status Information
          </dependencies>
          <f-element id="fdp-crl-ext-1e1">
            <title>
              When the TSF is configured to generate CRLs, the TSF shall verify that all
              mandatory fields in any generated CRL contains values in accordance with ITU-T
              Recommendation X.509. At a minimum, the following items shall be validated: <h:ol type="a">
              <h:li>If the version field is present, then it shall contain a 1.</h:li>
              <h:li>If the CRL contains any critical extensions, then the version field shall be
              present and contain the integer 1.</h:li>
              <h:li>The <selectables>
                <selectable>issuer</selectable>
                <selectable>issuerAltName</selectable>
              </selectables> fields shall indicate the configured
              name of the CA.</h:li>
              <h:li>If the issuer field contains a null Name (e.g., a sequence of zero relative
              distinguished names), then the CRL shall contain a critical issuerAltName
              extension.</h:li>
              <h:li>The signature and signatureAlgorithm fields shall contain the OID for a
              digital signature algorithm in accordance with FCS_COP.1<h:b>/SigGen in the
              NDcPP</h:b>.</h:li>
              <h:li>The thisUpdate field shall indicate the issue date of the CRL.</h:li>
              <h:li>The time specified in the nextUpdate field (if populated) shall not precede
              the time specified in the thisUpdate field.</h:li>
              </h:ol>
            </title>
            <ext-comp-def-title>
              <title>
                When the TSF is configured to generate CRLs, the TSF shall verify that all
                mandatory fields in any generated CRL contains values in accordance with ITU-T
                Recommendation X.509. At a minimum, the following items shall be validated: <h:ol type="a">
                  <h:li>If the version field is present, then it shall contain a 1.</h:li>
                  <h:li>If the CRL contains any critical extensions, then the version field shall be
                    present and contain the integer 1.</h:li>
                  <h:li>The <selectables>
                    <selectable>issuer</selectable>
                    <selectable>issuerAltName</selectable>
                  </selectables> fields shall indicate the configured
                    name of the CA.</h:li>
                  <h:li>If the issuer field contains a null Name (e.g., a sequence of zero relative
                    distinguished names), then the CRL shall contain a critical issuerAltName
                    extension.</h:li>
                  <h:li>The signature and signatureAlgorithm fields shall contain the OID for a
                    digital signature algorithm in accordance with FCS_COP.1.</h:li>
                  <h:li>The thisUpdate field shall indicate the issue date of the CRL.</h:li>
                  <h:li>The time specified in the nextUpdate field (if populated) shall not precede
                    the time specified in the thisUpdate field.</h:li>
                </h:ol>
              </title>
            </ext-comp-def-title>
            <note role="application">This requirement should be claimed if ‘ITU-T Recommendation X.509v2 CRL’ is
              selected in FDP_CSI_EXT.1.1</note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it indicates whether the TOE supports CRL generation and,
                if so, describes the CRL generation function. In addition, the evaluator shall ensure that the TSS identifies
                which of the values identified in FDP_CRL_EXT.1.1 can be included in CRLs.<h:p/></TSS>
              <Guidance>If the TOE supports configuration of the CRL issuing function, the evaluator shall examine the operational
                guidance to ensure that instructions are available to configure issuance of CRL in accordance with
                FDP_CRL_EXT.1.1.
              <h:p/></Guidance>
              <Tests>The evaluator shall perform the following tests:
              <testlist>
                <test>The evaluator shall configure the CRL function using available user guidance and request a CRL in
                  order to ensure that the resulting CRL satisfies all field constraints in FDP_CRL_EXT.1.1.
                </test>
                <test>For each field defined in FDP_CRL_EXT.1.1, the evaluator shall attempt to create a CRL that violates
                  the required conditions of the field. The evaluator shall determine that all such attempts are rejected by
                  the TSF.</test>
                <test>The evaluator shall make a selection of fields from a configured CRL function and shall attempt to
                  create a CRL that violates the required conditions of the field. The evaluator shall determine that all such
                  attempts are rejected by the TSF.
                </test>
              </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Failure to generate CRL</audit-event-descr>
            <audit-event-info>N/A</audit-event-info>
          </audit-event>
        </f-component>
        
        <ext-comp-def fam-id="FDP_CSI_EXT" title="Certificate Status Information">
          <fam-behavior>Components in this family define requirements for the TOE’s ability to generate certificate status
            information and to modify the status of issued certificates.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="Certificate Status Information" cc-id="fdp_csi_ext.1" id="fdp-csi-ext-1">
          <depends on-sel="genStatus"/>
          <consistency-rationale>
            This SFR applies to ability of the TOE to generate status information for its own issued certificates, which is not defined in the Base-PP.
            </consistency-rationale>
          <comp-lev> requires the TSF to generate certificate status information
            using a supported method and to define conditions in which this information can be modified.</comp-lev>
          <management><h:ul>
            The following actions could be considered for the management functions in FMT:
            <h:li>Ability to revoke issued certificates.</h:li>
            <h:li>Ability to configure certificate status services.</h:li>
            <h:li>Ability to configure automated process used to approve the revocation of a certificate or
            information about the revocation of a certificate.</h:li>
            <h:li>Ability to clear a cache of valid issued certificates.</h:li>
          </h:ul>
          </management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>
            [FDP_CRL_EXT.1 Certificate Revocation List Generation OR<h:p/>
            FDP_OCSP_EXT.1 OCSP Basic Response Generation]<h:p/>
            FDP_OCSPS_EXT.1 OCSP Stapling<h:p/>
            FMT_SMR.1 Security Roles
          </dependencies>
          <f-element id="fdp-csi-ext-1e1">
            <title>The TSF shall generate certificate status information whose format complies with
              <selectables>
                <!-- Is X.509v2 correct or should it be v3? -->
                <selectable id="CRLs">ITU-T Recommendation X.509v2 CRL</selectable>
                <selectable id="OCSP">the OCSP standard as defined by RFC 6960</selectable>
              </selectables>.</title>
          </f-element>
          <f-element id="fdp-csi-ext-1e2">
            <title>
              The TSF shall support changes to the status of a certificate by 
              <selectables>
                <selectable>
                <selectables>
                  <selectable>Security Administrator</selectable>
                  <selectable>CA Operations Staff</selectable></selectables></selectable>
                <selectable><assignable>automated revocation rules</assignable></selectable>
              </selectables>. 
            </title>
            <ext-comp-def-title>
              <title>
                The TSF shall support changes to the status of a certificate by 
                <selectables>
                  <selectable>
                    <assignable>authorized role(s)</assignable>
                  </selectable>
                  <selectable><assignable>automated revocation rules</assignable></selectable>
                </selectables>. 
              </title>
            </ext-comp-def-title>
          </f-element>
          <f-element id="fdp-csi-ext-1e3">
            <title>
              The TSF shall <selectables>
                <selectable>provide</selectable>
                <selectable>interface with the Operational Environment to provide</selectable>
              </selectables> certificate status information generated in accordance with
              FDP_CSI_EXT.1.1 via <selectables>
                <selectable>posting CRLs at the location specified in the cRLDistributionPoints of the issued certificate</selectable>
                <selectable>an OCSP mechanism indicated in the authorityInfoAccess extension of the issued certificate</selectable>
                <selectable id="stapling">OCSP Stapling in accordance with FDP_OCSPS_EXT.1</selectable>
              </selectables>.
            </title>
            <note role="application">
              This SFR should be claimed if claimed if the selection ‘generate certificate status
              information’ is selected in FDP_CSIR_EXT.1.1.
              <h:p/>
              <!-- Note: references to non-existent 'sub-item (g)' have been corrected -->
              The ST should specify the format(s) used to supply certificate status information
              in FDP_CSI_EXT.1.1, and the mechanism(s) used to provide the status to relying
              parties including all monitored clients in the second selection in FDP_CSI_EXT.1.3.
              If CRLs are identified in FDP_CSI_EXT.1.1, then cRLDistributionPoints must be
              claimed in FDP_CSI_EXT.1.3 and in FDP_CER_EXT.1.2 item (g), sub-item (e). If the
              OCSP standard is selected in FDP_CSI_EXT.1.1, then at least one of the last two
              options in the second selection of FDP_CSI_EXT.1.3 must be claimed. If the second
              option (OCSP) is claimed, authorityInfoAccess must be claimed in
              FDP_CER_EXT.1.2 item (g), sub-item (e). OCSP stapling may also be claimed if the
              TOE only generates CRLs, but interfaces with an external OCSP responder that
              uses those CRLs.
              <h:p/>
              Automated rules for revoking certificates in response to the TOE’s discovery that
              a previously issued certificate is no longer appropriate for the subject, or due to
              cache clearing, timeouts, or other rules should be described in the assignment of
              FDP_CSI_EXT.1.2.
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it describes the certificate status function and applicable
                formats, in accordance with this requirement, that can be used to issue certificate status. The TSS must
                reflect the selection made by the ST author as well as the selection-based requirements from Appendix
                B.1 of the STIP PP-Module. The evaluator shall also ensure that the TSS describes the process for approving
                changes to the status of a certificate, including the interfaces that must be used.
                <h:p/>
                If OCSP stapling is selected in FDP_CSI_EXT.1.3, but only CRLs are generated (OCSP responses are not
                generated by the TSF) as indicated in FDP_CSI_EXT.1.1, the evaluator shall examine the operational
                guidance to ensure it describes the interfaces to the operational environment required to generate the
                responses.<h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure that it contains instructions for any
                configuration aspects of the certificate status change function and the steps needed to perform an
                approval, as well as any configuration required for interfaces to external certificate status providers.<h:p/></Guidance>
              <Tests>Based on the selections, the evaluator shall perform the following tests. It is recommended that these be
                performed in conjunction with applicable tests associated with the requirements claimed in Appendix B.1
                of the STIP PP-Module:<h:p/>
                <testlist>
                  <test id="unrevoked-cert">For each certificate status format identified in FCS_CSI_EXT.1.1, the evaluator shall issue a valid
                    certificate from the TOE. The evaluator shall then cause the TOE to issue certificate status information.
                    The evaluator shall check the certificate status information using all indicated methods identified in
                    FCS_CSI_EXT.1.3 to verify that each reflects that the certificate is valid.</test>
                  <test id="revoked-cert">For each selected certificate status format (CRLv2 or OCSP) identified in FCS_CSI_EXT.1.1, and for
                    each mechanism indicated in FDP_CSI_EXT.1.2, the evaluator shall cause a valid certificate from the TOE
                    to be revoked. The evaluator shall then cause the TOE to issue certificate status information. The evaluator
                    shall check the certificate status information using all methods (cRLDistributionPoints,
                    authorityInfoAccess, or OCSP Stapling) identified in FCS_CSI_EXT.1.3 to verify that each method reflects
                    that the certificate is revoked.
                  </test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
        <audit-event/>
        </f-component>
        
        <ext-comp-def fam-id="FDP_OCSP_EXT" title="Online Certificate Status Protocol">
          <fam-behavior>Components in this family define requirements for the usage of the Online Certificate Status Protocol
            (OCSP) as a method of recording certificate status information.
          </fam-behavior>
        </ext-comp-def>
        
        
        <f-component name="OCSP Basic Response Generation" cc-id="fdp_ocsp_ext.1" id="fdp-ocsp-ext-1">
          <depends on-sel="OCSP"/>
          <consistency-rationale>
            This SFR applies to ability of the TOE to manage its own OCSP responder, which is not defined in the Base-PP.
          </consistency-rationale>
          <comp-lev> requires the TSF to include specific information in
            any OCSP response that it creates.</comp-lev>
          <management>
            The following actions could be considered for the management functions in FMT:<h:ul>
              <h:li>Ability to modify the OCSP configuration.</h:li>
            </h:ul>
          </management>
          <audit>
            The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST: <h:ul>
              <h:li>Failure to generate certificate status information</h:li>
            </h:ul>
          </audit>
          <dependencies>
            FCS_COP.1 Cryptographic Support<h:p/>
            FDP_CSI_EXT.1 Certificate Status Information
          </dependencies>
          <f-element id="fdp-ocsp-ext-1e1">
            <title>
              When the TSF is configured to generate OCSP responses of the basic response
              type, the TSF shall ensure that all mandatory fields in the OCSP basic response
              contain values in accordance with RFC 6960. At a minimum, the following items
              shall be validated: <h:ol type="a">
                <h:li>The version field shall contain a 0.</h:li>
                <h:li>The signatureAlgorithm field shall contain the object identifier (OID) for
                a digital signature algorithm in accordance with FCS_COP.1<h:b>/SigGen in the
                NDcPP</h:b>.</h:li>
                <h:li>The thisUpdate field shall indicate the time at which the status being
                indicated is known to be correct.</h:li>
                <h:li>The producedAt field shall indicate the time at which the OCSP responder
                signed the response.</h:li>
                <h:li>The time specified in the nextUpdate field (if populated) shall not precede
                the time specified in the thisUpdate field.</h:li>
              </h:ol>
            </title>
            <ext-comp-def-title>
              <title>
                When the TSF is configured to generate OCSP responses of the basic response
                type, the TSF shall ensure that all mandatory fields in the OCSP basic response
                contain values in accordance with RFC 6960. At a minimum, the following items
                shall be validated: <h:ol type="a">
                  <h:li>The version field shall contain a 0.</h:li>
                  <h:li>The signatureAlgorithm field shall contain the object identifier (OID) for
                    a digital signature algorithm in accordance with FCS_COP.1.</h:li>
                  <h:li>The thisUpdate field shall indicate the time at which the status being
                    indicated is known to be correct.</h:li>
                  <h:li>The producedAt field shall indicate the time at which the OCSP responder
                    signed the response.</h:li>
                  <h:li>The time specified in the nextUpdate field (if populated) shall not precede
                    the time specified in the thisUpdate field.</h:li>
                </h:ol>
              </title>
            </ext-comp-def-title>
            <note role="application">This requirement should be claimed if ‘the OCSP standard as defined by RFC 6960’
              is selected in FDP_CSI_EXT.1.1.</note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it indicates whether the TOE supports OCSP and, if so,
                describes the OCSP response function. In addition, the evaluator shall ensure that the TSS identifies which
                of the values identified in FDP_OCSP_EXT.1.1 can be included in OCSP responses.<h:p/></TSS>
              <Guidance>If the TOE supports configuration of the OCSP function, the evaluator shall examine the operational
                guidance to ensure that instructions are available to configure the OCSP response function in accordance
                with FDP_OCSP_EXT.1.1.<h:p/></Guidance>
              <Tests>The evaluator shall perform the following tests:<h:p/>
                <testlist>
                  <test>The evaluator shall configure the OCSP response function, establish a monitored client and shall,
                    in turn, cause an OCSP response by the TSF for the status of a certificate issued by the TOE’s embedded
                    CA which has not been revoked, a certificate issued by the TOE’s embedded CA which has been revoked,
                    and a certificate not issued by the TOE’s embedded CA. The evaluator shall ensure that the response
                    satisfies all constraints in FDP_OCSP_EXT.1.1 and provides an accurate status indication in accordance
                    with RFC 6960.
                  </test>
                  <test>For each of the constraints in FDP_OCSP_EXT.1.1, the evaluator shall attempt to create an OCSP
                    response that violates the constraints. The evaluator shall determine that all such attempts are rejected
                    by the TSF.
                  </test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Failure to generate certificate status information</audit-event-descr>
            <audit-event-info>N/A</audit-event-info>
          </audit-event>
        </f-component>
        
        <ext-comp-def fam-id="FDP_OCSPS_EXT" title="Online Certificate Status Protocol Stapling">
          <fam-behavior>Components in this family define requirements for the usage of OCSP stapling as a method of
            communicating certificate revocation status information.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="OCSP Stapling" cc-id="fdp_ocsps_ext.1" id="fdp-ocsps-ext-1">
          <depends on-sel="stapling"/>
          <consistency-rationale>
            This SFR applies to ability of the TOE to implement OCSP stapling for its own issued certificates, which is not defined in the Base-PP.
            This SFR applies to OCSP stapling which is not defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to perform OCSP Stapling by including OCSP response
            information in a TLS Certificate Status Message.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST:<h:ul>
              <h:li>Failure to include certificate status information in TLS handshake message.</h:li>
            </h:ul>
          </audit>
          <dependencies>FDP_OCSP_EXT.1 OCSP Basic Response Generation</dependencies>
          <f-element id="fcs-ocsps-ext-1e1">
            <title>
              The TSF shall be able to process
              <!-- Note: more generalized version of previous not about CRL RFCs - are any of the RFCs cited in 1.0 out of date and in need of replacement -->
              <selectables>
                <selectable>Certificate Status Request extension in
                  accordance with RFC 6066 section 8</selectable>
                <selectable>Certificate Status Request List V2 in
                  accordance with RFC 6961</selectable>
              </selectables>.
            </title>
          </f-element>
          <f-element id="fcs-ocsps-ext-1e2">
            <title>The TSF shall <selectables>
              <selectable>generate OCSP response information in accordance with
                FDP_OCSP_EXT.1</selectable>
              <selectable>interface with an OCSP provider to obtain an OCSP response</selectable>
            </selectables> and populate a Certificate Status Message in accordance with RFC 6066.</title>
            <note role="application">This SFR must be claimed in situations where the TOE computes OCSP responses
              for inclusion in TLS certificate status messages. It may also be claimed if the TOE
              includes a separate certificate status component (CRL or OCSP provider) and
              provides an interface to an internal or external OCSP responder that processes
              certificate status information provided to it by the TOE. When claimed, certificate
              status is provided via OCSP stapling contained within TLS Server certificate status
              message(s).</note>
            <aactivity>
              <no-tests>For any selection, evaluation activities are included in the TSS, guidance portions, and Tests <xref to="unrevoked-cert"/> and <xref to="revoked-cert"/> within
                the Test portion of the evaluation activities in FDP_CSI_EXT.1. Additional activities if the first option of
                FDP_OCSPS_EXT.1.2 is claimed are covered under the evaluation activities for FDP_OCSP_EXT.1.</no-tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Failure to include certificate status information in TLS handshake message</audit-event-descr>
            <audit-event-info>N/A</audit-event-info>
          </audit-event>
        </f-component>
        
      </section>
      
      <section title="Certificate Enrollment" id="s-b2">
        
        <ext-comp-def fam-id="FIA_ESTC_EXT" title="Enrollment over Secure Transport Client Protocol">
          <fam-behavior>Components in this family define requirements for the TOE’s use of Enrollment over Secure Transport
            (EST) to obtain certificates from an external CA.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="Enrollment over Secure Transport (EST) Client" cc-id="fia_estc_ext.1" id="fia-estc-ext-1">
          <depends on-sel="EST"/>
          <consistency-rationale>This SFR applies to the implementation of EST, which is a method of acquiring certificates that is not defined in the Base-PP.</consistency-rationale>
          <comp-lev> defines the ability of the TSF to perform
            Enrollment over Secure Transport (EST) as a client connecting to an external CA.</comp-lev>
          <management>The following actions could be considered for the management functions in FMT:<h:ul>
            <h:li>Ability to generate and export EST messages.</h:li>
            <h:li>Ability to accept and process EST responses.</h:li>
          </h:ul>
          </management>
          <audit>
            The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST:<h:ul>
              <h:li>EST requests.</h:li>
            </h:ul>
          </audit>
          <dependencies>
            FCS_COP.1 Cryptographic Operation<h:p/>
            FCS_TLSC_EXT.1 TLS Client Protocol without Mutual Authentication<h:p/>
            FCS_TLSC_EXT.2 TLS Client Support for Mutual Authentication<h:p/>
            FIA_ENR_EXT.1 Certificate Enrollment<h:p/>
            FIA_X509_EXT.1 X.509 Certificate Validation<h:p/>
            FMT_SMR.1 Security Roles
          </dependencies>
          <f-element id="fia-estc-ext-1e1">
            <title>
              The TSF shall use the Enrollment over Secure Transport (EST) as specified in RFC
              7030 as updated by RFC 8996 to obtain its embedded CA certificate and <assignable>other certificates for
              the TOE</assignable> from an external certification authority (external CA) associated with an
              authorized EST server.
            </title>
          </f-element>
          <f-element id="fia-estc-ext-1e2">
            <title>
              The TSF shall be able to obtain EST server and CA certificates for authorized EST
              services via <selectables>
                <selectable>implicit Trust Anchor/Trust Store (TA) configured by <h:b>
                  <selectables>
                    <selectable>Security Administrator</selectable>
                    <selectable>CA Operations Staff</selectable></selectables></h:b></selectable>
                <selectable>an explicit TA populated
                  via a TLS-authenticated EST CA certificate request in accordance with RFC 7030
                  section 4.1.2 and FCS_TLSC_EXT.1</selectable>
              </selectables>.
            </title>
            <ext-comp-def-title>
              <title>
                The TSF shall be able to obtain EST server and CA certificates for authorized EST
                services via <selectables>
                  <selectable>implicit Trust Anchor/Trust Store (TA) configured by 
                    <assignable>authorzed role(s)</assignable></selectable>
                  <selectable>an explicit TA populated
                    via a TLS-authenticated EST CA certificate request in accordance with RFC 7030
                    section 4.1.2 and FCS_TLSC_EXT.1</selectable>
                </selectables>.
              </title>  
            </ext-comp-def-title>
          </f-element>
          <f-element id="fia-estc-ext-1e3">
            <title>
              The TSF shall authenticate EST servers using X.509 certificates that chain to trust
              store elements from the <selectables>
                <selectable>implicit Trust Anchor database</selectable>
                <selectable>explicit Trust Anchor/Trust Store</selectable>
              </selectables> in accordance with FIA_X509_EXT.1<h:b>/Rev</h:b> for all EST requests.
            </title>
            <ext-comp-def-title>
              <title>
                The TSF shall authenticate EST servers using X.509 certificates that chain to trust
                store elements from the <selectables>
                  <selectable>implicit Trust Anchor database</selectable>
                  <selectable>explicit Trust Anchor/Trust Store</selectable>
                </selectables> in accordance with FIA_X509_EXT.1 for all EST requests.
              </title>
            </ext-comp-def-title>
          </f-element>
          <f-element id="fia-estc-ext-1e4">
            <title>
              The TSF shall authenticate its certificate enrollment requests to receive the
              signing certificate of its embedded CA and <assignable>other certificates
              required to authenticate the TOE</assignable>, from an authorized EST server using
              <selectables linebreak="yes">
              <selectable>HTTP basic authentication transported over TLS in accordance with RFC
              7030 section 3.2.3 and FCS_TLSC_EXT.1</selectable>
              <selectable>HTTP digest authentication using a cryptographic hash algorithm in
              accordance with FCS_COP.1<h:b>/Hash</h:b>, transported over TLS in accordance
              with RFC 7030 section 3.2.3 and FCS_TLSC_EXT.1</selectable>
              <selectable>Certificate-based authentication in accordance with RFC 7030 section
              3.3.2 and FCS_TLSC_EXT.2 using <assignable>a pre-existing certificate
              authorized by the EST server</assignable></selectable>
              </selectables>.
            </title>
          </f-element>
          <f-element id="fia-estc-ext-1e5">
            <title>
              The TSF shall generate authenticated re-enrollment requests in accordance with
              RFC 7030 Section 3.3.2 and FCS_TLSC_EXT.1, using an existing valid
              certificate with the same subject name as the requested certificate and which
              was issued by the external CA. 
            </title>
            <note role="application">This SFR should be claimed if ‘Enrollment over Secure Transport…’ is claimed in
              FIA_ENR_EXT.1.1.</note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it describes the implementation of this protocol, the
                certificates obtained, and any pre-existing certificates or trust anchor databases used by the protocol.
              <h:p/></TSS>
              <Guidance>
                The evaluator shall examine the operational guidance to ensure it contains instructions on configuring the
                TOE so that EST conforms to the description in the TSS.
                <h:p/>
                The evaluator shall examine the operational guidance to ensure it contains instructions for obtaining or
                configuring the TA database (implicit or explicit) and initial certificates.
              <h:p/></Guidance>
              <Tests>The evaluator shall perform the following tests:<h:p/>
              <testlist>
                <test id="authorized-est">The evaluator shall establish an external CA and EST server, and configure the TOE as indicated in
                  the operational guidance to authorize the EST server for EST services using the external CA. The evaluator shall examine
                  the TOE logs and TA databases using available interfaces to ensure the EST server and external CA’s
                  certificates are authorized for EST services.
                </test>
                <test>For each authentication method specified in FIA_ESTC_EXT.1.4, the evaluator shall generate one
                  or more certificate enrollment requests using the authentication method to obtain TOE required
                  certificates from the authorized CA via the EST server established in <xref to="authorized-est"/>. In accordance with guidance
                  documentation, the evaluator shall obtain a sufficient number of certificates in aggregate to allow the
                  TOE to issue certificates to requested servers. </test>
                <test id="give-est-to-client">The evaluator shall establish a server with a valid certificate and a monitored client. The evaluator
                  shall configure the TOE so that a TLS session between the monitored client and established through the
                  TOE results in the inspection operation being implemented. The evaluators shall establish a TLS session
                  between the monitored client and the established server through the TOE and observe that the certificate
                  chain returned to the client contains a server certificate issued by the embedded CA’s certificate, and the
                  embedded CA’s certificate issued by the external CA. </test>
                <test>The evaluator shall generate a re-enrollment request and submit it to the authorized EST server in
                  accordance with FIA_ESTC_EXT.1 to update the TOE’s embedded CA’s signing certificate. The evaluator
                  shall clear any cache, revoke the original CA certificate, and repeat <xref to="give-est-to-client"/>, observing that the updated
                  certificate for the embedded CA is included in the certificate chain returned to the monitored client.
                </test>
                <test>The evaluator shall establish a second EST server configured to authorize the TOE’s EST client but
                  which is not authorized by the client to provide EST services. The evaluator shall generate an enrollment
                  request for the TOE’s embedded CA signing certificate, and submit it to the second EST server. The
                  evaluator shall clear any cache and repeat <xref to="give-est-to-client"/>, observing that the certificate returned by the second
                  EST server is not contained in the certificate chain returned to the monitored client.</test>
              </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>EST requests</audit-event-descr>
            <audit-event-info>N/A</audit-event-info>
          </audit-event>
        </f-component>
        
      </section>
      
      <section title="Inspection Policy Banner" id="s-b3">
        Local policy may require explicit consent to monitoring before inspection of TLS encrypted data. If the
        STIP may be deployed in an environment where clients might not already have granted this approval, the
        TOE might be required to obtain this consent. The requirement in this section should be claimed if the TLS
        session establishment policy requires it.
        
        <f-component name="TOE Access Banner (Consent to Monitor Banner for TLS Inspection" cc-id="fta_tab.1" iteration="TLS" id="fta-tab-1">
          <depends on-sel="banner"/>
          <consistency-rationale>This SFR applies to having a notice and consent warning message at the start
            of an SSL/TLS inspection session which is not defined in the Base-PP. </consistency-rationale>
          <f-element id="fta-tab-1e1-tls">
            <title>
              Before forwarding decrypted application data intended for the requested server
              to inspection processing components the TSF shall display <h:b>to the monitored
              client a Security Administrator-specified</h:b> advisory <h:b>notice and consent</h:b> warning
              message regarding use of the TOE.
            </title>
            <note role="application">
              This SFR should be claimed if ‘provide a consent to monitor banner..’ is selected in
              FDP_STIP_EXT.1.3. 
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it details when advisory notice and consent warning
                messages are used in association with TLS inspection and the circumstances for requiring user consent.
              <h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure it contains instructions on configuring the
                TOE to display consent banners for TLS inspection traffic.
              <h:p/></Guidance>
              <Tests>The evaluator follows the guidance documentation to configure a notice and consent warning
                message for TLS inspection traffic, and configure rules for displaying the message to monitored clients
                when requesting TLS sessions to specific servers. The evaluator shall establish a client and server subject
                to the configured rules, and establish a TLS session through the TOE to the server. The evaluator shall
                verify that the notice and consent message is displayed.</Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
      </section>
      
      <section title="Authentication of Monitored Clients" id="s-b4">
        This section describes support for mutual authentication of clients when requested by the TOE to support
        the following use cases: <h:ul>
        <h:li>TOE requested mutual authentication: Mutual authentication provides authenticated client
        attributes that can be used to define exception processing. If the ST claims to support client
        authentication of monitored clients accessing the TOE, this SFR should be claimed in the
        selection of FDP_STIP_EXT.1.</h:li>
        <h:li>Certificate request from the requested server: Inspection of TLS sessions requiring mutual
        authentication is a narrow use case for the SSL/TLS inspection proxy, where both the client
        and server trust the TOE’s embedded CA. In such instances, mutual authentication represents
        an assertion to the requested server that the client has been authenticated. There are other,
        preferred mechanisms such as SOAP, KERBEROS, XAML assertions, than TLS client
        authentication using proxy certificates that provide a more accurate representation of the
        role of a federated identity service provider, in accordance with NIST SP 800-63-03. Also,
        mutual authentication is typically used to control access to sensitive information authorized
        only to specific clients, and the willingness of the server’s content owner to trust the proxy,
        providing access such sensitive content further restricts legitimate use cases. Finally,
        certificates issued to represent users subject to a certificate policy or certificate practice
        statement, especially those compliant with NIST FIPS 201, may be required to meet an
        equivalent certificate policy or certificate practice statement.</h:li>
        </h:ul>
        If mutual authentication by the TOE is to perform the TLS inspection operation on TLS sessions between
        monitored clients and requested servers requiring mutual authentication, FCS_TTTC_EXT.3,
        FCS_TTTS_EXT.3, FDP_CER_EXT.4, FDP_CER_EXT.5, FDP_CSI_EXT.2, and FDP_STIP_EXT.2 in this section
        must be claimed. In addition, the ‘mutual authentication inspection’ item should be selected in the
        selection for FDP_TEP_EXT.1.5 and an exception specification to identify servers which are authorized and
        configured to support mutual authentication inspection must be described in the assignment of
        FDP_TEP_EXT.1.4. TLS servers requesting mutual authentication are likely to also require revocation
        information, so it is recommended that FDP_CSIR_EXT.1 selections be made to provide certificate status
        information, even if the constraint for short validity periods is achieved
      
        <f-component name="Thru-Traffic TLS Inspection Client Protocol with Mutual Authentication Representing Monitored Clients" cc-id="fcs_tttc_ext.3" id="fcs-tttc-ext-3">
          <depends on-sel="clientAuth"/>
          <consistency-rationale>This SFR applies to thru-traffic TLS Inspection Client Protocol with mutual
            authentication which is not defined in the Base-PP.</consistency-rationale>
          <comp-lev/>
          <management>No specific management functions are identified.</management>
          <audit>The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST: <h:ul>
              <h:li>Successful and unsuccessful authorization of mutual authentication.</h:li>
            </h:ul>
          </audit>
          <dependencies>
            FCS_TTTC_EXT.1 Thru-Traffic TLS Inspection Client Protocol<h:p/>
            FDP_CER_EXT.5 Certificate Issuance Rules for Client Certificates
          </dependencies>
          <f-element id="fcs-tttc-ext-3e1">
            <title>
              The TSF shall support mutual authentication using X.509v3 certificates generated
              in accordance with FDP_CER_EXT.5 for inspection processing operation between
              a monitored client represented in the generated certificate and a requested
              server that provides a certificate request in the TLS handshake.
            </title>
            <note role="application">
              This SFR must be claimed if the TSF is capable of inspecting TLS sessions from
              monitored clients to requested servers requiring client authentication. 
            </note>
            <aactivity>
              <TSS>The evaluator shall ensure that the TSS description of the TLS protocol for TLS session establishment
                includes the use of client-side certificates for TLS mutual authentication to servers when allowed by the
                configured TLS session establishment policy, described in FDP_TEP_EXT.1.
              <h:p/></TSS>
              <Guidance>The evaluator shall check the guidance documentation to ensure it contains instructions on configuring
                the TOE so that the TSF supports inspection of TLS sessions with client authentication. The evaluator shall
                verify that the operational guidance provides instructions on how to configure the TLS session establishment
                policy to identify requested servers it may support for mutual authentication inspection.<h:p/></Guidance>
              <Tests><h:b>Setup:</h:b> The evaluator shall establish one or more monitored clients and one or more requested servers
                that are configured to pass TLS sessions through the TOE and configure the TLS session establishment
                policy to use the inspection operation for those clients and servers with a supported version and cipher
                suite. The evaluator shall establish certificates for the servers that are valid in accordance with
                FIA_X509_EXT.1/STIP and appropriate for the selected cipher suite. For each signature type supported for
                mutual authentication, the evaluator shall issue a certificate for a monitored client that is valid in
                accordance with FIA_X509.EXT.1/STIP. The evaluator shall install the appropriate trust anchors within the
                TSF to validate the client and server certificates. Additional configuration of the requested servers,
                monitored clients, and TSF are specified in the tests below.<h:p/>
              <testlist>
                <test>The evaluator shall configure the TOE’s TLS session establishment policy to allow client
                  authentication to the servers used in this test. For each certificate established for a monitored client, the
                  evaluator shall initiate a TLS session between the monitored client and a requested server configured to
                  require client authentication via a certificate of the indicated type. The evaluator shall then verify that the
                  TLS session between the proxy and the requested server includes a client certificate message containing
                  a certificate issued by the TSF, and that the certificate verifies messages that authenticate the TSF as
                  controlling the private key associated to the certificate.
                </test>
                <test>The evaluator shall configure the TOE’s TLS session establishment policy to allow client
                  authentication to the servers used in this test. The evaluator shall configure a requested server to send a
                  certificate request message to clients with a CA field that does not contain the embedded CA of the TOE.
                  The evaluator shall initiate a TLS session from a monitored client using one of the issued certificates for
                  client authentication to the so configured server through the TSF and observe that the TSF does not
                  establish a TLS session with the requested server.</test>
                <test>The evaluator shall configure the TOE’s TLS session establishment policy to allow client
                  authentication to the servers used in this test. The evaluator shall configure a requested server not to
                  send a certificate request message to clients. The evaluator shall initiate a TLS session from a monitored
                  client using one of the issued certificates for client authentication to the so configured server through the
                  TSF and observe that the TSF does not send a client certificate message or certificate verify message to
                  within its handshake with requested server.</test>
                <test>The evaluator shall configure the TOE’s TLS session establishment policy to not allow client
                  authentication to the servers used in this test, and if the TSF supports a block-bypass allowance, to block
                  mutual authentication requests to the server. The evaluator shall configure a requested server to send a
                  certificate request message to clients. The evaluator shall initiate a TLS session from a monitored client
                  using one of the issued certificates for client authentication to the so configured server through the TSF
                  and observe that the TSF does not send a client certificate message or certificate verify message to within
                  its handshake with requested server.</test>
                <test>(conditional, the TSF supports block-bypass specifications in the TLS session establishment policy):
                  The evaluator shall configure the TOE’s TLS session establishment policy to not allow client authentication
                  to the requested server used in this test, and to bypass mutual authentication requests to that server. The
                  evaluator shall configure the requested server to trust the CA used to issue a certificate issued to the
                  monitored client and to send a certificate request messages to clients. The evaluator shall initiate a TLS
                  session from the monitored client using the certificate issued by the CA and trusted by the requested
                  server for client authentication to the so configured server through the TSF. The evaluator shall then
                  observe that the TSF performs the bypass operations and sends a client certificate message containing
                  the certificate established for the monitored client and a certificate verify message that validates the
                  monitored client to the requested server.
                </test>
              </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Mutual authentication authorized</audit-event-descr>
            <audit-event-info><selectables>
              <selectable>client certificate value</selectable>
              <selectable>client certificate object identifier</selectable>
            </selectables></audit-event-info>
          </audit-event>
          <audit-event>
            <audit-event-descr>Mutual authentication not authorized</audit-event-descr>
            <audit-event-info>N/A</audit-event-info>
          </audit-event>
        </f-component>
        
        <f-component name="Thru-Traffic TLS Inspection Server Protocol with Mutual Authentication of Monitored Clients" cc-id="fcs_ttts_ext.3" id="fcs-ttts-ext-3">
          <depends on-sel="serverAuth"/>
          <consistency-rationale>This SFR applies to thru-traffic TLS Inspection Server Protocol with mutual
            authentication which is not defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to validate a TLS client certificate when receiving a connection from a monitored
            client as part of establishing a TLS proxy connection.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>
            The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST: <h:ul>
              <h:li>Mutual authentication required and valid client certificate received.</h:li>
              <h:li>Mutual authentication not used.</h:li>
            </h:ul>
          </audit>
          <dependencies>FCS_TTTS_EXT.1 Thru-Traffic TLS Inspection Server Protocol<h:p/>
            FDP_TEP_EXT.1 SSL/TLS Inspection Proxy Policy</dependencies>
          <f-element id="fcs-ttts-ext-3e1">
            <title>The TSF shall support mutual authentication of TLS clients using X.509v3
              certificates. </title>
          </f-element>
          <f-element id="fcs-ttts-ext-3e2">
            <title>The TSF shall send a Certificate Request message to the TLS client when mutual
              authentication is required by the configured TLS session establishment policy as
              defined in FDP_TEP_EXT.1.</title>
          </f-element>
          <f-element id="fcs-ttts-ext-3e3">
            <title>
              The TSF shall validate the certificate presented by the client and 
              <selectables>
                <selectable>allow the connection if the certificate is invalid and an exception is permitted for the client</selectable>
                <selectable>terminate the connection if the certificate is invalid</selectable>
              </selectables>.
            </title>
            <note role="application">
              Validity is determined by the identifier verification, certificate path, the expiration
              date, and the revocation status in accordance with RFC 5280. Certificate validity
              is tested in accordance with testing performed for FIA_X509_EXT.1/STIP
            </note>
          </f-element>
          <f-element id="fcs-ttts-ext-3e4">
            <title>
              The TSF shall not establish a TLS session if the distinguished name (DN) or Subject
              Alternative Name (SAN) contained in a certificate does not match the expected
              identifier for the client.
            </title>
            <note role="application">The client identifier may be in the Subject field or the Subject Alternative Name
              extension of the certificate.</note>
            <aactivity>
              <TSS>The evaluator shall ensure the TSS description of the TLS protocol for TLS session establishment includes
                the use of client authentication for monitored clients in accordance with the TLS session establishment
                policy described in FDP_TEP_EXT.1.<h:p/></TSS>
              <Guidance>The evaluator shall check the guidance documentation to ensure it contains instructions on configuring
                the TOE so that the TSF supports TLS with client authentication for monitored clients. The evaluator shall
                verify that the operational guidance provides instructions on how to specify the conditions for when the TSF
                requests client authentication of monitored clients.
              <h:p/></Guidance>
              <Tests>
                <h:b>Setup:</h:b> The evaluator shall establish one or more monitored clients and servers that are configured to pass
                TLS sessions through the TOE, and configure the TLS session establishment policy to require mutual
                authentication for these clients. The evaluator shall establish certificates for the servers that are valid in
                accordance with FIA_X509_EXT.1/STIP. Note: Depending on optional features supported by the TOE, it
                might also be necessary to configure the requested servers to require mutual authentication, and
                configure the TLS session establishment policy to allow mutual authentication to the requested servers to
                induce a client certificate request from the TSF.<h:p/>
                <testlist>
                  <test>For each certificate signature algorithm supported, the evaluator shall establish a monitored client
                    with a certificate signed by a trusted CA using the certificate algorithm, where the client properly supports
                    client authentication. For each such client, the evaluator shall initiate a TLS session to a requested server
                    through the TSF. In each case, the evaluator shall observe that valid TLS sessions between the monitored
                    client and the TSF is established and that during the TLS handshake the TSF sends a certificate request
                    message to each monitored client.</test>
                  <test>The evaluator shall initiate a TLS session between a monitored client and a requested server
                    through the TSF, where the client does not provide a certificate message. The evaluator shall observe that
                    a TLS session between the client and the TSF is not established, and that any TLS session between the TSF
                    and the requested server associated to that TLS session thread is terminated.</test>
                  <test>The evaluator shall initiate a TLS session between a monitored client and requested server through
                    the TSF, where the monitored client’s certificate is issued by a subordinate CA of a trusted root CA and
                    only the root CA is in the TSF trust store. In response to the certificate request, the evaluator shall replace
                    the last byte of the subordinate CA certificate in a valid certificate message from the client to the TSF and
                    send the modified certificate message, along with a valid Certificate Verify message and Finished message
                    to the TSF. The evaluator shall observe TSF logs to verify that the certificate is deemed invalid, that the
                    TSF does not establish a TLS session with the client, and that any TLS session between the TSF and the
                    requested server associated to that TLS session thread is terminated.</test>
                  <test>The evaluator shall configure the TSF trust store so the root certificate authority that issues the
                    certificate for a monitored client is not trusted. The evaluator shall then initiate a TLS session between a
                    monitored client and requested server using client authentication through the TSF and observe that the
                    TSF does not establish a TLS session with the client and that any TLS session between the TSF and the
                    requested server associated to that TLS session thread is terminated.
                  </test>
                  <test>The evaluator shall establish a monitored client whose otherwise valid certificate issued by a
                    trusted CA does not include the client authentication purpose in the extended key usage field. The
                    evaluator shall initiate a TLS session between the monitored client and a requested server through the
                    TSF. The evaluator shall observe that the TLS session between the monitored client and the TSF is not
                    established, and that any TLS session between the TSF and the requested server associated to that TLS
                    session thread is terminated.</test>
                  <test>(conditional, the TLS session establishment supports authenticated attributes of a client in exception specifications):
                    The evaluator shall configure a TLS establishment policy in the TSF to
                    perform mutual authentication for a client. The evaluator shall establish a monitored client subject to the 
                    exception specification but having a valid certificate issued by a trusted CA, where the subject identifier
                    and subject alternate name do not match the exception specification. The evaluator shall establish a TLS
                    session from the monitored client to a requested server through the TSF and observe that the TLS session
                    between the client and the TSF is not established and any TLS session between the TSF and the requested
                    server associated to that TLS session thread is terminated.
                  </test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Mutual authentication required and valid client certificate received</audit-event-descr>
            <audit-event-info>Client certificate</audit-event-info>
          </audit-event>
          <audit-event>
            <audit-event-descr>Mutual authentication not authorized</audit-event-descr>
            <audit-event-info>N/A</audit-event-info>
          </audit-event>
        </f-component>
        
        <!-- Note: come back to this one to make sure it looks ok -->
        <f-component name="Certificate Profiles for Client Certificates" cc-id="fdp_cer_ext.4" id="fdp-cer-ext-4">
          <depends on-sel="clientAuth"/>
          <consistency-rationale>This SFR applies to how the TOE issues TLS client certificates for STIP traffic, which is an interface that is not defined in the Base-PP.
            </consistency-rationale>
          <comp-lev> requires the TSF to implement a certificate
            profile function and to issue TLS client certificates that conform to profiles when acting as a CA.</comp-lev>
          <management>
            The following actions could be considered for the management functions in FMT:<h:ul>
              <h:li>Ability to configure identifying information for the TOE’s embedded CA.</h:li>
              <h:li>Ability to configure a maximum certificate validity duration.</h:li>
              <h:li>Ability to configure and manage certificate profiles.</h:li>
            </h:ul>
          </management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>
            FCS_COP.1 Cryptographic Operation<h:p/>
            FMT_SMR.1 Security Roles
          </dependencies>
          <f-element id="fdp-cer-ext-4e1">
            <title>The TSF shall implement a certificate profile function for TLS client certificates
              issued by a CA embedded within the TOE, and shall ensure that issued certificates
              are consistent with configured profiles.</title>
            <note role="application">
              The CA issuing client certificates may be required to support configured certificate
              profiles that differ significantly from server certificates, and to support multiple
              certificate profiles for the clients supported. 
            </note>
          </f-element>
          <f-element id="fdp-cer-ext-4e2">
            <title>
              The TSF shall generate certificates representing monitored clients using profiles that comply with requirements
              for certificates as specified in IETF RFC 5280, “Internet X.509 Public Key
              Infrastructure Certificate and Certificate Revocation List (CRL) Profile” as refined
              below. At a minimum, the TSF shall ensure that:
              <h:ol type="a">
                <h:li>The version field shall contain the integer 2.</h:li>
                <h:li>The issuerUniqueID or subjectUniqueID fields are not populated.</h:li>
                <h:li>The serialNumber shall be unique with respect to the issuing Certification
                  Authority.</h:li>
                <h:li>The validity field shall specify a notBefore value that does not precede
                  the current time and a notAfter value that does not precede the value
                  specified in notBefore.</h:li>
                <h:li>The issuer field is not empty and is populated with the <h:b>
                  <selectables>
                    <selectable>Security Administrator</selectable>
                    <selectable>CA Operations Staff</selectable>
                  </selectables></h:b>-configured CA name.</h:li>
                <h:li>The signature field and the algorithm in the subjectPublicKeyInfo field
                  shall contain the OID for a signature algorithm specified in
                  FCS_COP.1<h:b>/SigGen in the NDcPP</h:b>.</h:li>
                <h:li>The following extensions are supported:
                  <h:ol type="a">
                    <h:li>subjectKeyIdentifier</h:li>
                    <h:li>authorityKeyIdentifier</h:li>
                    <h:li>keyUsage</h:li>
                    <h:li>extendedKeyUsage</h:li>
                    <h:li>certificatePolicy</h:li>
                    <h:li><selectables>
                      <selectable>basicConstraints</selectable>
                      <selectable>cRLDistributionPoints</selectable>
                      <selectable>authorityInfoAccess</selectable>
                      <selectable>no other extensions</selectable>
                    </selectables></h:li></h:ol></h:li>
                <h:li>A subject field containing a null Name (e.g., a sequence of zero relative
                  distinguished names) is accompanied by a populated critical
                  subjectAltName extension.</h:li>
                <h:li>The subjectKeyIdentifier extension is populated with a value unique for each public key contained in a certificate issued by the TSF. </h:li>
                <h:li>The authorityKeyIdentifier extension in any certificate issued by the TOE
                  must be populated and must be the same as the subjectKeyIdentifier
                  extension contained in the TOE’s embedded CA’s signing certificate.</h:li>
                <h:li>Populated keyUsage and extendedKeyUsage fields in the same certificate
                  shall contain consistent values reflecting exclusive TLS server use as
                  follows:
                  <h:table>
                    <h:tr>
                      <h:th>keyUsage</h:th>
                      <h:th>extendedKeyUsage</h:th>
                    </h:tr>
                    <h:tr>
                      <h:td>digitalSignature</h:td>
                      <h:td>clientAuth</h:td>
                    </h:tr>
                    <h:tr>
                      <h:td>digitalSignature, keyEncipherment</h:td>
                      <h:td>clientAuth</h:td>
                    </h:tr>
                    <h:tr>
                      <h:td>digitalSignature,keyAgreement</h:td>
                      <h:td>clientAuth</h:td>
                    </h:tr>
                  </h:table>
                </h:li>
              </h:ol>
            </title>
            <ext-comp-def-title>
              <title>
                The TSF shall generate certificates representing monitored clients using profiles that comply with requirements
                for certificates as specified in IETF RFC 5280, “Internet X.509 Public Key
                Infrastructure Certificate and Certificate Revocation List (CRL) Profile” as refined
                below. At a minimum, the TSF shall ensure that:
                <h:ol type="a">
                  <h:li>The version field shall contain the integer 2.</h:li>
                  <h:li>The issuerUniqueID or subjectUniqueID fields are not populated.</h:li>
                  <h:li>The serialNumber shall be unique with respect to the issuing Certification
                    Authority.</h:li>
                  <h:li>The validity field shall specify a notBefore value that does not precede
                    the current time and a notAfter value that does not precede the value
                    specified in notBefore.</h:li>
                  <h:li>The issuer field is not empty and is populated with the <assignable>authorized role(s)</assignable>-configured CA name.</h:li>
                  <h:li>The signature field and the algorithm in the subjectPublicKeyInfo field
                    shall contain the OID for a signature algorithm specified in
                    FCS_COP.1.</h:li>
                  <h:li>The following extensions are supported:
                    <h:ol type="a">
                      <h:li>subjectKeyIdentifier</h:li>
                      <h:li>authorityKeyIdentifier</h:li>
                      <h:li>keyUsage</h:li>
                      <h:li>extendedKeyUsage</h:li>
                      <h:li>certificatePolicy</h:li>
                      <h:li><selectables>
                        <selectable>basicConstraints</selectable>
                        <selectable>cRLDistributionPoints</selectable>
                        <selectable>authorityInfoAccess</selectable>
                        <selectable>no other extensions</selectable>
                      </selectables></h:li></h:ol></h:li>
                  <h:li>A subject field containing a null Name (e.g., a sequence of zero relative
                    distinguished names) is accompanied by a populated critical
                    subjectAltName extension.</h:li>
                  <h:li>The subjectKeyIdentifier extension is populated with a value unique for each public key contained in a certificate issued by the TSF. </h:li>
                  <h:li>The authorityKeyIdentifier extension in any certificate issued by the TOE
                    must be populated and must be the same as the subjectKeyIdentifier
                    extension contained in the TOE’s embedded CA’s signing certificate.</h:li>
                  <h:li>Populated keyUsage and extendedKeyUsage fields in the same certificate
                    shall contain consistent values reflecting exclusive TLS server use as
                    follows:
                    <h:table>
                      <h:tr>
                        <h:th>keyUsage</h:th>
                        <h:th>extendedKeyUsage</h:th>
                      </h:tr>
                      <h:tr>
                        <h:td>digitalSignature</h:td>
                        <h:td>clientAuth</h:td>
                      </h:tr>
                      <h:tr>
                        <h:td>digitalSignature, keyEncipherment</h:td>
                        <h:td>clientAuth</h:td>
                      </h:tr>
                      <h:tr>
                        <h:td>digitalSignature,keyAgreement</h:td>
                        <h:td>clientAuth</h:td>
                      </h:tr>
                    </h:table>
                  </h:li>
                </h:ol>
              </title>
            </ext-comp-def-title>
            <note role="application">
              RFC updates to RFC 5280 are included in this requirement.
              <h:p/>
              The inclusion of the cRLDistributionPoints and authorityInfoAccess extensions
              depend on the selections made in FDP_CSIR_EXT.1 and FDP_CSI_EXT.2.3 if
              claimed.
              <h:p/>
              Uniqueness for the subject key identifier is specific to the instance of the
              embedded CA. The same configured CA should not issue certificates with different
              public keys having the same subject key identifier.
            </note>
          </f-element>
          <f-element id="fdp-cer-ext-4e3">
            <title>
              The TSF shall implement the following rules for populating certificate fields based
              on constraints imposed by the TOE’s embedded CA’s signing certificate: <h:ul>
                <h:li>The validity field shall specify a notAfter time that does not exceed the
                  notAfter time of the CA’s signing certificate.</h:li>
                <h:li>The issuer field identifies the <selectables>
                  <selectable>subject</selectable>
                  <selectable><h:b>
                    <selectables>
                      <selectable>Security Administrator</selectable>
                      <selectable>CA Operations Staff</selectable>
                    </selectables></h:b>-assigned identifying information</selectable>
                </selectables> of the CA's signing certificate.</h:li>
                <h:li><selectables linebreak="yes">
                  <selectable>The subject name is limited by name constraints specified in the CA’s
                    signing certificate</selectable>
                  <selectable><assignable>list of rules</assignable></selectable>
                  <selectable>no other rules</selectable>
                </selectables>.</h:li>
              </h:ul>
            </title>
            <ext-comp-def-title>
              <title>
                The TSF shall implement the following rules for populating certificate fields based
                on constraints imposed by the TOE’s embedded CA’s signing certificate: <h:ul>
                  <h:li>The validity field shall specify a notAfter time that does not exceed the
                    notAfter time of the CA’s signing certificate.</h:li>
                  <h:li>The issuer field identifies the <selectables>
                    <selectable>subject</selectable>
                    <selectable><assignable>authorized role(s)</assignable>-assigned identifying information
                    </selectable>
                  </selectables> of the CA's signing certificate.</h:li>
                  <h:li><selectables linebreak="yes">
                    <selectable>The subject name is limited by name constraints specified in the CA’s
                      signing certificate</selectable>
                    <selectable><assignable>list of rules</assignable></selectable>
                    <selectable>no other rules</selectable>
                  </selectables>.</h:li>
                </h:ul>
              </title>
            </ext-comp-def-title>
          </f-element>
          <f-element id="fdp-cer-ext-4e4">
            <title>
              The TSF shall implement the following rules for populating certificate fields based
              on the validated certificate and constraints imposed by the <h:b><selectables>
                <selectable>Security Administrator</selectable>
                <selectable>CA Operations Staff</selectable>
              </selectables></h:b>:
              <h:ol type="a">
                <h:li>The Subject/Subject Alternative Name shall be copied from validated
                  client certificate.</h:li>
                <h:li>The notBefore field shall not precede the notBefore field of the validated
                  client certificate.</h:li>
                <h:li>The notAfter field shall not exceed the notAfter field of the validated
                  client certificate.</h:li>
                <h:li>The notAfter field shall not exceed the current time by more than a
                  maximum validity duration value as configured by a <h:b>
                    <selectables>
                      <selectable>Security Administrator</selectable>
                      <selectable>CA Operations Staff</selectable>
                    </selectables>
                  </h:b> user.</h:li>
                <h:li>If the basicConstraints field is configured to be present, it shall be
                  populated with the value cA=False.</h:li>
                <h:li>If configured to be present, th epolicy OID and policy mapping fields shall be populated according to 
                  <selectables linebreak="yes">
                    <selectable>a <h:b><selectables>
                        <selectable>Security Administrator</selectable>
                        <selectable>CA Operations Staff</selectable>
                      </selectables></h:b> configured mapping from validated client certificate values to
                        one or more stated policy OIDs</selectable>
                    <selectable><assignable>list of rules</assignable></selectable>
                  </selectables>.
                </h:li>
              </h:ol>
            </title>
            <ext-comp-def-title>
              <title>
                The TSF shall implement the following rules for populating certificate fields based
                on the validated certificate and constraints imposed by the <assignable>authorized role(s)</assignable>:
                <h:ol type="a">
                  <h:li>The Subject/Subject Alternative Name shall be copied from validated
                    client certificate.</h:li>
                  <h:li>The notBefore field shall not precede the notBefore field of the validated
                    client certificate.</h:li>
                  <h:li>The notAfter field shall not exceed the notAfter field of the validated
                    client certificate.</h:li>
                  <h:li>The notAfter field shall not exceed the current time by more than a
                    maximum validity duration value as configured by a <assignable>authorized role(s)</assignable> user.</h:li>
                  <h:li>If the basicConstraints field is configured to be present, it shall be
                    populated with the value cA=False</h:li>
                  <h:li>If configured to be present, th epolicy OID and policy mapping fields shall be populated according to 
                    <selectables linebreak="yes">
                      <selectable>a <assignable>authorized role(s)</assignable> configured mapping from validated client certificate values to
                        one or more stated policy OIDs</selectable>
                      <selectable><assignable>list of rules</assignable></selectable>
                    </selectables>.
                  </h:li>
                </h:ol>
              </title>
            </ext-comp-def-title>
            <note role="application">
              Policy OIDs for proxy-issued certificates and mappings to FIPS 201 defined policies
              may be required to be supported for SSL/TLS inspection proxies issuing certificates
              representing person-entities subject to FIPS 201 authentication methods, since
              requested servers requiring client authentication are likely to expect to validate
              client certificates issued by the equivalent of such a certificate policy. If Policy OIDs
              are used, the embedded CA may be subject to additional constraints indicated in
              a Certificate Policy.
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it describes the certificate profile function in accordance
                with FDP_CER_EXT.4.1 The TSS shall describe how certificate profiles are configured and then selected to
                issue certificates in accordance with FDP_CER_EXT.4.2. The evaluator shall also ensure that the TSS
                describes how the TSF ensures that a certificate-requesting subject possesses the applicable private key.<h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure that instructions are available to
                configure certificate profiles used for certificate generation in accordance with this requirement.<h:p/></Guidance>
              <Tests>
                The evaluator shall perform the following tests:<h:p/>
                <testlist>
                  <test id="valid-client-profile-cert">The evaluator shall configure a certificate profile using the available guidance, and establish a
                    server with a certificate that satisfies FDP_CER_EXT.4.2 items a, b, e, f, h, j, and k, has valid values in all
                    extensions in item g (g.a-g.f), and passes all certificate validation criteria as a TLS server certificate (having
                    extended key usage field of server authentication) in FIA_X509_EXT.1/STIP. The evaluator shall establish a
                    monitored client and request a TLS session to the server through the TOE so that the mutual
                    authentication inspection operation is implemented, and then examine the certificate received at the
                    server from the TOE to ensure it matches the configured certificate profile.
                  </test>
                  <test>The evaluator shall specifically examine the certificate generated in <xref to="valid-client-profile-cert"/> and compare it to both
                    the embedded CA’s certificate and the monitored client’s certificate to ensure that it satisfies all field
                    constraints in FDP_CER_EXT.4.2, FDP_CER_EXT.4.3, and FDP_CER_EXT.4.4 as configured in the certificate
                    profile.</test>
                  <test>The evaluator shall conduct the following tests by establishing a monitored client with certificate
                    identical to that used in <xref to="valid-client-profile-cert"/>, except for the differences described as follows (each in turn). The evaluator
                    shall make any configuration changes to the TOE as indicated, establish a monitored client and submit a
                    TLS request for a requested server requiring mutual authentication through the TOE so that the mutual
                    authentication inspection operation is performed, and observe the certificate received at the requested
                    server has the indicated features: <h:ul>
                      <h:li><h:b>notBefore field test:</h:b> The evaluator shall assign a notBefore value in the monitored client
                        certificate that precedes both the current time and the value of the notBefore field in the
                        TOE’s embedded CA’s certificate, and observe the generated certificate has a notBefore
                        value that does not precede the current time.</h:li>
                      <h:li><h:b>notAfter field test a:</h:b> The evaluator shall configure the maximum validity duration so that
                        the notAfter value of the TOE’s embedded CA certificate does not exceed the current time
                        by more than the maximum validity duration. The evaluator shall assign a notAfter value in
                        the monitored client certificate that exceeds the current time by more than the maximum
                        validity period, and observe that the notAfter field of the generated certificate has a
                        notAfter value that does not exceed the notAfter value of the embedded CA’s certificate.</h:li>
                      <h:li><h:b>notAfter field test b:</h:b> The evaluator shall configure the maximum validity duration so that
                        the notAfter value in the TOE’s embedded CA certificate exceeds the current time by more
                        than maximum validity duration, assign a notAfter value in the monitored client certificate
                        that exceeds the notAfter value in the TOE’s embedded CA’s certificate, and observe that
                        the notAfter value of the generated certificate does not exceed the current time by more
                        than the maximum validity duration.</h:li>
                      <h:li><h:b>notAfter field test c:</h:b> The evaluator shall assign a notAfter value in the monitored client
                        certificate that precedes both the notAfter value in the TOE’s embedded CA’s certificate,
                        and the current time plus the maximum validity duration, and observe that the generated
                        certificate has a notAfter value that does not exceed the notAfter value of the monitored
                        client’s certificate.
                      </h:li>
                      <h:li><h:b>keyUsage field test:</h:b> The evaluator shall assign a keyUsage value in the established server
                        certificate that indicates additional usage indicators (e.g., KeyCertSign) and observe that
                        generated certificate has only the Digital Signature and/or Key Encipherment indicators.
                      </h:li>
                      <h:li><h:b>extendedKeyUsage field test a:</h:b> The evaluator shall omit the extendedKeyUsage field in the
                        established server certificate and observe that the generated certificate contains the
                        extendedKeyUsage field with value indicating only TLS client authentication.</h:li>
                      <h:li><h:b>extendedKeyUsage field test b:</h:b> The evaluator shall populate the extendedKeyUsage field in
                        the established server’s certificate to indicate both TLS client authentication and code
                        signing, and observe that the generated certificate only indicates TLS client authentication.</h:li>
                      <h:li><h:b>extendedKeyUsage field test c:</h:b> The evaluator shall populate the extendedKeyUsage field in
                        the established server’s certificate to indicate any usage, and observe the generated
                        certificate only indicates TLS client authentication.
                      </h:li>
                    </h:ul>
                  </test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
        <f-component name="Certificate Issuance Rules for Client Certificates" cc-id="fdp_cer_ext.5" id="fdp-cer-ext-5">
          <depends on-sel="clientAuth"/>
          <consistency-rationale>This SFR defines when the TOE will issue TLS client certificates in support of STIP traffic, which is an interface
            that is not defined in the Base-PP.
            </consistency-rationale>
          <comp-lev> requires the TSF to issue certificates in
            response to validated client certificates based on certain rules.</comp-lev>
          <management>
            The following actions could be considered for the management functions in FMT:<h:ul>
              <h:li>Ability to configure rules for automated issuance of certificates.</h:li>
            </h:ul>
          </management>
          <audit>The following actions should be auditable if FAU_GEN.1 Audit Data Generation is included in the
            PP/ST: <h:ul>
              <h:li>Certificate generation.</h:li>
            </h:ul></audit>
          <dependencies>FDP_CER_EXT.4 Certificate Profiles for Client Certificates</dependencies>
          <f-element id="fdp-cer-ext-5e1">
            <title>The TSF shall issue certificates in response to a validated client certificate
              according to the following rules: The issued certificate is in compliance with a
              current certificate profile defined in accordance with FDP_CER_EXT.4 and
              <h:ul>
                <h:li>The TLS session establishment policy is configured to allow inspection of
                  TLS sessions with mutual authentication between the monitored client
                  whose certificate is validated by the TSF and one or more requested
                  servers,</h:li>
                <h:li>The specific requested server includes a Certificate Request message in
                  the TLS handshake,</h:li>
              </h:ul><selectables linebreak="yes">
                <selectable>A valid certificate for the same subject is not present in cache</selectable>
                <selectable>The embedded CA certificate’s name space allows issuance of a certificate
                  that represents the authenticated client</selectable>
                <selectable>No other constraints</selectable>
              </selectables>.</title>
            <note role="application">
              Caching client certificates is neither required nor preferred, since such storage of
              private keys associated to signature keys is strictly controlled by various certificate
              policies and practice statements, especially when the validated client certificate
              associated to the monitored client is issued under NIST FIPS 201. If supported, the
              time in cache for client certificates should be limited to the minimal revocation
              time (emergency revocation) allowed for validated certificates used by any
              monitored client.
            </note>
          </f-element>
          <f-element id="fdp-cer-ext-5e2">
            <title>The TSF shall reject all certificate requests originating external to the TOE.</title>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it describes the certificate issuance rules, and verify that
                any interfaces available for external certificate requests (CMC, EST, PKCS#10 or any other request format)
                are identified.<h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure that it contains instructions for any
                configuration aspects of any certificate issuance approval function and the steps needed to prevent
                receipt and approval of external requests.
              <h:p/></Guidance>
              <Tests>The evaluator shall generate certificates that originate external to the TOE and verify that they are rejected.</Tests>
            </aactivity>
          </f-element>
          <audit-event>
            <audit-event-descr>Certificate generation</audit-event-descr>
            <audit-event-info>Success: <selectables>
              <selectable>certificate value</selectable>
              <selectable>certificate object identifier</selectable>
            </selectables></audit-event-info>
          </audit-event>
        </f-component>
        
        <f-component name="Certificate Status Information for Client Certificates" cc-id="fdp_csi_ext.2" id="fdp-csi-ext-2">
          <depends on-sel="genStatus"/>
          <depends on-sel="clientAuth"/>
          <consistency-rationale>This SFR applies to ability of the TOE to generate status information for its own issued certificates, which is not defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to generate
            certificate status information for client certificates (e.g. for mutually-authenticated TLS) using a supported
            method and to define conditions in which this information can be modified.</comp-lev>
          <management><h:ul>
            The following actions could be considered for the management functions in FMT:
            <h:li>Ability to revoke issued certificates.</h:li>
            <h:li>Ability to configure certificate status services.</h:li>
            <h:li>Ability to configure automated process used to approve the revocation of a certificate or
              information about the revocation of a certificate.</h:li>
            <h:li>Ability to clear a cache of valid issued certificates.</h:li>
          </h:ul>
          </management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>
            FDP_CER_EXT.4 Certificate Profiles for Client Certificates<h:p/>
            FDP_CSI_EXT.1 Certificate Status Information<h:p/>
            [FDP_CRL_EXT.1 Certificate Revocation List Generation OR<h:p/>
            FDP_OCSP_EXT.1 OCSP Basic Response Generation]<h:p/>
            FDP_OCSPS_EXT.1 OCSP Stapling<h:p/>
            FMT_SMR.1 Security Roles
          </dependencies>
          <f-element id="fdp-csi-ext-2e1">
            <title>The TSF shall generate certificate status information for issued client certificates whose format complies with
              <selectables>
                <selectable>ITU-T Recommendation X.509 CRL</selectable>
                <selectable>the OCSP standard as defined by RFC 6960</selectable>
              </selectables>.</title>
          </f-element>
          <f-element id="fdp-csi-ext-2e2">
            <title>
              The TSF shall support changes to the status of a certificate in accordance with the following rules: <h:ul>
                <h:li>as directed by <h:b><selectables>
                  <selectable>Security Administrator</selectable>
                  <selectable>CA Operations Staff</selectable>
                </selectables></h:b> and</h:li>
                <h:li>
                  <selectables linebreak="yes">
                    <selectable>a certificate in cache is revoked when a certificate representing the same subject is received for client authentication and either <h:ul>
                      <h:li>the validation of the received certificate fails, or</h:li>
                      <h:li>the validation of the received certificate passes and the certificate
                        fields of the validated certificate would result in a different
                        certificate being issued under the current profile in accordance
                        with FDP_CER_EXT.4</h:li></h:ul></selectable>
                    <selectable><assignable>other rules for revocation of issued certificates</assignable></selectable>
                    <selectable>no other rules</selectable>
                  </selectables>.
                </h:li>
              </h:ul>
            </title>
            <ext-comp-def-title>
              <title>
                The TSF shall support changes to the status of a certificate in accordance with the following rules: <h:ul>
                  <h:li>as directed by <assignable>authorized role(s)</assignable> and</h:li>
                  <h:li>
                    <selectables linebreak="yes">
                      <selectable>a certificate in cache is revoked when a certificate representing the same subject is received for client authentication and either <h:ul>
                        <h:li>the validation of the received certificate fails, or</h:li>
                        <h:li>the validation of the received certificate passes and the certificate
                          fields of the validated certificate would result in a different
                          certificate being issued under the current profile in accordance
                          with FDP_CER_EXT.4</h:li></h:ul></selectable>
                      <selectable><assignable>other rules for revocation of issued certificates</assignable></selectable>
                      <selectable>no other rules</selectable>
                    </selectables>.
                  </h:li>
                </h:ul>
              </title>
            </ext-comp-def-title>
            <note role="application">
              In order to meet revocation requirements associated with credentials issued under
              FIPS 201, the first item of the second selection in this element must be claimed if
              cache is provided.
              <h:p/>
              Automated rules for revoking certificates in response to the TOE’s discovery that
              a previously issued certificate is no longer appropriate for the subject, or due to
              cache clearing, timeouts, or other rules should be described in the assignment of
              FDP_CSI_EXT.2.2.
            </note>
          </f-element>
          <f-element id="fdp-csi-ext-2e3">
            <title>
              The TSF shall <selectables>
                <selectable>provide</selectable>
                <selectable>interface with the Operational Environment to provide</selectable>
              </selectables> certificate status information generated in accordance with
              FDP_CSI_EXT.2.1 via <selectables>
                <selectable>posting CRLs at the location specified in the cRLDistributionPoints of the issued certificate</selectable>
                <selectable>an OCSP mechanism indicated in the authorityInfoAccess extension of the issued certificate</selectable>
              </selectables>.
            </title>
            <note role="application">
              Based on the selection, the ST author must choose the appropriate requirements
              from Appendix B.1 of this PP-Module.
              <h:p/>
              <!-- Note: this previously said sub-item (g) but that doesn't exist, from context we assume it was supposed to be (f) -->
              The ST should specify the format(s) used to supply certificate status information
              in FDP_CSI_EXT.2.1, and the mechanism(s) used to provide the status to relying
              parties including all servers authorized to use mutually authenticated TLS in
              accordance with the configured TLS session establishment policy, identified in
              FDP_TEP_EXT.1, in the second selection in FDP_CSI_EXT.2.3. If CRLs are identified
              in FDP_CSI_EXT.2.1, then cRLDistributionPoints must be claimed in
              FDP_CSI_EXT.2.3 and in FDP_CER_EXT.4.2 item (g), sub-item (f). If the OCSP
              standard is selected in FDP_CSI_EXT.2.1, then ‘authorityInfoAccess’ must be
              selected in the second selection of FDP_CSI_EXT.2.3 and in FDP_CER_EXT.4.2 item
              (g), sub-item (f).
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it describes the certificate status function and applicable
                formats, in accordance with this requirement, that can be used to issue certificate status. The TSS must
                reflect the selection made by the ST author as well as the selection-based requirements from Appendix
                B.1 of the STIP PP-Module for CRL or OCSP information. The evaluator shall also ensure that the TSS describes the
                process for approving changes to the status of a certificate, including the interfaces that must be used. <h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure that it contains instructions for any
                configuration aspects of the certificate status change function and the steps needed to perform an
                approval, as well as any configuration required for interfaces to external certificate status providers.
              <h:p/></Guidance>
              <Tests>Based on the selections, the evaluator shall perform the following tests. It is recommended that these be
                performed in conjunction with applicable tests associated with the requirements claimed in Appendix B.1: <h:p/>
                <testlist>
                  <test>For each certificate status format identified in FCS_CSI_EXT.2.1, the evaluator shall cause a valid
                    client certificate to be issued by the TOE. The evaluator shall then cause the TOE to issue certificate status
                    information. The evaluator shall check the certificate status information using all indicated methods
                    identified in FCS_CSI_EXT.2.3 to verify that each reflects that the certificate is valid.
                  </test>
                  <test>For each selected certificate status format (CRLv2 or OCSP) identified in FCS_CSI_EXT.2.1, and for
                    each mechanism indicated in FDP_CSI_EXT.2.2, the evaluator shall cause a valid client certificate from the
                    TOE to be revoked. The evaluator shall then cause the TOE to issue certificate status information. The
                    evaluator shall check the certificate status information using all methods (cRLDistributionPoints,
                    authorityInfoAccess, or OCSP Stapling) identified in FCS_CSI_EXT.2.3 to verify that each method reflects
                    that the certificate is revoked.</test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>

        <f-component name="Mutual Authentication Inspection Operation" cc-id="fdp_stip_ext.2" id="fdp-stip-ext-2">
          <depends on-sel="clientAuth"/>
          <consistency-rationale>This SFR applies to the TLS session implementation of the inspection
            operation that is not defined in the Base-PP.</consistency-rationale>
          <comp-lev> defines the ability of the TSF to act as an
            SSL/TLS inspection proxy for mutually authenticated SSL/TLS sessions.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>
            FDP_STIP_EXT.1 SSL/TLS Inspection Proxy Functions<h:p/>
            FDP_CER_EXT.5 Certificate Issuance Rules for Client Certificates
          </dependencies>
          <f-element id="fdp-stip-ext-2e1">
            <title>
              The TSF shall be capable of providing mutual authentication of the monitored
              client to a requested server when performing the inspection operation when
              mutual authentication is allowed for the requested server by the configured 
              policy, and the TLS handshake with the requested server includes a certificate
              request. 
            </title>
            <note role="application">The policy is flexible; it could be static policy or a policy associated with certain
              clients, servers, or connections.</note>
          </f-element>
          <f-element id="fdp-stip-ext-2e2">
            <title>
              After receiving the TLS client certificate from the monitored client, the TSF shall
              be able to generate a certificate representing the client in accordance with
              FDP_CER_EXT.5 and 
              <selectables>
                <selectable>obtain a valid certificate representing the client from cache</selectable>
                <selectable>no other method</selectable>
              </selectables> matching the current certificate profile.
            </title>
            <note role="application">
              Certificate caching of client certificates is not required. However, in the case where
              certificate caching is supported, the TSF will still need to perform certificate
              generation if the cached certificate does not match the current profile determined
              by FDP_CER_EXT.4 which depends on values derived from the certificate provided
              by the monitored client.
            </note>
          </f-element>
          <f-element id="fdp-stip-ext-2e3">
            <title>
              After obtaining a certificate representing the monitored client, the TSF shall send
              the client certificate and certificate verify messages to the requested server.
            </title>
            <note role="application">
              This element completes the TLS handshake between the TOE and the requested
              server as a complete TLS handshake with mutual authentication.
            </note>
            <aactivity>
              <TSS>
                The evaluator shall examine the TSS to ensure that inspection of mutually authenticated TLS sessions is
                described and meets the requirements of FDP_STIP_EXT.2.
                <h:p/>
                If the selection in FDP_STIP_EXT.2.2 indicates client certificate caching is supported, the evaluator shall
                examine the TSS to ensure that the cache is described, as well as the mechanism to determine when
                certificates are cached and when new certificates are obtained.
                <h:p/>
                The evaluator shall examine the TSS and confirm that the TSF only sends a TSF-generated certificate
                message and certificate validate message to a requested server matching an exception specification after
                it verifies that the certificate meets the configured certificate profile associated to a validated client
                certificate received from the monitored client requesting TLS to the server.
              <h:p/></TSS>
              <Guidance>The evaluator shall examine operational documentation and verify that instructions to configure the
                mutual authentication inspection operation is provided.<h:p/></Guidance>
              <Tests><h:b>Setup:</h:b> The evaluator shall follow operational guidance to configure the TSF. The evaluator shall establish a
                monitored client able to initiate a TLS session compliant with FCS_TLSC_EXT.2 and which is issued a
                certificate compliant with FIA_X509_EXT.1/STIP for client authentication from a trusted CA that is
                different than the embedded CA of the TOE.
                <h:p/>
                The evaluator shall ensure the validity of the client’s certificate is short enough to accommodate <xref to="issue-new-client-cert"/>
                below. The evaluator shall establish a server able to establish TLS sessions in accordance with
                FCS_TLSS_EXT.2 and configured to support mutual authentication of the client and which is configured to
                trust the TOE’s embedded CA.
                <h:p/>
                The evaluator shall ensure the server is issued a certificate issued by a trusted CA that is different than
                the TOE’s embedded CA, and which is valid in accordance with FIA_X509_EXT.1/STIP for server
                authentication.
                <h:p/>
                The evaluator shall follow operational guidance to configure the TLS session establishment policy so mutually
                authenticated TLS sessions through the TOE between the client and server is allowed and will be
                inspected.
                <h:p/>
                The evaluator shall use appropriate tools to monitor the traffic between the clients and the TOE, and
                between the TOE and the server to observe the TLS handshake messages. The evaluator shall perform
                the following tests in order:<h:p/>
                  <testlist>
                    <test>The evaluator shall configure the server to not require mutual authentication of the client, initiate
                      a TLS session to the server through the TSF, and observe a TLS session between the TSF and the server is
                      established and does not include a certificate message or certificate verify message from the TSF. The
                      evaluator shall inspect the server certificate received at the client to confirm that it was issued by the
                      embedded CA of the TOE, confirming that the inspection operation was implemented. The evaluator shall
                      inspect the certificate repository of the TOE and confirm that no certificate representing the client is
                      present.
                    </test>
                    <test>The evaluator shall configure the server to require mutual authentication of the client, initiate a
                      TLS session from the client to the requested server, and observe the traffic between the TOE and the
                      server to verify that the TSF sends a certificate message containing a certificate issued by the embedded
                      CA of the TOE, and a certificate verify message that validates the TSF’s possession of the corresponding
                      private key. The evaluator shall examine the certificate repository of the TOE to confirm that the
                      certificate observed in the certificate message is present in the repository.
                    </test>
                    <test id="issue-new-client-cert">Adjusting the time of the TSF if necessary so that the initial certificate issued to the client is expired,
                      the evaluator shall establish a new certificate for the client, using the same subject but using a validity
                      period that is valid in the current time setting. The evaluator shall initiate a TLS session between the client
                      and the server requiring mutual authentication through the TOE and observe that a TLS session containing
                      a certificate message with a new certificate generated by the embedded CA of the TOE, and a certificate
                      verify message that validates the TSF’s possession of the associated private key. The evaluator shall
                      examine the certificate repository of the TOE and verify that both certificates representing the client are
                      present.</test>
                    <test>The evaluator shall initiate a new TLS session between the client and server through the TOE,
                      where the certificate in the certificate message from the client is modified in the last byte, and a valid
                      certificate verify message is sent for the unmodified certificate. The evaluator shall observe that a TLS
                      session between the client and the TSF is not established, and that any TLS session between the TSF and
                      the server associated to that TLS session thread is terminated.
                    </test>
                  </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
      
      </section>
      
      
      <section title="Other Selection-based SFRs" id="s-b5">
        
        <ext-comp-def fam-id="FAU_SCR_EXT" title="Certificate Repository Review">
          <fam-behavior>Components in this family define requirements for searching the contents of a certificate repository.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="Certificate Repository Review" cc-id="fau_scr_ext.1" id="fau-scr-ext-1">
          <depends on-sel="certStore"/>
          <consistency-rationale>This SFR applies to providing the capability to search the certificate
            repository which is not defined by the Base-PP.</consistency-rationale>
          <comp-lev> requires a conformant TOE to support the searching of a
            certificate repository based on the values of specific certificate fields. </comp-lev>
          <management>The following actions could be considered for the management functions in FMT:<h:ul>
            <h:li>Ability to search the certificate repository</h:li>
          </h:ul></management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>FAU_GCR_EXT.1 Generation of Certificate Repository</dependencies>
          
          <f-element id="fau-scr-ext-1e1">
            <title>
              The TSF shall 
              <selectables>
                <selectable>provide</selectable>
                <selectable>invoke the Operational Environment to provide</selectable>
              </selectables>
              the ability to search certificates containing specified values of the following
              certificate fields: <h:b><selectables linebreak="yes">
                <selectable>subject name</selectable>
                <selectable>individual components of Subject Alternative Name</selectable>
                <selectable>subject ID</selectable>
                <selectable>issuer ID</selectable>
                <selectable>algorithm ID</selectable>
                <selectable>public key</selectable>
                <selectable>key usage</selectable>
                <selectable>extended key usage</selectable>
                <selectable>serial number</selectable>
                <selectable><assignable>list of other certificate fields</assignable></selectable>
              </selectables></h:b>
              returning all matching certificates and <assignable>object identifier(s)</assignable> of
              matching certificate.
            </title>
            <ext-comp-def-title>
              <title>The TSF shall
                <selectables>
                  <selectable>provide</selectable>
                  <selectable>invoke the Operational Environment to provide</selectable>
                </selectables> the ability to search certificates containing specified values of the following
                certificate fields: <assignable>list of certificate fields</assignable>, returning all matching 
                certificates and <assignable>object identifier(s)</assignable> of matching certificates.</title>
            </ext-comp-def-title>
            <note role="application">
              This SFR must be claimed if the selection in FAU_GCR_EXT.1.1 is ‘store.’ It may be
              claimed if the selection in FAU_GCR_EXT.1.1 is ‘invokes the Operational
              Environment to store’ when the TSF provides an interface to the certificate
              repository to perform searches. The ability to search on certificate fields is useful
              for conducting forensic analysis. If the certificate repository is stored within the
              TOE boundary, then the first item of the first selection is chosen. If the repository 
              is stored in the OE, but the auditor uses TSF interfaces to perform this function on
              the repository, then the second item of the first selection is chosen. It is allowed
              that this function be provided entirely by the OE (when the repository is stored in
              the OE); if this is the case, then this requirement is not included in the ST, but
              instead the OE.CERTIFICATE_REPOSITORY_SEARCH objective is included (this
              objective is omitted in the other two cases, when this SFR is included in the ST).
              <h:p/>
              In the second selection and assignment, the ST author includes/fills in the values
              that can be searched on for this function; at least one value is required to be
              selected.
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it describes the certificate repository if the TSF stores it, or
                describes the interfaces to the operational environment if the certificate repository is stored external to
                the TOE. The evaluator shall check the TSS to ensure it describes how to search the certificate repository
                for the selected items.<h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure it contains instructions for searching the
                specified information.
              <h:p/></Guidance>
              <Tests>The following test applies regardless of the selection made in the first selection in the SFR. The test
                activities can be conducted in conjunction with those for FDP_CER_EXT.1 and FAU_GCR_EXT.1.
                <h:p/>
                The evaluator shall generate a sufficient number and variety of certificates to populate the
                repository with certificates having at least two values for each of the search fields selected in this SFR. The
                evaluator shall then—following the instructions in the operational guidance—search the repository or
                audit record for certificates containing specific values for each search field included in the ST, and confirm
                all certificates matching the search criteria are returned, that all returned certificates match the criteria,
                and that the object identifier for each matched item is returned. The evaluator shall confirm that the
                object identifier returned matches the audit events associated with generation of the certificates in
                accordance with FAU_GEN.1/STIP.
              </Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
        <ext-comp-def fam-id="FCS_CKM_EXT" title="Cryptographic Key Management">
          <fam-behavior>Components in this family define requirements for the lifecycle of cryptographic keys in specific cases that
            are not addressed by the FCS_CKM family defined in CC Part 2.
          </fam-behavior>
        </ext-comp-def>
        
        <f-component name="Public Key Integrity" cc-id="fcs_ckm_ext.5" id="fcs-ckm-ext-5">
          <depends on-sel="keyIntegrity"/>
          <consistency-rationale>This SFR applies to the protection of persistent public keys from undetected
            modification which is not defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to apply a cryptographic integrity validation
            method to public keys in persistent storage.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>FCS_COP.1 Cryptographic Operation</dependencies>
          <f-element id="fcs-ckm-ext-5e1">
            <title>
              The TSF shall protect persistent public keys against undetected modification
              through the use of <selectables>
                <selectable>digital signatures <h:b>(in accordance with
                  FCS_COP.1/SigGen)</h:b></selectable>
                <selectable>keyed hashes <h:b>(in accordance with FCS_COP.1/KeyedHash)</h:b></selectable>
              </selectables>.
            </title>
            <ext-comp-def-title>
              <title>The TSF shall protect persistent public keys against undetected modification
                through the use of <selectables>
                  <selectable>digital signatures</selectable>
                  <selectable>keyed hashes</selectable>
                  </selectables>.</title>
            </ext-comp-def-title>
          </f-element>
          <f-element id="fcs-ckm-ext-5e2">
            <title>
              The <selectables>
                <selectable>digital signature</selectable>
                <selectable>keyed hash</selectable>
              </selectables> used to protect a public key shall be
              verified upon <assignable>criteria for automated verification</assignable>. 
            </title>
            <note role="application">
              This SFR is included when the second selection in FDP_STG_EXT.1.1 is chosen, and
              applies to the public keys listed in that SFR.
              <h:p/>
              The selections in FCS_CKM_EXT.5.1 and FCS_CKM_EXT.5.2 should agree, and the
              assignment in FCS_CKM.5.2 for the criteria for automated verification can be
              event or time based and should provide operationally relevant integrity failure
              detection, for which recovery is feasible. 
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure it describes each applicable public key, where it is stored
                and protected, the purpose of the public key, the mechanism used to protect the public key from
                undetected modification, and the method (for each public key) by which the integrity of the key is checked
                in accordance with FCS_CKM_EXT.5.2.
              <h:p/></TSS>
              <Guidance>There are no guidance EAs for this component.<h:p/></Guidance>
              <Tests>NOTE: It might not be possible to access public keys via the TOE interface. If that is the case, then the
                evaluator must describe the interface and indicate why the interface does not allow access to the public
                keys.
                <h:p/>
                For each public key identified in the TSS, the evaluator shall perform the following test:
                <h:p/>
                The evaluator shall perform an action to invalidate the integrity of each public key and then verify
                that the TSF detects the invalid key.</Tests>
            </aactivity>
          </f-element>
        </f-component>
        
        <f-component name="STIP Client-Side Support for Renegotiation" cc-id="fcs_tttc_ext.4" id="fcs-tttc-ext-4">
          <depends on-sel="clientRenegotiation"/>
          <consistency-rationale>This SFR applies to session renegotiation for thru-traffic TLS inspection
            (client-side).</consistency-rationale>
          <comp-lev> requires the TSF to support session
            renegotiation when acting as a TLS client for a proxy connection.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>FCS_TTTC_EXT.1 Thru-Traffic TLS Inspection Client Protocol</dependencies>
          <f-element id="fcs-tttc-ext-4e1">
            <title>The TSF shall support secure renegotiation on STIP TLS connections through use
              of the “renegotiation_info” TLS extension in accordance with RFC 5746.</title>
          </f-element>
          <f-element id="fcs-tttc-ext-4e2">
            <title>
              The TSF shall include 
              <selectables onlyone="yes">
                <selectable>renegotiation_info extension</selectable>
                <selectable>TLS_EMPTY_RENEGOTIATION_INFO_SCSV cipher suite</selectable>
              </selectables> in the Client Hello
              message.
            </title>
            <note role="application">
              This SFR is included when “session renegotiation” in FCS_TTTC_EXT.1.1 is chosen.
              RFC 5746 defines an extension to TLS that binds renegotiation handshakes to the
              cryptography in the original handshake. The cipher suite included in the selection
              is a means for clients to be compatible with servers that don’t support the
              extension. It is recommended that client implementations support both the cipher
              suite and the extension.
            </note>
          </f-element>
          <f-element id="fcs-tttc-ext-4e3">
            <title>
              The TSF shall ensure that renegotiation is performed before 
              <selectables>
                <selectable><assignable>renegotiation rules</assignable></selectable>
                <selectable>2^20 64-bit data blocks are encrypted using
                  TDES cipher suites using the same key</selectable>
              </selectables>.
            </title>
            <note role="application">
              If a TDES cipher suite is selected in FCS_TTTC_EXT.1.1, the amount of data 
              encrypted with the same key is limited in accordance with NIST SP800-67R2,
              section 3.4, and the second selection should be chosen.
            </note>
            <aactivity level="element">
              <TSS>The evaluator shall verify that the TSS describes the mechanisms used to specify when renegotiation
                occurs. <h:p/></TSS>
              <Guidance>The evaluator shall check the operational guidance documentation to ensure that instructions for any
                configurable features of the TLS implementation required to meet this requirement are provided.<h:p/></Guidance>
              <Tests>The evaluator shall perform the following tests:<h:p/>
              <testlist>
                <test>For any mechanism specified, the evaluator will establish one or more monitored client and
                  requested servers configured to use each of the supported cipher suites through the TSF. For each
                  supported cipher suite, the evaluator shall initiate a session between the monitored client to a requested
                  server and observe network traffic between the TOE and the requested server to confirm that the
                  indicated cipher suite is negotiated successfully. The evaluator shall then send application data over the
                  inspected channel between the monitored client until the renegotiation criteria is met. The evaluator
                  shall observe that the TSF terminates or renegotiates the TLS session as specified by the renegotiation
                  mechanism.
                </test>
                <test>(conditional, the ST selects "2^20 64-bit data blocks are encrypted using TDES cipher suites using the same key"
                  in FCS_TTTC_EXT.4.3): the evaluator shall establish one or more monitored client and requested servers
                  configured to use each of the supported cipher suites using TDES through the TSF. For each supported
                  cipher suite using TDES, the evaluator shall configure the TLS session establishment of the TSF to inspect
                  such traffic, to include setting appropriate exception specifications. The evaluator shall initiate a session
                  between the monitored client to a requested server and observe network traffic between the TOE and
                  the requested server to confirm that the indicated cipher suite using TDES is negotiated successfully. The
                  evaluator shall then send application data over the inspected channel between the monitored client and
                  the requested server so that the number of data blocks encrypted under TDES will exceed 2^20. The
                  evaluator shall observe that the TSF terminates or renegotiates the TLS session before the number of data
                  blocks encrypted to the requested server exceeds 2^20.</test>
              </testlist>
              </Tests>
            </aactivity>
            <aactivity level="component">
              <TSS>The evaluator shall examine the TSS to validate that it describes the method used to support
                renegotiation.
              <h:p/></TSS>
              <Guidance>There are no guidance EAs for this component beyond what is specified for FCS_TTTC_EXT.4.3.<h:p/></Guidance>
              <Tests>The evaluator shall perform the following tests:<h:p/>
              <testlist>
                <test>The evaluator shall use a network packet analyzer and/or sniffer to capture the traffic between
                  the TSF and a requested server during inspection of a TLS session between a monitored client and the
                  requested server through the TOE. The evaluator shall verify that either the renegotiation_info field or
                  the SCSV cipher suite is included in the Client Hello message during the initial handshake.
                </test>
                <test>The evaluator shall verify the TSF’s handling of Server Hello messages received from a requested
                  server during an authorized inspection of a TLS session between a monitored client and the requested
                  server through the TOE, during the initial handshake that include the renegotiation_info extension. The
                  evaluator shall modify the length portion of this field in the Server Hello message to be non-zero and verify
                  that the TSF sends a failure and terminates the connection. The evaluator shall verify that a properly
                  formatted field during an authorized inspection of traffic to the server results in a successful TLS
                  connection between the TSF and the requested server.
                </test>
                <test>The evaluator shall cause the TSF to initiate renegotiation with the requested server and verify
                  that the Client Hello message received by the requested server containsthe renegotiation_info extension.
                  The evaluator shall cause the requested server to send a Server Hello message with a renegotiation info
                  extension containing data in which one or both of the client_verify_data or server_verify_data value is
                  modified. The evaluator shall verify that the TSF terminates the connection.
                </test>
              </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
        <f-component name="STIP Server-Side Support for Renegotiation" cc-id="fcs_ttts_ext.4" id="fcs-ttts-ext-4">
          <depends on-sel="serverRenegotiation"/>
          <consistency-rationale>This SFR applies to session renegotiation for thru-traffic TLS inspection
            (server-side).</consistency-rationale>
          <comp-lev> requires the TSF to support session
            renegotiation when acting as a TLS server for a proxy connection.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>FCS_TTTS_EXT.1 Thru-Traffic TLS Inspection Server Protocol</dependencies>
          <f-element id="fcs-ttts-ext-4e1">
            <title>The TSF shall support the "renegotiation_info" TLS extension in accordance with
              RFC 5746.</title>
          </f-element>
          <f-element id="fcs-ttts-ext-4e2">
            <title>The TSF shall include the renegotiation_info extension in Server Hello messages.</title>
            <note role="application">This SFR is included when “session renegotiation” in FCS_TTTS_EXT.1.1 is chosen.
              RFC 5746 defines an extension to TLS that binds renegotiation handshakes to the
              cryptography in the original handshake.</note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to validate it describes the method used to support renegotiation. <h:p/></TSS>
              <Guidance>There are no guidance EAs for this component.<h:p/></Guidance>
              <Tests>
                The evaluator shall establish a monitored client that supports secure renegotiation and the
                renegotiation_info extension, and a requested server that is authorized for the inspection operation. 
                The evaluator shall then perform the following tests: <h:p/>
                <testlist>
                  <test>The evaluator shall use a network packet analyzer or sniffer to capture the traffic between the TSF
                    and a monitored client. The evaluator shall initiate a TLS session between the monitored client and the
                    requested server through the TOE, and verify the renegotiation_info field is included in the Server Hello
                    message sent from the TSF to the monitored client.</test>
                  <test>The evaluator shall initiate a new (initial) TLS session between the monitored client and the
                    requested server through the TOE, where the Client Hello message includes a renegotiation_info
                    extension with non-zero length, and verify the TSF sends a failure and terminates the connection. The
                    evaluator shall verify that a properly formatted field results in a successful TLS connection.
                  </test>
                  <test>The evaluator shall send a renegotiation request from the monitored client to the TSF containing
                    a modified client_verify_data value in the Client Hello message. The evaluator shall verify the TSF
                    terminates the connection.</test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
        <audit-event/>
        </f-component>
        
      </section>
	
    </sel-sfrs>


	<!-- Appendix A.2: Objective Requirements -->
    <obj-sfrs>

   	    <section id="sob-audit-table" title="Auditable Events for Objective SFRs">
   	      <audit-table table="objective" id="objective-audit-events">
  	     		<h:br/><h:b><ctr ctr-type="Table" pre="Table " id="atref-obj">: Auditable Events for Objective SFRs</ctr></h:b>
	  	</audit-table>
	    </section>
      
      <section title="Identification and Authentication (FIA)" id="obj-fia">
        
        <f-component name="Client Use of TLS-Unique Value" cc-id="fia_estc_ext.2" id="fia-estc-ext-2">
          <consistency-rationale>This SFR applies to the implementation of EST, which is a method of acquiring certificates that is not defined in the Base-PP.</consistency-rationale>
          <comp-lev> requires the TSF to generate tls-unique values as
            part of the EST process.</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>There are no auditable events foreseen.</audit>
          <dependencies>FIA_ESTC_EXT.1 Enrollment over Secure Transport (EST) Client</dependencies>
          <f-element id="fia-estc-ext-2e1">
            <title>The TSF shall generate tls-unique values and integrate them into EST requests it
              generates in accordance with RFC 7030 section 3.5.</title>
            <note role="application">
              This SFR describes an optional element of RFC 7030 that strengthens the
              authentication provided by EST. While RFC 7030 requires EST servers to validate
              the tls-unique values when presented, this requirement is not implemented in
              current EST servers. 
              <!-- Note: should we do this now or should we still keep it as something marked for a future release -->
              FIA_ESTC_EXT.2.1 will be integrated into FIA_ESTC_EXT.1 in a
              subsequent release of this PP-Module and should be claimed if the EST
              implementation supports it. 
            </note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to ensure the description of EST includes implementation of TLS-unique values.<h:p/></TSS>
              <Guidance>The evaluator shall examine the operational guidance to ensure it contains instructions on configuring the
                TOE so that EST conforms to the description in the TSS, to include any configuration associated to the
                inclusion of TLS-unique values in certificate requests.
              <h:p/></Guidance>
              <Tests>The evaluator shall follow guidance documentation to implement the EST request function to
                include TLS-unique values in the certificate request. The evaluator shall establish trust with an external
                EST server and associated CA and submit a simple certificate request. The evaluator shall review the
                request received by the EST server and observe that the request contains the TLS-unique value and that
                it matches the TLS-unique value established under the TLS session.</Tests>
            </aactivity>
          </f-element>
          <audit-event/>
        </f-component>
        
      </section>  
    </obj-sfrs>
	
	<impl-dep-sfrs/>
	
  </sec:Security_Requirements>
  
	
<!-- Appendix D: Implicity Satisfied Requirements -->
<appendix title="Implicitly Satisfied Requirements" id="satisfiedreqs">
	<!-- Boilerplate goes here -->
  <!-- 
<h:p>
This appendix lists requirements that should be considered satisfied by products successfully evaluated
	against this PP. However, these requirements are not featured explicitly as SFRs and should not be
	included in the ST. They are not included as standalone SFRs because it would increase the time, cost,
	and complexity of evaluation. This approach is permitted by [CC] Part 1, 8.2 Dependencies between
	components.
</h:p>
<h:p>
	This information benefits systems engineering activities which call for inclusion of particular security
	controls. Evaluation against the PP-Module provides evidence that these controls are present and have
	been evaluated.
</h:p>
	-->
	
	<h:b><ctr ctr-type="Table" pre="Table " id="imp-sat-reqs-table">: Implicitly Satisfied Requirements</ctr></h:b>
    <h:table>	
		<h:tr class="header"><h:td>Requirement</h:td><h:td>Rationale for Satisfaction</h:td></h:tr>
	<h:tr>
	<h:td><h:b>FPT_STM.1 - Reliable Time Stamps</h:b></h:td>
	<h:td>
	  FAU_GEN.1/STIP has a dependency on FPT_STM.1 for applying accurate timestamps to audit records. 
	  The extended SFR FPT_STM_EXT.1 that is defined in the Base-PP provides equivalent functionality to FPT_STM.1 and therefore satisfies this dependency.
	</h:td>
	</h:tr>
    </h:table>
  </appendix>	
	
<!-- Appendix E: Entropy Documentation and Assessment -->
<appendix title="Entropy Documentation and Assessment" id="app-ent">
							
	The TOE does not require any additional supplementary information to describe its entropy source(s)
	beyond the requirements outlined in the Base-PP. As with other Base-PP requirements, the only
	additional requirement is that the entropy documentation also applies to the specific STIP
	capabilities of the TOE in addition to the functionality required by the claimed Base-PP.		 
 </appendix>
  
  <bibliography>
    <cc-entry/>
    <entry id="bibNDcPP">
      <tag>NDcPP</tag>
      <description>
        <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=447&amp;id=447/">
			collaborative Protection Profile for Network Devices</h:a>, Version 2.2E, March 2020
      </description>
    </entry>

    <entry id="bibNDSD">
      <tag>ND-SD</tag>
      <description>
        <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=447&amp;id=447/">
          Supporting Document - Mandatory Technical Document - Evaluation Activities for Network Device cPP</h:a>, Version 2.2, December 2019
      </description>
    </entry>

	</bibliography>

	<!-- Appendix G: Acronyms -->
<!--	<acronyms/>   -->
</Module>
